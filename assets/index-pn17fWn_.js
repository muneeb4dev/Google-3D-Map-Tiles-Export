var Nd=Object.defineProperty;var kd=(n,t,e)=>t in n?Nd(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var T=(n,t,e)=>kd(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();class oe{constructor(t,e,s,i){T(this,"inputElement");T(this,"fieldName");T(this,"fieldType");T(this,"containerId");T(this,"messageContainer");T(this,"helperText","");T(this,"validationOptions",{});T(this,"hasErrors");this.containerId=t,this.fieldType=e;const r=document.querySelector(`${t} input`),o=document.querySelector(`${t} .message`),a=document.querySelector(`${t} .field-label`);if(!r)throw new Error(`Failed to find input element with id: ${t}`);if(r.nodeName!=="INPUT")throw new Error("Selector must point to an input element");this.inputElement=r,o&&(this.messageContainer=o,this.helperText=o.innerText),this.fieldName=(a==null?void 0:a.childNodes[0].textContent)||r.name,this.validationOptions={...this.validationOptions,...i},s&&(this.inputElement.value=String(s)),this.inputElement.addEventListener("keyup",c=>{this.clearError()}),this.inputElement.addEventListener("blur",c=>{this.validate()})}get value(){return this.inputElement.value}disableInput(t){return this.inputElement.disabled=t,this}setError(t){var e;return this.hasErrors=!0,this.inputElement.classList.add("error"),(e=this.messageContainer)==null||e.classList.add("error"),this.messageContainer&&(this.messageContainer.innerText=t),this}clearError(){return this.hasErrors=!1,this.inputElement.classList.remove("error"),this.messageContainer&&(this.messageContainer.classList.remove("error"),this.messageContainer.innerText=this.helperText),this}validate(){const t=this.fieldName,e=this.value,s=this.fieldType,{required:i,floatAllowed:r,min:o,max:a}=this.validationOptions;if(i&&!Pd(e))return this.setError(`${t} is a required field`);if(e&&s==="number"){if(!wl(e))return this.setError(`${t} must be a number`);if(!r&&!Gd(e))return this.setError(`${t} must be an integer`);if(o!=null&&Number(e)<o)return this.setError(`${t} should not be lower than ${o}`);if(a!=null&&Number(e)>a)return this.setError(`${t} should not be higher than ${a}`)}return this.clearError()}}const Pd=n=>!!n,wl=n=>{const t=n?Number(n):NaN;return!isNaN(t)},Gd=n=>wl(n)?Number(n)%1===0:!1;async function Tn(n,t,e,s){return s._parse(n,t,e,s)}function j(n,t){if(!n)throw new Error(t||"loader assertion failed.")}const Vi=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Ua=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Ua&&parseFloat(Ua[1]);const In=globalThis,es=globalThis.process||{};function vd(n){var s,i;if(typeof window<"u"&&((s=window.process)==null?void 0:s.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function $o(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||vd()}const Ml="4.0.7";function Ud(n){try{const t=window[n],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class zd{constructor(t,e,s="sessionStorage"){this.storage=Ud(s),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function Hd(n){let t;return n<10?t=`${n.toFixed(2)}ms`:n<100?t=`${n.toFixed(1)}ms`:n<1e3?t=`${n.toFixed(0)}ms`:t=`${(n/1e3).toFixed(2)}s`,t}function jd(n,t=8){const e=Math.max(t-n.length,0);return`${" ".repeat(e)}${n}`}var Ei;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ei||(Ei={}));const Vd=10;function za(n){return typeof n!="string"?n:(n=n.toUpperCase(),Ei[n]||Ei.WHITE)}function Jd(n,t,e){return!$o&&typeof n=="string"&&(t&&(n=`\x1B[${za(t)}m${n}\x1B[39m`),e&&(n=`\x1B[${za(e)+Vd}m${n}\x1B[49m`)),n}function Wd(n,t=["constructor"]){const e=Object.getPrototypeOf(n),s=Object.getOwnPropertyNames(e),i=n;for(const r of s){const o=i[r];typeof o=="function"&&(t.find(a=>r===a)||(i[r]=o.bind(n)))}}function Zo(n,t){if(!n)throw new Error("Assertion failed")}function ss(){var t,e,s;let n;if($o()&&In.performance)n=(e=(t=In==null?void 0:In.performance)==null?void 0:t.now)==null?void 0:e.call(t);else if("hrtime"in es){const i=(s=es==null?void 0:es.hrtime)==null?void 0:s.call(es);n=i[0]*1e3+i[1]/1e6}else n=Date.now();return n}const ns={debug:$o()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},qd={enabled:!0,level:0};function is(){}const Ha={},ja={once:!0};class Bn{constructor({id:t}={id:""}){this.VERSION=Ml,this._startTs=ss(),this._deltaTs=ss(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new zd(`__probe-${this.id}__`,qd),this.timeStamp(`${this.id} started`),Wd(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ss()-this._startTs).toPrecision(10))}getDelta(){return Number((ss()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,ns.warn,arguments,ja)}error(t){return this._getLogFunction(0,t,ns.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,ns.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,ns.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,ns.debug||ns.info,arguments,ja)}table(t,e,s){return e?this._getLogFunction(t,e,console.table||is,s&&[s],{tag:Xd(e)}):is}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||is)}group(t,e,s={collapsed:!1}){const i=Va({logLevel:t,message:e,opts:s}),{collapsed:r}=s;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e,s={}){return this.group(t,e,Object.assign({},s,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||is)}withGroup(t,e,s){this.group(t,e)();try{s()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=El(t)}_getLogFunction(t,e,s,i,r){if(this._shouldLog(t)){r=Va({logLevel:t,message:e,args:i,opts:r}),s=s||r.method,Zo(s),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=ss();const o=r.tag||r.message;if(r.once&&o)if(!Ha[o])Ha[o]=ss();else return is;return e=Kd(this.id,r.message,r),s.bind(console,e,...r.args)}return is}}Bn.VERSION=Ml;function El(n){if(!n)return 0;let t;switch(typeof n){case"number":t=n;break;case"object":t=n.logLevel||n.priority||0;break;default:return 0}return Zo(Number.isFinite(t)&&t>=0),t}function Va(n){const{logLevel:t,message:e}=n;n.logLevel=El(t);const s=n.args?Array.from(n.args):[];for(;s.length&&s.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&s.unshift(e),n.message=t;break;case"object":Object.assign(n,t);break}typeof n.message=="function"&&(n.message=n.message());const i=typeof n.message;return Zo(i==="string"||i==="object"),Object.assign(n,{args:s},n.opts)}function Kd(n,t,e){if(typeof t=="string"){const s=e.time?jd(Hd(e.total)):"";t=e.time?`${n}: ${s}  ${t}`:`${n}: ${t}`,t=Jd(t,e.color,e.background)}return t}function Xd(n){for(const t in n)for(const e in n[t])return e||"untitled";return"empty"}globalThis.probe={};const Cl=new Bn({id:"@probe.gl/log"}),ir="4.3.1",Qd=ir[0]>="0"&&ir[0]<="9"?`v${ir}`:"";function Yd(){const n=new Bn({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=Qd,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const $d=Yd();function Zd(n,t){return _l(n||{},t)}function _l(n,t,e=0){if(e>3)return t;const s={...n};for(const[i,r]of Object.entries(t))r&&typeof r=="object"&&!Array.isArray(r)?s[i]=_l(s[i]||{},t[i],e+1):s[i]=t[i];return s}function tf(n){var t;globalThis.loaders||(globalThis.loaders={}),(t=globalThis.loaders).modules||(t.modules={}),Object.assign(globalThis.loaders.modules,n)}function ef(n){var e,s;return((s=(e=globalThis.loaders)==null?void 0:e.modules)==null?void 0:s[n])||null}const sf="latest";function nf(){var n;return(n=globalThis._loadersgl_)!=null&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const Sl=nf();function ge(n,t){if(!n)throw new Error(t||"loaders.gl assertion failed.")}const Rt=typeof process!="object"||String(process)!=="[object process]"||process.browser,ta=typeof importScripts=="function",rf=typeof window<"u"&&typeof window.orientation<"u",Ja=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Ja&&parseFloat(Ja[1]);class of{constructor(t,e){T(this,"name");T(this,"workerThread");T(this,"isRunning",!0);T(this,"result");T(this,"_resolve",()=>{});T(this,"_reject",()=>{});this.name=t,this.workerThread=e,this.result=new Promise((s,i)=>{this._resolve=s,this._reject=i})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){ge(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){ge(this.isRunning),this.isRunning=!1,this._reject(t)}}class rr{terminate(){}}const or=new Map;function af(n){ge(n.source&&!n.url||!n.source&&n.url);let t=or.get(n.source||n.url);return t||(n.url&&(t=cf(n.url),or.set(n.url,t)),n.source&&(t=Fl(n.source),or.set(n.source,t))),ge(t),t}function cf(n){if(!n.startsWith("http"))return n;const t=hf(n);return Fl(t)}function Fl(n){const t=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(t)}function hf(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Rl(n,t=!0,e){const s=e||new Set;if(n){if(Wa(n))s.add(n);else if(Wa(n.buffer))s.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(t&&typeof n=="object")for(const i in n)Rl(n[i],t,s)}}return e===void 0?Array.from(s):[]}function Wa(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const ar=()=>{};class xo{constructor(t){T(this,"name");T(this,"source");T(this,"url");T(this,"terminated",!1);T(this,"worker");T(this,"onMessage");T(this,"onError");T(this,"_loadableURL","");const{name:e,source:s,url:i}=t;ge(s||i),this.name=e,this.source=s,this.url=i,this.onMessage=ar,this.onError=r=>console.log(r),this.worker=Rt?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Rt||typeof rr<"u"&&!Rt}destroy(){this.onMessage=ar,this.onError=ar,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||Rl(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name} from ${this.url}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=af({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const s=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new rr(s,{eval:!1})}else if(this.source)t=new rr(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class lf{constructor(t){T(this,"name","unnamed");T(this,"source");T(this,"url");T(this,"maxConcurrency",1);T(this,"maxMobileConcurrency",1);T(this,"onDebug",()=>{});T(this,"reuseWorkers",!0);T(this,"props",{});T(this,"jobQueue",[]);T(this,"idleQueue",[]);T(this,"count",0);T(this,"isDestroyed",!1);this.source=t.source,this.url=t.url,this.setProps(t)}static isSupported(){return xo.isSupported()}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,e=(i,r,o)=>i.done(o),s=(i,r)=>i.error(r)){const i=new Promise(r=>(this.jobQueue.push({name:t,onMessage:e,onError:s,onStart:r}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const s=new of(e.name,t);t.onMessage=i=>e.onMessage(s,i.type,i.payload),t.onError=i=>e.onError(s,i),e.onStart(s);try{await s.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!Rt||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new xo({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return rf?this.maxMobileConcurrency:this.maxConcurrency}}const uf={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Re=class Re{constructor(t){T(this,"props");T(this,"workerPools",new Map);this.props={...uf},this.setProps(t),this.workerPools=new Map}static isSupported(){return xo.isSupported()}static getWorkerFarm(t={}){return Re._workerFarm=Re._workerFarm||new Re({}),Re._workerFarm.setProps(t),Re._workerFarm}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:s,url:i}=t;let r=this.workerPools.get(e);return r||(r=new lf({name:e,source:s,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};T(Re,"_workerFarm");let Ci=Re;function df(n,t={}){const e=t[n.id]||{},s=Rt?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let i=e.workerUrl;if(!i&&n.id==="compression"&&(i=t.workerUrl),t._workerType==="test"&&(Rt?i=`modules/${n.module}/dist/${s}`:i=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!i){let r=n.version;r==="latest"&&(r=sf);const o=r?`@${r}`:"";i=`https://unpkg.com/@loaders.gl/${n.module}${o}/dist/${s}`}return ge(i),i}function ff(n,t=Sl){ge(n,"no worker provided");const e=n.version;return!(!t||!e)}const cr={};async function Je(n,t=null,e={},s=null){return t&&(n=pf(n,t,e,s)),cr[n]=cr[n]||mf(n),await cr[n]}function pf(n,t,e={},s=null){if(!e.useLocalLibraries&&n.startsWith("http"))return n;s=s||n;const i=e.modules||{};return i[s]?i[s]:Rt?e.CDN?(ge(e.CDN.startsWith("http")),`${e.CDN}/${t}@${Sl}/dist/libs/${s}`):ta?`../src/libs/${s}`:`modules/${t}/src/libs/${s}`:`modules/${t}/dist/libs/${s}`}async function mf(n){if(n.endsWith("wasm"))return await gf(n);if(!Rt)try{const{requireFromFile:e}=globalThis.loaders||{};return await(e==null?void 0:e(n))}catch(e){return console.error(e),null}if(ta)return importScripts(n);const t=await yf(n);return bf(t,n)}function bf(n,t){if(!Rt){const{requireFromString:s}=globalThis.loaders||{};return s==null?void 0:s(n,t)}if(ta)return eval.call(globalThis,n),null;const e=document.createElement("script");e.id=t;try{e.appendChild(document.createTextNode(n))}catch{e.text=n}return document.body.appendChild(e),null}async function gf(n){const{readFileAsArrayBuffer:t}=globalThis.loaders||{};return Rt||!t||n.startsWith("http")?await(await fetch(n)).arrayBuffer():await t(n)}async function yf(n){const{readFileAsText:t}=globalThis.loaders||{};return Rt||!t||n.startsWith("http")?await(await fetch(n)).text():await t(n)}function Af(n,t){return!Ci.isSupported()||!Rt&&!(t!=null&&t._nodeWorkers)?!1:n.worker&&(t==null?void 0:t.worker)}async function xf(n,t,e,s,i){const r=n.id,o=df(n,e),c=Ci.getWorkerFarm(e).getWorkerPool({name:r,url:o});e=JSON.parse(JSON.stringify(e)),s=JSON.parse(JSON.stringify(s||{}));const h=await c.startJob("process-on-worker",Tf.bind(null,i));return h.postMessage("process",{input:t,options:e,context:s}),await(await h.result).result}async function Tf(n,t,e,s){switch(e){case"done":t.done(s);break;case"error":t.error(new Error(s.error));break;case"process":const{id:i,input:r,options:o}=s;try{const a=await n(r,o);t.postMessage("done",{id:i,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:i,error:c})}break;default:console.warn(`parse-with-worker unknown message ${e}`)}}function Bf(n,t=5){return typeof n=="string"?n.slice(0,t):ArrayBuffer.isView(n)?qa(n.buffer,n.byteOffset,t):n instanceof ArrayBuffer?qa(n,0,t):""}function qa(n,t,e){if(n.byteLength<=t+e)return"";const s=new DataView(n);let i="";for(let r=0;r<e;r++)i+=String.fromCharCode(s.getUint8(t+r));return i}function wf(n){try{return JSON.parse(n)}catch{throw new Error(`Failed to parse JSON from data starting with "${Bf(n)}"`)}}function Mf(n,t,e){if(e=e||n.byteLength,n.byteLength<e||t.byteLength<e)return!1;const s=new Uint8Array(n),i=new Uint8Array(t);for(let r=0;r<s.length;++r)if(s[r]!==i[r])return!1;return!0}function Ef(...n){return Cf(n)}function Cf(n){const t=n.map(r=>r instanceof ArrayBuffer?new Uint8Array(r):r),e=t.reduce((r,o)=>r+o.byteLength,0),s=new Uint8Array(e);let i=0;for(const r of t)s.set(r,i),i+=r.byteLength;return s.buffer}function ea(n,t,e){const s=e!==void 0?new Uint8Array(n).subarray(t,t+e):new Uint8Array(n).subarray(t);return new Uint8Array(s).buffer}function wn(n,t){return j(n>=0),j(t>0),n+(t-1)&~(t-1)}function _f(n,t,e){let s;if(n instanceof ArrayBuffer)s=new Uint8Array(n);else{const i=n.byteOffset,r=n.byteLength;s=new Uint8Array(n.buffer||n.arrayBuffer,i,r)}return t.set(s,e),e+wn(s.byteLength,4)}async function Sf(n){const t=[];for await(const e of n)t.push(e);return Ef(...t)}function Ka(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();n=t[0]*1e3+t[1]/1e6}else n=Date.now();return n}class Xa{constructor(t,e){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Ka(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Ka()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Il{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,e="count"){return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:s}=t;let i=this.stats[e];return i||(t instanceof Xa?i=t:i=new Xa(e,s),this.stats[e]=i),i}}const Ff="Queued Requests",Rf="Active Requests",If="Cancelled Requests",Df="Queued Requests Ever",Of="Active Requests Ever",Lf={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class Nf{constructor(t={}){T(this,"props");T(this,"stats");T(this,"activeRequestCount",0);T(this,"requestQueue",[]);T(this,"requestMap",new Map);T(this,"updateTimer",null);this.props={...Lf,...t},this.stats=new Il({id:this.props.id}),this.stats.get(Ff),this.stats.get(Rf),this.stats.get(If),this.stats.get(Df),this.stats.get(Of)}scheduleRequest(t,e=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const s={handle:t,priority:0,getPriority:e},i=new Promise(r=>(s.resolve=r,s));return this.requestQueue.push(s),this.requestMap.set(t,i),this._issueNewRequests(),i}_issueRequest(t){const{handle:e,resolve:s}=t;let i=!1;const r=()=>{i||(i=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,s?s({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const s=this.requestQueue.shift();s&&this._issueRequest(s)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const s=t[e];this._updateRequest(s)||(t.splice(e,1),this.requestMap.delete(s.handle),e--)}t.sort((e,s)=>e.priority-s.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let kf="";const Qa={};function Pf(n){for(const t in Qa)if(n.startsWith(t)){const e=Qa[t];n=n.replace(t,e)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${kf}${n}`),n}function Gf(n){return n&&typeof n=="object"&&n.isBuffer}function Dl(n){if(Gf(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const t=n;return new TextEncoder().encode(t).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function vf(){var t;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const n=(t=window.location)==null?void 0:t.pathname;return(n==null?void 0:n.slice(0,n.lastIndexOf("/")+1))||""}function Ol(n){const t=n?n.lastIndexOf("/"):-1;return t>=0?n.substr(t+1):""}function sa(n){const t=n?n.lastIndexOf("/"):-1;return t>=0?n.substr(0,t):""}function Uf(...n){const t=[];for(let r=0;r<n.length;r++)t[r]=n[r];let e="",s=!1,i;for(let r=t.length-1;r>=-1&&!s;r--){let o;r>=0?o=t[r]:(i===void 0&&(i=vf()),o=i),o.length!==0&&(e=`${o}/${e}`,s=o.charCodeAt(0)===en)}return e=zf(e,!s),s?`/${e}`:e.length>0?e:"."}const en=47,hr=46;function zf(n,t){let e="",s=-1,i=0,r,o=!1;for(let a=0;a<=n.length;++a){if(a<n.length)r=n.charCodeAt(a);else{if(r===en)break;r=en}if(r===en){if(!(s===a-1||i===1))if(s!==a-1&&i===2){if(e.length<2||!o||e.charCodeAt(e.length-1)!==hr||e.charCodeAt(e.length-2)!==hr){if(e.length>2){const c=e.length-1;let h=c;for(;h>=0&&e.charCodeAt(h)!==en;--h);if(h!==c){e=h===-1?"":e.slice(0,h),s=a,i=0,o=!1;continue}}else if(e.length===2||e.length===1){e="",s=a,i=0,o=!1;continue}}t&&(e.length>0?e+="/..":e="..",o=!0)}else{const c=n.slice(s+1,a);e.length>0?e+=`/${c}`:e=c,o=!1}s=a,i=0}else r===hr&&i!==-1?++i:i=-1}return e}const Hf=n=>typeof n=="boolean",on=n=>typeof n=="function",Mn=n=>n!==null&&typeof n=="object",Ya=n=>Mn(n)&&n.constructor==={}.constructor,jf=n=>!!n&&typeof n[Symbol.iterator]=="function",Vf=n=>n&&typeof n[Symbol.asyncIterator]=="function",Xe=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Qe=n=>typeof Blob<"u"&&n instanceof Blob,Jf=n=>n&&typeof n=="object"&&n.isBuffer,Wf=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Mn(n)&&on(n.tee)&&on(n.cancel)&&on(n.getReader),qf=n=>Mn(n)&&on(n.read)&&on(n.pipe)&&Hf(n.readable),Ll=n=>Wf(n)||qf(n);class Kf extends Error{constructor(e,s){super(e);T(this,"reason");T(this,"url");T(this,"response");this.reason=s.reason,this.url=s.url,this.response=s.response}}const Xf=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Qf=/^([-\w.]+\/[-\w.+]+)/;function $a(n,t){return n.toLowerCase()===t.toLowerCase()}function Yf(n){const t=Qf.exec(n);return t?t[1]:n}function Za(n){const t=Xf.exec(n);return t?t[1]:""}const Nl=/\?.*/;function $f(n){const t=n.match(Nl);return t&&t[0]}function na(n){return n.replace(Nl,"")}function Zf(n){if(n.length<50)return n;const t=n.slice(n.length-15);return`${n.substr(0,32)}...${t}`}function Ji(n){return Xe(n)?n.url:Qe(n)?n.name||"":typeof n=="string"?n:""}function ia(n){if(Xe(n)){const t=n,e=t.headers.get("content-type")||"",s=na(t.url);return Yf(e)||Za(s)}return Qe(n)?n.type||"":typeof n=="string"?Za(n):""}function tp(n){return Xe(n)?n.headers["content-length"]||-1:Qe(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function kl(n){if(Xe(n))return n;const t={},e=tp(n);e>=0&&(t["content-length"]=String(e));const s=Ji(n),i=ia(n);i&&(t["content-type"]=i);const r=await np(n);r&&(t["x-first-bytes"]=r),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:t});return Object.defineProperty(o,"url",{value:s}),o}async function ep(n){if(!n.ok)throw await sp(n)}async function sp(n){const t=Zf(n.url);let e=`Failed to fetch resource (${n.status}) ${n.statusText}: ${t}`;e=e.length>100?`${e.slice(0,100)}...`:e;const s={reason:n.statusText,url:n.url,response:n};try{const i=n.headers.get("Content-Type");s.reason=!n.bodyUsed&&(i!=null&&i.includes("application/json"))?await n.json():await n.text()}catch{}return new Kf(e,s)}async function np(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const e=n.slice(0,5);return await new Promise(s=>{const i=new FileReader;i.onload=r=>{var o;return s((o=r==null?void 0:r.target)==null?void 0:o.result)},i.readAsDataURL(e)})}if(n instanceof ArrayBuffer){const e=n.slice(0,5);return`data:base64,${ip(e)}`}return null}function ip(n){let t="";const e=new Uint8Array(n);for(let s=0;s<e.byteLength;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function rp(n){return!op(n)&&!ap(n)}function op(n){return n.startsWith("http:")||n.startsWith("https:")}function ap(n){return n.startsWith("data:")}async function tc(n,t){var e,s;if(typeof n=="string"){const i=Pf(n);return rp(i)&&(e=globalThis.loaders)!=null&&e.fetchNode?(s=globalThis.loaders)==null?void 0:s.fetchNode(i,t):await fetch(i,t)}return await kl(n)}const ec=new Bn({id:"loaders.gl"});class cp{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class hp{constructor(){T(this,"console");this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const Pl={fetch:null,mimeType:void 0,nothrow:!1,log:new hp,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Vi,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},lp={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Gl(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function vl(){const n=Gl();return n.globalOptions=n.globalOptions||{...Pl},n.globalOptions}function up(n,t,e,s){return e=e||[],e=Array.isArray(e)?e:[e],dp(n,e),pp(t,n,s)}function dp(n,t){sc(n,null,Pl,lp,t);for(const e of t){const s=n&&n[e.id]||{},i=e.options&&e.options[e.id]||{},r=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};sc(s,e.id,i,r,t)}}function sc(n,t,e,s,i){const r=t||"Top level",o=t?`${t}.`:"";for(const a in n){const c=!t&&Mn(n[a]),h=a==="baseUri"&&!t,l=a==="workerUrl"&&t;if(!(a in e)&&!h&&!l){if(a in s)ec.warn(`${r} loader option '${o}${a}' no longer supported, use '${s[a]}'`)();else if(!c){const u=fp(a,i);ec.warn(`${r} loader option '${o}${a}' not recognized. ${u}`)()}}}}function fp(n,t){const e=n.toLowerCase();let s="";for(const i of t)for(const r in i.options){if(n===r)return`Did you mean '${i.id}.${r}'?`;const o=r.toLowerCase();(e.startsWith(o)||o.startsWith(e))&&(s=s||`Did you mean '${i.id}.${r}'?`)}return s}function pp(n,t,e){const i={...n.options||{}};return mp(i,e),i.log===null&&(i.log=new cp),nc(i,vl()),nc(i,t),i}function nc(n,t){for(const e in t)if(e in t){const s=t[e];Ya(s)&&Ya(n[e])?n[e]={...n[e],...t[e]}:n[e]=t[e]}}function mp(n,t){t&&!("baseUri"in n)&&(n.baseUri=t)}function ra(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n==null?void 0:n.extensions)):!1}function Ul(n){j(n,"null loader"),j(ra(n),"invalid loader");let t;return Array.isArray(n)&&(t=n[1],n=n[0],n={...n,options:{...n.options,...t}}),(n!=null&&n.parseTextSync||n!=null&&n.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const bp=()=>{const n=Gl();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function gp(){return bp()}const yp=/\.([^.]+)$/;async function Ap(n,t=[],e,s){if(!zl(n))return null;let i=ic(n,t,{...e,nothrow:!0},s);if(i)return i;if(Qe(n)&&(n=await n.slice(0,10).arrayBuffer(),i=ic(n,t,e,s)),!i&&!(e!=null&&e.nothrow))throw new Error(Hl(n));return i}function ic(n,t=[],e,s){if(!zl(n))return null;if(t&&!Array.isArray(t))return Ul(t);let i=[];t&&(i=i.concat(t)),e!=null&&e.ignoreRegisteredLoaders||i.push(...gp()),Tp(i);const r=xp(n,i,e,s);if(!r&&!(e!=null&&e.nothrow))throw new Error(Hl(n));return r}function xp(n,t,e,s){const i=Ji(n),r=ia(n),o=na(i)||(s==null?void 0:s.url);let a=null,c="";return e!=null&&e.mimeType&&(a=lr(t,e==null?void 0:e.mimeType),c=`match forced by supplied MIME type ${e==null?void 0:e.mimeType}`),a=a||Bp(t,o),c=c||(a?`matched url ${o}`:""),a=a||lr(t,r),c=c||(a?`matched MIME type ${r}`:""),a=a||Mp(t,n),c=c||(a?`matched initial data ${jl(n)}`:""),e!=null&&e.fallbackMimeType&&(a=a||lr(t,e==null?void 0:e.fallbackMimeType),c=c||(a?`matched fallback MIME type ${r}`:"")),c&&$d.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${c}.`),a}function zl(n){return!(n instanceof Response&&n.status===204)}function Hl(n){const t=Ji(n),e=ia(n);let s="No valid loader found (";s+=t?`${Ol(t)}, `:"no url provided, ",s+=`MIME type: ${e?`"${e}"`:"not provided"}, `;const i=n?jl(n):"";return s+=i?` first bytes: "${i}"`:"first bytes: not available",s+=")",s}function Tp(n){for(const t of n)Ul(t)}function Bp(n,t){const e=t&&yp.exec(t),s=e&&e[1];return s?wp(n,s):null}function wp(n,t){t=t.toLowerCase();for(const e of n)for(const s of e.extensions)if(s.toLowerCase()===t)return e;return null}function lr(n,t){var e;for(const s of n)if((e=s.mimeTypes)!=null&&e.some(i=>$a(t,i))||$a(t,`application/x.${s.id}`))return s;return null}function Mp(n,t){if(!t)return null;for(const e of n)if(typeof t=="string"){if(Ep(t,e))return e}else if(ArrayBuffer.isView(t)){if(rc(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&rc(t,0,e))return e;return null}function Ep(n,t){return t.testText?t.testText(n):(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>n.startsWith(s))}function rc(n,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>Cp(n,t,e,i))}function Cp(n,t,e,s){if(s instanceof ArrayBuffer)return Mf(s,n,s.byteLength);switch(typeof s){case"function":return s(n);case"string":const i=To(n,t,s.length);return s===i;default:return!1}}function jl(n,t=5){return typeof n=="string"?n.slice(0,t):ArrayBuffer.isView(n)?To(n.buffer,n.byteOffset,t):n instanceof ArrayBuffer?To(n,0,t):""}function To(n,t,e){if(n.byteLength<t+e)return"";const s=new DataView(n);let i="";for(let r=0;r<e;r++)i+=String.fromCharCode(s.getUint8(t+r));return i}const _p=256*1024;function*Sp(n,t){const e=(t==null?void 0:t.chunkSize)||_p;let s=0;const i=new TextEncoder;for(;s<n.length;){const r=Math.min(n.length-s,e),o=n.slice(s,s+r);s+=r,yield i.encode(o)}}const Fp=256*1024;function*Rp(n,t={}){const{chunkSize:e=Fp}=t;let s=0;for(;s<n.byteLength;){const i=Math.min(n.byteLength-s,e),r=new ArrayBuffer(i),o=new Uint8Array(n,s,i);new Uint8Array(r).set(o),s+=i,yield r}}const Ip=1024*1024;async function*Dp(n,t){const e=(t==null?void 0:t.chunkSize)||Ip;let s=0;for(;s<n.size;){const i=s+e,r=await n.slice(s,i).arrayBuffer();s=i,yield r}}function oc(n,t){return Vi?Op(n,t):Lp(n)}async function*Op(n,t){const e=n.getReader();let s;try{for(;;){const i=s||e.read();t!=null&&t._streamReadAhead&&(s=e.read());const{done:r,value:o}=await i;if(r)return;yield Dl(o)}}catch{e.releaseLock()}}async function*Lp(n,t){for await(const e of n)yield Dl(e)}function Np(n,t){if(typeof n=="string")return Sp(n,t);if(n instanceof ArrayBuffer)return Rp(n,t);if(Qe(n))return Dp(n,t);if(Ll(n))return oc(n,t);if(Xe(n))return oc(n.body,t);throw new Error("makeIterator")}const Vl="Cannot convert supplied data type";function kp(n,t,e){if(t.text&&typeof n=="string")return n;if(Jf(n)&&(n=n.buffer),n instanceof ArrayBuffer){const s=n;return t.text&&!t.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(n)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(n);let s=n.buffer;const i=n.byteLength||n.length;return(n.byteOffset!==0||i!==s.byteLength)&&(s=s.slice(n.byteOffset,n.byteOffset+i)),s}throw new Error(Vl)}async function Pp(n,t,e){const s=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||s)return kp(n,t);if(Qe(n)&&(n=await kl(n)),Xe(n)){const i=n;return await ep(i),t.binary?await i.arrayBuffer():await i.text()}if(Ll(n)&&(n=Np(n,e)),jf(n)||Vf(n))return Sf(n);throw new Error(Vl)}function Jl(n,t){const e=vl(),s=n||e;return typeof s.fetch=="function"?s.fetch:Mn(s.fetch)?i=>tc(i,s.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:tc}function Gp(n,t,e){if(e)return e;const s={fetch:Jl(t,n),...n};if(s.url){const i=na(s.url);s.baseUrl=i,s.queryString=$f(s.url),s.filename=Ol(i),s.baseUrl=sa(i)}return Array.isArray(s.loaders)||(s.loaders=null),s}function vp(n,t){if(n&&!Array.isArray(n))return n;let e;if(n&&(e=Array.isArray(n)?n:[n]),t&&t.loaders){const s=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...s]:s}return e&&e.length?e:void 0}async function _i(n,t,e,s){t&&!Array.isArray(t)&&!ra(t)&&(s=void 0,e=t,t=void 0),n=await n,e=e||{};const i=Ji(n),o=vp(t,s),a=await Ap(n,o,e);return a?(e=up(e,a,o,i),s=Gp({url:i,_parse:_i,loaders:o},e,s||null),await Up(a,n,e,s)):null}async function Up(n,t,e,s){if(ff(n),e=Zd(n.options,e),Xe(t)){const r=t,{ok:o,redirected:a,status:c,statusText:h,type:l,url:u}=r,d=Object.fromEntries(r.headers.entries());s.response={headers:d,ok:o,redirected:a,status:c,statusText:h,type:l,url:u}}t=await Pp(t,n,e);const i=n;if(i.parseTextSync&&typeof t=="string")return i.parseTextSync(t,e,s);if(Af(n,e))return await xf(n,t,e,s,_i);if(i.parseText&&typeof t=="string")return await i.parseText(t,e,s);if(i.parse)return await i.parse(t,e,s);throw ge(!i.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}function zp(n){switch(n.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Hp(n){let t=1/0,e=1/0,s=1/0,i=-1/0,r=-1/0,o=-1/0;const a=n.POSITION?n.POSITION.value:[],c=a&&a.length;for(let h=0;h<c;h+=3){const l=a[h],u=a[h+1],d=a[h+2];t=l<t?l:t,e=u<e?u:e,s=d<s?d:s,i=l>i?l:i,r=u>r?u:r,o=d>o?d:o}return[[t,e,s],[i,r,o]]}function jp(n,t,e){const s=zp(t.value),i=e||Vp(t);return{name:n,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:s}]},nullable:!1,metadata:i}}function Vp(n){const t={};return"byteOffset"in n&&(t.byteOffset=n.byteOffset.toString(10)),"byteStride"in n&&(t.byteStride=n.byteStride.toString(10)),"normalized"in n&&(t.normalized=n.normalized.toString()),t}async function En(n,t,e,s){let i,r;!Array.isArray(t)&&!ra(t)?(i=[],r=t):(i=t,r=e);const o=Jl(r);let a=n;return typeof n=="string"&&(a=await o(n)),Qe(n)&&(a=await o(n)),Array.isArray(i)?await _i(a,i,r):await _i(a,i,r)}const Jp=1/Math.PI*180,Wp=1/180*Math.PI,qp={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...qp}};const Z=globalThis.mathgl.config;function Kp(n,{precision:t=Z.precision}={}){return n=$p(n),`${parseFloat(n.toPrecision(t))}`}function qe(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Xp(n){return Yp(n)}function Qp(n){return Gt(n)}function Yp(n,t){return oa(n,e=>e*Wp,t)}function Gt(n,t){return oa(n,e=>e*Jp,t)}function pn(n,t,e){return oa(n,s=>Math.max(t,Math.min(e,s)))}function te(n,t,e){const s=Z.EPSILON;e&&(Z.EPSILON=e);try{if(n===t)return!0;if(qe(n)&&qe(t)){if(n.length!==t.length)return!1;for(let i=0;i<n.length;++i)if(!te(n[i],t[i]))return!1;return!0}return n&&n.equals?n.equals(t):t&&t.equals?t.equals(n):typeof n=="number"&&typeof t=="number"?Math.abs(n-t)<=Z.EPSILON*Math.max(1,Math.abs(n),Math.abs(t)):!1}finally{Z.EPSILON=s}}function $p(n){return Math.round(n/Z.EPSILON)*Z.EPSILON}function Zp(n){return n.clone?n.clone():new Array(n.length)}function oa(n,t,e){if(qe(n)){const s=n;e=e||Zp(s);for(let i=0;i<e.length&&i<s.length;++i){const r=typeof n=="number"?n:n[i];e[i]=t(r,i,e)}return e}return t(n)}class aa extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,e=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=t[s+e];return this.check()}toArray(t=[],e=0){for(let s=0;s<this.ELEMENTS;++s)t[e+s]=this[s];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:qe(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Z)}formatString(t){let e="";for(let s=0;s<this.ELEMENTS;++s)e+=(s>0?", ":"")+Kp(this[s],t);return`${t.printTypes?this.constructor.name:""}[${e}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!te(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,s){if(s===void 0)return this.lerp(this,t,e);for(let i=0;i<this.ELEMENTS;++i){const r=t[i],o=typeof e=="number"?e:e[i];this[i]=r+s*(o-r)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t[s]),e[s]);return this.check()}add(...t){for(const e of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=e[s];return this.check()}subtract(...t){for(const e of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=e[s];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(Z.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t),e);return this.check()}get elements(){return this}}function tm(n,t){if(n.length!==t)return!1;for(let e=0;e<n.length;++e)if(!Number.isFinite(n[e]))return!1;return!0}function v(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function an(n,t,e=""){if(Z.debug&&!tm(n,t))throw new Error(`math.gl: ${e} some fields set to invalid numbers'`);return n}function vt(n,t){if(!n)throw new Error(`math.gl assertion ${t}`)}class ca extends aa{get x(){return this[0]}set x(t){this[0]=v(t)}get y(){return this[1]}set y(t){this[1]=v(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let s=0;s<this.ELEMENTS;++s){const i=this[s]-t[s];e+=i*i}return v(e)}dot(t){let e=0;for(let s=0;s<this.ELEMENTS;++s)e+=this[s]*t[s];return v(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=e[s];return this.check()}divide(...t){for(const e of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=e[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return vt(t>=0&&t<this.ELEMENTS,"index is out of range"),v(this[t])}setComponent(t,e){return vt(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}const cn=1e-6;let qt=typeof Float32Array<"u"?Float32Array:Array;function em(){const n=new qt(2);return qt!=Float32Array&&(n[0]=0,n[1]=0),n}function ac(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n}function sm(n,t){return n[0]=-t[0],n[1]=-t[1],n}function Wl(n,t,e,s){const i=t[0],r=t[1];return n[0]=i+s*(e[0]-i),n[1]=r+s*(e[1]-r),n}function nm(n,t,e){const s=t[0],i=t[1];return n[0]=e[0]*s+e[2]*i,n[1]=e[1]*s+e[3]*i,n}function im(n,t,e){const s=t[0],i=t[1];return n[0]=e[0]*s+e[2]*i+e[4],n[1]=e[1]*s+e[3]*i+e[5],n}function ql(n,t,e){const s=t[0],i=t[1];return n[0]=e[0]*s+e[3]*i+e[6],n[1]=e[1]*s+e[4]*i+e[7],n}function Kl(n,t,e){const s=t[0],i=t[1];return n[0]=e[0]*s+e[4]*i+e[12],n[1]=e[1]*s+e[5]*i+e[13],n}(function(){const n=em();return function(t,e,s,i,r,o){let a,c;for(e||(e=2),s||(s=0),i?c=Math.min(i*e+s,t.length):c=t.length,a=s;a<c;a+=e)n[0]=t[a],n[1]=t[a+1],r(n,n,o),t[a]=n[0],t[a+1]=n[1];return t}})();function Xl(n,t,e){const s=t[0],i=t[1],r=e[3]*s+e[7]*i||1;return n[0]=(e[0]*s+e[4]*i)/r,n[1]=(e[1]*s+e[5]*i)/r,n}function Ql(n,t,e){const s=t[0],i=t[1],r=t[2],o=e[3]*s+e[7]*i+e[11]*r||1;return n[0]=(e[0]*s+e[4]*i+e[8]*r)/o,n[1]=(e[1]*s+e[5]*i+e[9]*r)/o,n[2]=(e[2]*s+e[6]*i+e[10]*r)/o,n}function rm(n,t,e){const s=t[0],i=t[1];return n[0]=e[0]*s+e[2]*i,n[1]=e[1]*s+e[3]*i,n[2]=t[2],n}function om(n,t,e){const s=t[0],i=t[1];return n[0]=e[0]*s+e[2]*i,n[1]=e[1]*s+e[3]*i,n[2]=t[2],n[3]=t[3],n}function Yl(n,t,e){const s=t[0],i=t[1],r=t[2];return n[0]=e[0]*s+e[3]*i+e[6]*r,n[1]=e[1]*s+e[4]*i+e[7]*r,n[2]=e[2]*s+e[5]*i+e[8]*r,n[3]=t[3],n}let ha=class extends ca{constructor(t=0,e=0){super(2),qe(t)&&arguments.length===1?this.copy(t):(Z.debug&&(v(t),v(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return Z.debug&&(v(t.x),v(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Kl(this,this,t),this.check()}transformAsVector(t){return Xl(this,this,t),this.check()}transformByMatrix3(t){return ql(this,this,t),this.check()}transformByMatrix2x3(t){return im(this,this,t),this.check()}transformByMatrix2(t){return nm(this,this,t),this.check()}};function $l(){const n=new qt(3);return qt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Zl(n){const t=n[0],e=n[1],s=n[2];return Math.sqrt(t*t+e*e+s*s)}function cc(n,t,e){const s=new qt(3);return s[0]=n,s[1]=t,s[2]=e,s}function am(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function cm(n,t){const e=t[0],s=t[1],i=t[2];let r=e*e+s*s+i*i;return r>0&&(r=1/Math.sqrt(r)),n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n}function la(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function xi(n,t,e){const s=t[0],i=t[1],r=t[2],o=e[0],a=e[1],c=e[2];return n[0]=i*c-r*a,n[1]=r*o-s*c,n[2]=s*a-i*o,n}function ua(n,t,e){const s=t[0],i=t[1],r=t[2];let o=e[3]*s+e[7]*i+e[11]*r+e[15];return o=o||1,n[0]=(e[0]*s+e[4]*i+e[8]*r+e[12])/o,n[1]=(e[1]*s+e[5]*i+e[9]*r+e[13])/o,n[2]=(e[2]*s+e[6]*i+e[10]*r+e[14])/o,n}function tu(n,t,e){const s=t[0],i=t[1],r=t[2];return n[0]=s*e[0]+i*e[3]+r*e[6],n[1]=s*e[1]+i*e[4]+r*e[7],n[2]=s*e[2]+i*e[5]+r*e[8],n}function eu(n,t,e){const s=e[0],i=e[1],r=e[2],o=e[3],a=t[0],c=t[1],h=t[2];let l=i*h-r*c,u=r*a-s*h,d=s*c-i*a,f=i*d-r*u,p=r*l-s*d,m=s*u-i*l;const g=o*2;return l*=g,u*=g,d*=g,f*=2,p*=2,m*=2,n[0]=a+l+f,n[1]=c+u+p,n[2]=h+d+m,n}function hm(n,t,e,s){const i=[],r=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],r[0]=i[0],r[1]=i[1]*Math.cos(s)-i[2]*Math.sin(s),r[2]=i[1]*Math.sin(s)+i[2]*Math.cos(s),n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function lm(n,t,e,s){const i=[],r=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],r[0]=i[2]*Math.sin(s)+i[0]*Math.cos(s),r[1]=i[1],r[2]=i[2]*Math.cos(s)-i[0]*Math.sin(s),n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function um(n,t,e,s){const i=[],r=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],r[0]=i[0]*Math.cos(s)-i[1]*Math.sin(s),r[1]=i[0]*Math.sin(s)+i[1]*Math.cos(s),r[2]=i[2],n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function dm(n,t){const e=n[0],s=n[1],i=n[2],r=t[0],o=t[1],a=t[2],c=Math.sqrt((e*e+s*s+i*i)*(r*r+o*o+a*a)),h=c&&la(n,t)/c;return Math.acos(Math.min(Math.max(h,-1),1))}const fm=Zl;(function(){const n=$l();return function(t,e,s,i,r,o){let a,c;for(e||(e=3),s||(s=0),i?c=Math.min(i*e+s,t.length):c=t.length,a=s;a<c;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],r(n,n,o),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2];return t}})();const ur=[0,0,0];let Dn,w=class su extends ca{static get ZERO(){return Dn||(Dn=new su(0,0,0),Object.freeze(Dn)),Dn}constructor(t=0,e=0,s=0){super(-0,-0,-0),arguments.length===1&&qe(t)?this.copy(t):(Z.debug&&(v(t),v(e),v(s)),this[0]=t,this[1]=e,this[2]=s)}set(t,e,s){return this[0]=t,this[1]=e,this[2]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Z.debug&&(v(t.x),v(t.y),v(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=v(t)}angle(t){return dm(this,t)}cross(t){return xi(this,this,t),this.check()}rotateX({radians:t,origin:e=ur}){return hm(this,this,e,t),this.check()}rotateY({radians:t,origin:e=ur}){return lm(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=ur}){return um(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return ua(this,this,t),this.check()}transformAsVector(t){return Ql(this,this,t),this.check()}transformByMatrix3(t){return tu(this,this,t),this.check()}transformByMatrix2(t){return rm(this,this,t),this.check()}transformByQuaternion(t){return eu(this,this,t),this.check()}},On,pm=class nu extends ca{static get ZERO(){return On||(On=new nu(0,0,0,0),Object.freeze(On)),On}constructor(t=0,e=0,s=0,i=0){super(-0,-0,-0,-0),qe(t)&&arguments.length===1?this.copy(t):(Z.debug&&(v(t),v(e),v(s),v(i)),this[0]=t,this[1]=e,this[2]=s,this[3]=i)}set(t,e,s,i){return this[0]=t,this[1]=e,this[2]=s,this[3]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return Z.debug&&(v(t.x),v(t.y),v(t.z),v(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=v(t)}get w(){return this[3]}set w(t){this[3]=v(t)}transform(t){return ua(this,this,t),this.check()}transformByMatrix3(t){return Yl(this,this,t),this.check()}transformByMatrix2(t){return om(this,this,t),this.check()}transformByQuaternion(t){return eu(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}};class iu extends aa{toString(){let t="[";if(Z.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let s=0;s<this.RANK;++s)t+=` ${this[s*this.RANK+e]}`}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=` ${this[e]}`}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,s){return this[e*this.RANK+t]=v(s),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const s=t*this.RANK;for(let i=0;i<this.RANK;++i)e[i]=this[s+i];return e}setColumn(t,e){const s=t*this.RANK;for(let i=0;i<this.RANK;++i)this[s+i]=e[i];return this}}function mm(){const n=new qt(9);return qt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function bm(n,t){if(n===t){const e=t[1],s=t[2],i=t[5];n[1]=t[3],n[2]=t[6],n[3]=e,n[5]=t[7],n[6]=s,n[7]=i}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n}function gm(n,t){const e=t[0],s=t[1],i=t[2],r=t[3],o=t[4],a=t[5],c=t[6],h=t[7],l=t[8],u=l*o-a*h,d=-l*r+a*c,f=h*r-o*c;let p=e*u+s*d+i*f;return p?(p=1/p,n[0]=u*p,n[1]=(-l*s+i*h)*p,n[2]=(a*s-i*o)*p,n[3]=d*p,n[4]=(l*e-i*c)*p,n[5]=(-a*e+i*r)*p,n[6]=f*p,n[7]=(-h*e+s*c)*p,n[8]=(o*e-s*r)*p,n):null}function ym(n){const t=n[0],e=n[1],s=n[2],i=n[3],r=n[4],o=n[5],a=n[6],c=n[7],h=n[8];return t*(h*r-o*c)+e*(-h*i+o*a)+s*(c*i-r*a)}function hc(n,t,e){const s=t[0],i=t[1],r=t[2],o=t[3],a=t[4],c=t[5],h=t[6],l=t[7],u=t[8],d=e[0],f=e[1],p=e[2],m=e[3],g=e[4],b=e[5],y=e[6],x=e[7],A=e[8];return n[0]=d*s+f*o+p*h,n[1]=d*i+f*a+p*l,n[2]=d*r+f*c+p*u,n[3]=m*s+g*o+b*h,n[4]=m*i+g*a+b*l,n[5]=m*r+g*c+b*u,n[6]=y*s+x*o+A*h,n[7]=y*i+x*a+A*l,n[8]=y*r+x*c+A*u,n}function Am(n,t,e){const s=t[0],i=t[1],r=t[2],o=t[3],a=t[4],c=t[5],h=t[6],l=t[7],u=t[8],d=e[0],f=e[1];return n[0]=s,n[1]=i,n[2]=r,n[3]=o,n[4]=a,n[5]=c,n[6]=d*s+f*o+h,n[7]=d*i+f*a+l,n[8]=d*r+f*c+u,n}function xm(n,t,e){const s=t[0],i=t[1],r=t[2],o=t[3],a=t[4],c=t[5],h=t[6],l=t[7],u=t[8],d=Math.sin(e),f=Math.cos(e);return n[0]=f*s+d*o,n[1]=f*i+d*a,n[2]=f*r+d*c,n[3]=f*o-d*s,n[4]=f*a-d*i,n[5]=f*c-d*r,n[6]=h,n[7]=l,n[8]=u,n}function lc(n,t,e){const s=e[0],i=e[1];return n[0]=s*t[0],n[1]=s*t[1],n[2]=s*t[2],n[3]=i*t[3],n[4]=i*t[4],n[5]=i*t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n}function Tm(n,t){const e=t[0],s=t[1],i=t[2],r=t[3],o=e+e,a=s+s,c=i+i,h=e*o,l=s*o,u=s*a,d=i*o,f=i*a,p=i*c,m=r*o,g=r*a,b=r*c;return n[0]=1-u-p,n[3]=l-b,n[6]=d+g,n[1]=l+b,n[4]=1-h-p,n[7]=f-m,n[2]=d-g,n[5]=f+m,n[8]=1-h-u,n}var Bo;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(Bo||(Bo={}));const Bm=Object.freeze([1,0,0,0,1,0,0,0,1]);let q=class extends iu{static get IDENTITY(){return Mm()}static get ZERO(){return wm()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Bo}constructor(t,...e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):e.length>0?this.copy([t,...e]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(Bm)}fromObject(t){return this.check()}fromQuaternion(t){return Tm(this,t),this.check()}set(t,e,s,i,r,o,a,c,h){return this[0]=t,this[1]=e,this[2]=s,this[3]=i,this[4]=r,this[5]=o,this[6]=a,this[7]=c,this[8]=h,this.check()}setRowMajor(t,e,s,i,r,o,a,c,h){return this[0]=t,this[1]=i,this[2]=a,this[3]=e,this[4]=r,this[5]=c,this[6]=s,this[7]=o,this[8]=h,this.check()}determinant(){return ym(this)}transpose(){return bm(this,this),this.check()}invert(){return gm(this,this),this.check()}multiplyLeft(t){return hc(this,t,this),this.check()}multiplyRight(t){return hc(this,this,t),this.check()}rotate(t){return xm(this,this,t),this.check()}scale(t){return Array.isArray(t)?lc(this,this,t):lc(this,this,[t,t]),this.check()}translate(t){return Am(this,this,t),this.check()}transform(t,e){let s;switch(t.length){case 2:s=ql(e||[-0,-0],t,this);break;case 3:s=tu(e||[-0,-0,-0],t,this);break;case 4:s=Yl(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return an(s,t.length),s}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}},Ln,Nn=null;function wm(){return Ln||(Ln=new q([0,0,0,0,0,0,0,0,0]),Object.freeze(Ln)),Ln}function Mm(){return Nn||(Nn=new q,Object.freeze(Nn)),Nn}function Em(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Cm(n,t){if(n===t){const e=t[1],s=t[2],i=t[3],r=t[6],o=t[7],a=t[11];n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=e,n[6]=t[9],n[7]=t[13],n[8]=s,n[9]=r,n[11]=t[14],n[12]=i,n[13]=o,n[14]=a}else n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15];return n}function wo(n,t){const e=t[0],s=t[1],i=t[2],r=t[3],o=t[4],a=t[5],c=t[6],h=t[7],l=t[8],u=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],b=t[15],y=e*a-s*o,x=e*c-i*o,A=e*h-r*o,B=s*c-i*a,E=s*h-r*a,C=i*h-r*c,S=l*m-u*p,F=l*g-d*p,R=l*b-f*p,I=u*g-d*m,G=u*b-f*m,N=d*b-f*g;let D=y*N-x*G+A*I+B*R-E*F+C*S;return D?(D=1/D,n[0]=(a*N-c*G+h*I)*D,n[1]=(i*G-s*N-r*I)*D,n[2]=(m*C-g*E+b*B)*D,n[3]=(d*E-u*C-f*B)*D,n[4]=(c*R-o*N-h*F)*D,n[5]=(e*N-i*R+r*F)*D,n[6]=(g*A-p*C-b*x)*D,n[7]=(l*C-d*A+f*x)*D,n[8]=(o*G-a*R+h*S)*D,n[9]=(s*R-e*G-r*S)*D,n[10]=(p*E-m*A+b*y)*D,n[11]=(u*A-l*E-f*y)*D,n[12]=(a*F-o*I-c*S)*D,n[13]=(e*I-s*F+i*S)*D,n[14]=(m*x-p*B-g*y)*D,n[15]=(l*B-u*x+d*y)*D,n):null}function _m(n){const t=n[0],e=n[1],s=n[2],i=n[3],r=n[4],o=n[5],a=n[6],c=n[7],h=n[8],l=n[9],u=n[10],d=n[11],f=n[12],p=n[13],m=n[14],g=n[15],b=t*o-e*r,y=t*a-s*r,x=e*a-s*o,A=h*p-l*f,B=h*m-u*f,E=l*m-u*p,C=t*E-e*B+s*A,S=r*E-o*B+a*A,F=h*x-l*y+u*b,R=f*x-p*y+m*b;return c*C-i*S+g*F-d*R}function hn(n,t,e){const s=t[0],i=t[1],r=t[2],o=t[3],a=t[4],c=t[5],h=t[6],l=t[7],u=t[8],d=t[9],f=t[10],p=t[11],m=t[12],g=t[13],b=t[14],y=t[15];let x=e[0],A=e[1],B=e[2],E=e[3];return n[0]=x*s+A*a+B*u+E*m,n[1]=x*i+A*c+B*d+E*g,n[2]=x*r+A*h+B*f+E*b,n[3]=x*o+A*l+B*p+E*y,x=e[4],A=e[5],B=e[6],E=e[7],n[4]=x*s+A*a+B*u+E*m,n[5]=x*i+A*c+B*d+E*g,n[6]=x*r+A*h+B*f+E*b,n[7]=x*o+A*l+B*p+E*y,x=e[8],A=e[9],B=e[10],E=e[11],n[8]=x*s+A*a+B*u+E*m,n[9]=x*i+A*c+B*d+E*g,n[10]=x*r+A*h+B*f+E*b,n[11]=x*o+A*l+B*p+E*y,x=e[12],A=e[13],B=e[14],E=e[15],n[12]=x*s+A*a+B*u+E*m,n[13]=x*i+A*c+B*d+E*g,n[14]=x*r+A*h+B*f+E*b,n[15]=x*o+A*l+B*p+E*y,n}function Si(n,t,e){const s=e[0],i=e[1],r=e[2];let o,a,c,h,l,u,d,f,p,m,g,b;return t===n?(n[12]=t[0]*s+t[4]*i+t[8]*r+t[12],n[13]=t[1]*s+t[5]*i+t[9]*r+t[13],n[14]=t[2]*s+t[6]*i+t[10]*r+t[14],n[15]=t[3]*s+t[7]*i+t[11]*r+t[15]):(o=t[0],a=t[1],c=t[2],h=t[3],l=t[4],u=t[5],d=t[6],f=t[7],p=t[8],m=t[9],g=t[10],b=t[11],n[0]=o,n[1]=a,n[2]=c,n[3]=h,n[4]=l,n[5]=u,n[6]=d,n[7]=f,n[8]=p,n[9]=m,n[10]=g,n[11]=b,n[12]=o*s+l*i+p*r+t[12],n[13]=a*s+u*i+m*r+t[13],n[14]=c*s+d*i+g*r+t[14],n[15]=h*s+f*i+b*r+t[15]),n}function da(n,t,e){const s=e[0],i=e[1],r=e[2];return n[0]=t[0]*s,n[1]=t[1]*s,n[2]=t[2]*s,n[3]=t[3]*s,n[4]=t[4]*i,n[5]=t[5]*i,n[6]=t[6]*i,n[7]=t[7]*i,n[8]=t[8]*r,n[9]=t[9]*r,n[10]=t[10]*r,n[11]=t[11]*r,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function Sm(n,t,e,s){let i=s[0],r=s[1],o=s[2],a=Math.sqrt(i*i+r*r+o*o),c,h,l,u,d,f,p,m,g,b,y,x,A,B,E,C,S,F,R,I,G,N,D,st;return a<cn?null:(a=1/a,i*=a,r*=a,o*=a,h=Math.sin(e),c=Math.cos(e),l=1-c,u=t[0],d=t[1],f=t[2],p=t[3],m=t[4],g=t[5],b=t[6],y=t[7],x=t[8],A=t[9],B=t[10],E=t[11],C=i*i*l+c,S=r*i*l+o*h,F=o*i*l-r*h,R=i*r*l-o*h,I=r*r*l+c,G=o*r*l+i*h,N=i*o*l+r*h,D=r*o*l-i*h,st=o*o*l+c,n[0]=u*C+m*S+x*F,n[1]=d*C+g*S+A*F,n[2]=f*C+b*S+B*F,n[3]=p*C+y*S+E*F,n[4]=u*R+m*I+x*G,n[5]=d*R+g*I+A*G,n[6]=f*R+b*I+B*G,n[7]=p*R+y*I+E*G,n[8]=u*N+m*D+x*st,n[9]=d*N+g*D+A*st,n[10]=f*N+b*D+B*st,n[11]=p*N+y*D+E*st,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n)}function ru(n,t,e){const s=Math.sin(e),i=Math.cos(e),r=t[4],o=t[5],a=t[6],c=t[7],h=t[8],l=t[9],u=t[10],d=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=r*i+h*s,n[5]=o*i+l*s,n[6]=a*i+u*s,n[7]=c*i+d*s,n[8]=h*i-r*s,n[9]=l*i-o*s,n[10]=u*i-a*s,n[11]=d*i-c*s,n}function Fm(n,t,e){const s=Math.sin(e),i=Math.cos(e),r=t[0],o=t[1],a=t[2],c=t[3],h=t[8],l=t[9],u=t[10],d=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=r*i-h*s,n[1]=o*i-l*s,n[2]=a*i-u*s,n[3]=c*i-d*s,n[8]=r*s+h*i,n[9]=o*s+l*i,n[10]=a*s+u*i,n[11]=c*s+d*i,n}function ou(n,t,e){const s=Math.sin(e),i=Math.cos(e),r=t[0],o=t[1],a=t[2],c=t[3],h=t[4],l=t[5],u=t[6],d=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=r*i+h*s,n[1]=o*i+l*s,n[2]=a*i+u*s,n[3]=c*i+d*s,n[4]=h*i-r*s,n[5]=l*i-o*s,n[6]=u*i-a*s,n[7]=d*i-c*s,n}function Rm(n,t){const e=t[0],s=t[1],i=t[2],r=t[4],o=t[5],a=t[6],c=t[8],h=t[9],l=t[10];return n[0]=Math.sqrt(e*e+s*s+i*i),n[1]=Math.sqrt(r*r+o*o+a*a),n[2]=Math.sqrt(c*c+h*h+l*l),n}function Im(n,t){const e=t[0],s=t[1],i=t[2],r=t[3],o=e+e,a=s+s,c=i+i,h=e*o,l=s*o,u=s*a,d=i*o,f=i*a,p=i*c,m=r*o,g=r*a,b=r*c;return n[0]=1-u-p,n[1]=l+b,n[2]=d-g,n[3]=0,n[4]=l-b,n[5]=1-h-p,n[6]=f+m,n[7]=0,n[8]=d+g,n[9]=f-m,n[10]=1-h-u,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Dm(n,t,e,s,i,r,o){const a=1/(e-t),c=1/(i-s),h=1/(r-o);return n[0]=r*2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r*2*c,n[6]=0,n[7]=0,n[8]=(e+t)*a,n[9]=(i+s)*c,n[10]=(o+r)*h,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*r*2*h,n[15]=0,n}function Om(n,t,e,s,i){const r=1/Math.tan(t/2);if(n[0]=r/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,i!=null&&i!==1/0){const o=1/(s-i);n[10]=(i+s)*o,n[14]=2*i*s*o}else n[10]=-1,n[14]=-2*s;return n}const Lm=Om;function Nm(n,t,e,s,i,r,o){const a=1/(t-e),c=1/(s-i),h=1/(r-o);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*c,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*h,n[11]=0,n[12]=(t+e)*a,n[13]=(i+s)*c,n[14]=(o+r)*h,n[15]=1,n}const km=Nm;function Pm(n,t,e,s){let i,r,o,a,c,h,l,u,d,f;const p=t[0],m=t[1],g=t[2],b=s[0],y=s[1],x=s[2],A=e[0],B=e[1],E=e[2];return Math.abs(p-A)<cn&&Math.abs(m-B)<cn&&Math.abs(g-E)<cn?Em(n):(u=p-A,d=m-B,f=g-E,i=1/Math.sqrt(u*u+d*d+f*f),u*=i,d*=i,f*=i,r=y*f-x*d,o=x*u-b*f,a=b*d-y*u,i=Math.sqrt(r*r+o*o+a*a),i?(i=1/i,r*=i,o*=i,a*=i):(r=0,o=0,a=0),c=d*a-f*o,h=f*r-u*a,l=u*o-d*r,i=Math.sqrt(c*c+h*h+l*l),i?(i=1/i,c*=i,h*=i,l*=i):(c=0,h=0,l=0),n[0]=r,n[1]=c,n[2]=u,n[3]=0,n[4]=o,n[5]=h,n[6]=d,n[7]=0,n[8]=a,n[9]=l,n[10]=f,n[11]=0,n[12]=-(r*p+o*m+a*g),n[13]=-(c*p+h*m+l*g),n[14]=-(u*p+d*m+f*g),n[15]=1,n)}function Gm(){const n=new qt(4);return qt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function vm(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n[3]=t[3]+e[3],n}function au(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function Um(n){const t=n[0],e=n[1],s=n[2],i=n[3];return Math.sqrt(t*t+e*e+s*s+i*i)}function zm(n){const t=n[0],e=n[1],s=n[2],i=n[3];return t*t+e*e+s*s+i*i}function Hm(n,t){const e=t[0],s=t[1],i=t[2],r=t[3];let o=e*e+s*s+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),n[0]=e*o,n[1]=s*o,n[2]=i*o,n[3]=r*o,n}function jm(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function Vm(n,t,e,s){const i=t[0],r=t[1],o=t[2],a=t[3];return n[0]=i+s*(e[0]-i),n[1]=r+s*(e[1]-r),n[2]=o+s*(e[2]-o),n[3]=a+s*(e[3]-a),n}function cu(n,t,e){const s=t[0],i=t[1],r=t[2],o=t[3];return n[0]=e[0]*s+e[4]*i+e[8]*r+e[12]*o,n[1]=e[1]*s+e[5]*i+e[9]*r+e[13]*o,n[2]=e[2]*s+e[6]*i+e[10]*r+e[14]*o,n[3]=e[3]*s+e[7]*i+e[11]*r+e[15]*o,n}function Jm(n,t,e){const s=t[0],i=t[1],r=t[2],o=e[0],a=e[1],c=e[2],h=e[3],l=h*s+a*r-c*i,u=h*i+c*s-o*r,d=h*r+o*i-a*s,f=-o*s-a*i-c*r;return n[0]=l*h+f*-o+u*-c-d*-a,n[1]=u*h+f*-a+d*-o-l*-c,n[2]=d*h+f*-c+l*-a-u*-o,n[3]=t[3],n}(function(){const n=Gm();return function(t,e,s,i,r,o){let a,c;for(e||(e=4),s||(s=0),i?c=Math.min(i*e+s,t.length):c=t.length,a=s;a<c;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],n[3]=t[a+3],r(n,n,o),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2],t[a+3]=n[3];return t}})();var Mo;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(Mo||(Mo={}));const Wm=45*Math.PI/180,qm=1,dr=.1,fr=500,Km=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);let V=class extends iu{static get IDENTITY(){return Qm()}static get ZERO(){return Xm()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Mo}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,s,i,r,o,a,c,h,l,u,d,f,p,m,g){return this[0]=t,this[1]=e,this[2]=s,this[3]=i,this[4]=r,this[5]=o,this[6]=a,this[7]=c,this[8]=h,this[9]=l,this[10]=u,this[11]=d,this[12]=f,this[13]=p,this[14]=m,this[15]=g,this.check()}setRowMajor(t,e,s,i,r,o,a,c,h,l,u,d,f,p,m,g){return this[0]=t,this[1]=r,this[2]=h,this[3]=f,this[4]=e,this[5]=o,this[6]=l,this[7]=p,this[8]=s,this[9]=a,this[10]=u,this[11]=m,this[12]=i,this[13]=c,this[14]=d,this[15]=g,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Km)}fromObject(t){return this.check()}fromQuaternion(t){return Im(this,t),this.check()}frustum(t){const{left:e,right:s,bottom:i,top:r,near:o=dr,far:a=fr}=t;return a===1/0?Ym(this,e,s,i,r,o):Dm(this,e,s,i,r,o,a),this.check()}lookAt(t){const{eye:e,center:s=[0,0,0],up:i=[0,1,0]}=t;return Pm(this,e,s,i),this.check()}ortho(t){const{left:e,right:s,bottom:i,top:r,near:o=dr,far:a=fr}=t;return km(this,e,s,i,r,o,a),this.check()}orthographic(t){const{fovy:e=Wm,aspect:s=qm,focalDistance:i=1,near:r=dr,far:o=fr}=t;uc(e);const a=e/2,c=i*Math.tan(a),h=c*s;return this.ortho({left:-h,right:h,bottom:-c,top:c,near:r,far:o})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:s=1,near:i=.1,far:r=500}=t;return uc(e),Lm(this,e,s,i,r),this.check()}determinant(){return _m(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const s=this.getScale(e),i=1/s[0],r=1/s[1],o=1/s[2];return t[0]=this[0]*i,t[1]=this[1]*r,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*i,t[5]=this[5]*r,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*i,t[9]=this[9]*r,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const s=this.getScale(e),i=1/s[0],r=1/s[1],o=1/s[2];return t[0]=this[0]*i,t[1]=this[1]*r,t[2]=this[2]*o,t[3]=this[4]*i,t[4]=this[5]*r,t[5]=this[6]*o,t[6]=this[8]*i,t[7]=this[9]*r,t[8]=this[10]*o,t}transpose(){return Cm(this,this),this.check()}invert(){return wo(this,this),this.check()}multiplyLeft(t){return hn(this,t,this),this.check()}multiplyRight(t){return hn(this,this,t),this.check()}rotateX(t){return ru(this,this,t),this.check()}rotateY(t){return Fm(this,this,t),this.check()}rotateZ(t){return ou(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return Sm(this,this,t,e),this.check()}scale(t){return da(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return Si(this,this,t),this.check()}transform(t,e){return t.length===4?(e=cu(e||[-0,-0,-0,-0],t,this),an(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:s}=t;let i;switch(s){case 2:i=Kl(e||[-0,-0],t,this);break;case 3:i=ua(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return an(i,t.length),i}transformAsVector(t,e){let s;switch(t.length){case 2:s=Xl(e||[-0,-0],t,this);break;case 3:s=Ql(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return an(s,t.length),s}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,s){return this.identity().translate([t,e,s])}},kn,Pn;function Xm(){return kn||(kn=new V([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(kn)),kn}function Qm(){return Pn||(Pn=new V,Object.freeze(Pn)),Pn}function uc(n){if(n>Math.PI*2)throw Error("expected radians")}function Ym(n,t,e,s,i,r){const o=2*r/(e-t),a=2*r/(i-s),c=(e+t)/(e-t),h=(i+s)/(i-s),l=-1,u=-1,d=-2*r;return n[0]=o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=c,n[9]=h,n[10]=l,n[11]=u,n[12]=0,n[13]=0,n[14]=d,n[15]=0,n}function dc(){const n=new qt(4);return qt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function $m(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function hu(n,t,e){e=e*.5;const s=Math.sin(e);return n[0]=s*t[0],n[1]=s*t[1],n[2]=s*t[2],n[3]=Math.cos(e),n}function fc(n,t,e){const s=t[0],i=t[1],r=t[2],o=t[3],a=e[0],c=e[1],h=e[2],l=e[3];return n[0]=s*l+o*a+i*h-r*c,n[1]=i*l+o*c+r*a-s*h,n[2]=r*l+o*h+s*c-i*a,n[3]=o*l-s*a-i*c-r*h,n}function Zm(n,t,e){e*=.5;const s=t[0],i=t[1],r=t[2],o=t[3],a=Math.sin(e),c=Math.cos(e);return n[0]=s*c+o*a,n[1]=i*c+r*a,n[2]=r*c-i*a,n[3]=o*c-s*a,n}function tb(n,t,e){e*=.5;const s=t[0],i=t[1],r=t[2],o=t[3],a=Math.sin(e),c=Math.cos(e);return n[0]=s*c-r*a,n[1]=i*c+o*a,n[2]=r*c+s*a,n[3]=o*c-i*a,n}function eb(n,t,e){e*=.5;const s=t[0],i=t[1],r=t[2],o=t[3],a=Math.sin(e),c=Math.cos(e);return n[0]=s*c+i*a,n[1]=i*c-s*a,n[2]=r*c+o*a,n[3]=o*c-r*a,n}function sb(n,t){const e=t[0],s=t[1],i=t[2];return n[0]=e,n[1]=s,n[2]=i,n[3]=Math.sqrt(Math.abs(1-e*e-s*s-i*i)),n}function Ti(n,t,e,s){const i=t[0],r=t[1],o=t[2],a=t[3];let c=e[0],h=e[1],l=e[2],u=e[3],d,f,p,m,g;return d=i*c+r*h+o*l+a*u,d<0&&(d=-d,c=-c,h=-h,l=-l,u=-u),1-d>cn?(f=Math.acos(d),g=Math.sin(f),p=Math.sin((1-s)*f)/g,m=Math.sin(s*f)/g):(p=1-s,m=s),n[0]=p*i+m*c,n[1]=p*r+m*h,n[2]=p*o+m*l,n[3]=p*a+m*u,n}function nb(n,t){const e=t[0],s=t[1],i=t[2],r=t[3],o=e*e+s*s+i*i+r*r,a=o?1/o:0;return n[0]=-e*a,n[1]=-s*a,n[2]=-i*a,n[3]=r*a,n}function ib(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n}function lu(n,t){const e=t[0]+t[4]+t[8];let s;if(e>0)s=Math.sqrt(e+1),n[3]=.5*s,s=.5/s,n[0]=(t[5]-t[7])*s,n[1]=(t[6]-t[2])*s,n[2]=(t[1]-t[3])*s;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);const r=(i+1)%3,o=(i+2)%3;s=Math.sqrt(t[i*3+i]-t[r*3+r]-t[o*3+o]+1),n[i]=.5*s,s=.5/s,n[3]=(t[r*3+o]-t[o*3+r])*s,n[r]=(t[r*3+i]+t[i*3+r])*s,n[o]=(t[o*3+i]+t[i*3+o])*s}return n}const rb=vm,ob=au,ab=jm,cb=Vm,hb=Um,lb=zm,uu=Hm,ub=function(){const n=$l(),t=cc(1,0,0),e=cc(0,1,0);return function(s,i,r){const o=la(i,r);return o<-.999999?(xi(n,t,i),fm(n)<1e-6&&xi(n,e,i),cm(n,n),hu(s,n,Math.PI),s):o>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(xi(n,i,r),s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=1+o,uu(s,s))}}();(function(){const n=dc(),t=dc();return function(e,s,i,r,o,a){return Ti(n,s,o,a),Ti(t,i,r,a),Ti(e,n,t,2*a*(1-a)),e}})();(function(){const n=mm();return function(t,e,s,i){return n[0]=s[0],n[3]=s[1],n[6]=s[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],uu(t,lu(t,n))}})();const db=[0,0,0,1];let Fi=class extends aa{constructor(t=0,e=0,s=0,i=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,s,i)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,s,i){return this[0]=t,this[1]=e,this[2]=s,this[3]=i,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return lu(this,t),this.check()}fromAxisRotation(t,e){return hu(this,t,e),this.check()}identity(){return $m(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=v(t)}get y(){return this[1]}set y(t){this[1]=v(t)}get z(){return this[2]}set z(t){this[2]=v(t)}get w(){return this[3]}set w(t){this[3]=v(t)}len(){return hb(this)}lengthSquared(){return lb(this)}dot(t){return ab(this,t)}rotationTo(t,e){return ub(this,t,e),this.check()}add(t){return rb(this,this,t),this.check()}calculateW(){return sb(this,this),this.check()}conjugate(){return ib(this,this),this.check()}invert(){return nb(this,this),this.check()}lerp(t,e,s){return s===void 0?this.lerp(this,t,e):(cb(this,t,e,s),this.check())}multiplyRight(t){return fc(this,this,t),this.check()}multiplyLeft(t){return fc(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return Zm(this,this,t),this.check()}rotateY(t){return tb(this,this,t),this.check()}rotateZ(t){return eb(this,this,t),this.check()}scale(t){return ob(this,this,t),this.check()}slerp(t,e,s){let i,r,o;switch(arguments.length){case 1:({start:i=db,target:r,ratio:o}=t);break;case 2:i=this,r=t,o=e;break;default:i=t,r=e,o=s}return Ti(this,i,r,o),this.check()}transformVector4(t,e=new pm){return Jm(e,t,this),an(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}};const fb=.1,pb=1e-12,du=1e-15,mb=1e-20,bb=6378137,gb=6378137,yb=6356752314245179e-9;function Wi(n){return n}new w;function Ab(n,t=[],e=Wi){return"longitude"in n?(t[0]=e(n.longitude),t[1]=e(n.latitude),t[2]=n.height):"x"in n?(t[0]=e(n.x),t[1]=e(n.y),t[2]=n.z):(t[0]=e(n[0]),t[1]=e(n[1]),t[2]=n[2]),t}function xb(n,t=[]){return Ab(n,t,Z._cartographicRadians?Wi:Xp)}function Tb(n,t,e=Wi){return"longitude"in t?(t.longitude=e(n[0]),t.latitude=e(n[1]),t.height=n[2]):"x"in t?(t.x=e(n[0]),t.y=e(n[1]),t.z=n[2]):(t[0]=e(n[0]),t[1]=e(n[1]),t[2]=n[2]),t}function Bb(n,t){return Tb(n,t,Z._cartographicRadians?Wi:Qp)}const pc=1e-14,wb=new w,mc={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},pr={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Hs={east:new w,north:new w,up:new w,west:new w,south:new w,down:new w},Mb=new w,Eb=new w,Cb=new w;function bc(n,t,e,s,i,r){const o=mc[t]&&mc[t][e];vt(o&&(!s||s===o));let a,c,h;const l=wb.copy(i);if(te(l.x,0,pc)&&te(l.y,0,pc)){const d=Math.sign(l.z);a=Mb.fromArray(pr[t]),t!=="east"&&t!=="west"&&a.scale(d),c=Eb.fromArray(pr[e]),e!=="east"&&e!=="west"&&c.scale(d),h=Cb.fromArray(pr[s]),s!=="east"&&s!=="west"&&h.scale(d)}else{const{up:d,east:f,north:p}=Hs;f.set(-l.y,l.x,0).normalize(),n.geodeticSurfaceNormal(l,d),p.copy(d).cross(f);const{down:m,west:g,south:b}=Hs;m.copy(d).scale(-1),g.copy(f).scale(-1),b.copy(p).scale(-1),a=Hs[t],c=Hs[e],h=Hs[s]}return r[0]=a.x,r[1]=a.y,r[2]=a.z,r[3]=0,r[4]=c.x,r[5]=c.y,r[6]=c.z,r[7]=0,r[8]=h.x,r[9]=h.y,r[10]=h.z,r[11]=0,r[12]=l.x,r[13]=l.y,r[14]=l.z,r[15]=1,r}const rs=new w,_b=new w,Sb=new w;function Fb(n,t,e=[]){const{oneOverRadii:s,oneOverRadiiSquared:i,centerToleranceSquared:r}=t;rs.from(n);const o=rs.x,a=rs.y,c=rs.z,h=s.x,l=s.y,u=s.z,d=o*o*h*h,f=a*a*l*l,p=c*c*u*u,m=d+f+p,g=Math.sqrt(1/m);if(!Number.isFinite(g))return;const b=_b;if(b.copy(n).scale(g),m<r)return b.to(e);const y=i.x,x=i.y,A=i.z,B=Sb;B.set(b.x*y*2,b.y*x*2,b.z*A*2);let E=(1-g)*rs.len()/(.5*B.len()),C=0,S,F,R,I;do{E-=C,S=1/(1+E*y),F=1/(1+E*x),R=1/(1+E*A);const G=S*S,N=F*F,D=R*R,st=G*S,Xt=N*F,Ot=D*R;I=d*G+f*N+p*D-1;const Le=-2*(d*st*y+f*Xt*x+p*Ot*A);C=I/Le}while(Math.abs(I)>pb);return rs.scale([S,F,R]).to(e)}const Gn=new w,gc=new w,Rb=new w,Lt=new w,Ib=new w,vn=new w;class J{constructor(t=0,e=0,s=0){this.centerToleranceSquared=fb,vt(t>=0),vt(e>=0),vt(s>=0),this.radii=new w(t,e,s),this.radiiSquared=new w(t*t,e*e,s*s),this.radiiToTheFourth=new w(t*t*t*t,e*e*e*e,s*s*s*s),this.oneOverRadii=new w(t===0?0:1/t,e===0?0:1/e,s===0?0:1/s),this.oneOverRadiiSquared=new w(t===0?0:1/(t*t),e===0?0:1/(e*e),s===0?0:1/(s*s)),this.minimumRadius=Math.min(t,e,s),this.maximumRadius=Math.max(t,e,s),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,e=[0,0,0]){const s=gc,i=Rb,[,,r]=t;this.geodeticSurfaceNormalCartographic(t,s),i.copy(this.radiiSquared).scale(s);const o=Math.sqrt(s.dot(i));return i.scale(1/o),s.scale(r),i.add(s),i.to(e)}cartesianToCartographic(t,e=[0,0,0]){vn.from(t);const s=this.scaleToGeodeticSurface(vn,Lt);if(!s)return;const i=this.geodeticSurfaceNormal(s,gc),r=Ib;r.copy(vn).subtract(s);const o=Math.atan2(i.y,i.x),a=Math.asin(i.z),c=Math.sign(la(r,vn))*Zl(r);return Bb([o,a,c],e)}eastNorthUpToFixedFrame(t,e=new V){return bc(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,s,i,r=new V){return bc(this,t,e,s,i,r)}geocentricSurfaceNormal(t,e=[0,0,0]){return Gn.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t,e=[0,0,0]){const s=xb(t),i=s[0],r=s[1],o=Math.cos(r);return Gn.set(o*Math.cos(i),o*Math.sin(i),Math.sin(r)).normalize(),Gn.to(e)}geodeticSurfaceNormal(t,e=[0,0,0]){return Gn.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return Fb(t,this,e)}scaleToGeocentricSurface(t,e=[0,0,0]){Lt.from(t);const s=Lt.x,i=Lt.y,r=Lt.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(s*s*o.x+i*i*o.y+r*r*o.z);return Lt.multiplyScalar(a).to(e)}transformPositionToScaledSpace(t,e=[0,0,0]){return Lt.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t,e=[0,0,0]){return Lt.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t,e=0,s=[0,0,0]){vt(te(this.radii.x,this.radii.y,du)),vt(this.radii.z>0),Lt.from(t);const i=Lt.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-e))return Lt.set(0,0,i).to(s)}}J.WGS84=new J(bb,gb,yb);class Db{constructor(t,e,s){T(this,"item");T(this,"previous");T(this,"next");this.item=t,this.previous=e,this.next=s}}class Ob{constructor(){T(this,"head",null);T(this,"tail",null);T(this,"_length",0)}get length(){return this._length}add(t){const e=new Db(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const s=t.next;t.next=e,this.tail===t?this.tail=e:s.previous=e,e.next=s,e.previous=t,++this._length}}class Lb{constructor(){T(this,"_list");T(this,"_sentinel");T(this,"_trimTiles");this._list=new Ob,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;e&&this._list.splice(this._sentinel,e)}add(t,e,s){e._cacheNode||(e._cacheNode=this._list.add(e),s&&s(t,e))}unloadTile(t,e,s){const i=e._cacheNode;i&&(this._list.remove(i),e._cacheNode=null,s&&s(t,e))}unloadTiles(t,e){const s=this._trimTiles;this._trimTiles=!1;const i=this._list,r=t.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=i.head;for(;a!==o&&(t.gpuMemoryUsageInBytes>r||s);){const c=a.item;a=a.next,this.unloadTile(t,c,e)}}trim(){this._trimTiles=!0}}function Nb(n,t){j(n),j(t);const{rtcCenter:e,gltfUpAxis:s}=t,{computedTransform:i,boundingVolume:{center:r}}=n;let o=new V(i);switch(e&&o.translate(e),s){case"Z":break;case"Y":const u=new V().rotateX(Math.PI/2);o=o.multiplyRight(u);break;case"X":const d=new V().rotateY(-Math.PI/2);o=o.multiplyRight(d);break}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const a=new w(r);t.cartesianModelMatrix=o,t.cartesianOrigin=a;const c=J.WGS84.cartesianToCartographic(a,new w),l=J.WGS84.eastNorthUpToFixedFrame(a).invert();t.cartographicModelMatrix=l.multiplyRight(o),t.cartographicOrigin=c,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const xt={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new w;new w;const js=new w,yc=new w;class Cn{constructor(t=[0,0,0],e=0){this.radius=-0,this.center=new w,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=js.from(e),this.center=new w().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Cn(this.center,this.radius)}union(t){const e=this.center,s=this.radius,i=t.center,r=t.radius,o=js.copy(i).subtract(e),a=o.magnitude();if(s>=a+r)return this.clone();if(r>=a+s)return t.clone();const c=(s+a+r)*.5;return yc.copy(o).scale((-s+c)/a).add(e),this.center.copy(yc),this.radius=c,this}expand(t){const s=js.from(t).subtract(this.center).magnitude();return s>this.radius&&(this.radius=s),this}transform(t){this.center.transform(t);const e=Rm(js,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const s=js.from(t).subtract(this.center);return Math.max(0,s.len()-this.radius)}intersectPlane(t){const e=this.center,s=this.radius,r=t.normal.dot(e)+t.distance;return r<-s?xt.OUTSIDE:r<s?xt.INTERSECTING:xt.INSIDE}}const kb=new w,Pb=new w,Un=new w,zn=new w,Hn=new w,Gb=new w,vb=new w,ae={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class _n{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){this.center=new w().from(t),this.halfAxes=new q(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2);return[new w(t).len(),new w(e).len(),new w(s).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2),i=new w(t).normalize(),r=new w(e).normalize(),o=new w(s).normalize();return new Fi().fromMatrix3(new q([...i,...r,...o]))}fromCenterHalfSizeQuaternion(t,e,s){const i=new Fi(s),r=new q().fromQuaternion(i);return r[0]=r[0]*e[0],r[1]=r[1]*e[0],r[2]=r[2]*e[0],r[3]=r[3]*e[1],r[4]=r[4]*e[1],r[5]=r[5]*e[1],r[6]=r[6]*e[2],r[7]=r[7]*e[2],r[8]=r[8]*e[2],this.center=new w().from(t),this.halfAxes=r,this}clone(){return new _n(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new Cn){const e=this.halfAxes,s=e.getColumn(0,Un),i=e.getColumn(1,zn),r=e.getColumn(2,Hn),o=kb.copy(s).add(i).add(r);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){const e=this.center,s=t.normal,i=this.halfAxes,r=s.x,o=s.y,a=s.z,c=Math.abs(r*i[ae.COLUMN0ROW0]+o*i[ae.COLUMN0ROW1]+a*i[ae.COLUMN0ROW2])+Math.abs(r*i[ae.COLUMN1ROW0]+o*i[ae.COLUMN1ROW1]+a*i[ae.COLUMN1ROW2])+Math.abs(r*i[ae.COLUMN2ROW0]+o*i[ae.COLUMN2ROW1]+a*i[ae.COLUMN2ROW2]),h=s.dot(e)+t.distance;return h<=-c?xt.OUTSIDE:h>=c?xt.INSIDE:xt.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=Pb.from(t).subtract(this.center),s=this.halfAxes,i=s.getColumn(0,Un),r=s.getColumn(1,zn),o=s.getColumn(2,Hn),a=i.magnitude(),c=r.magnitude(),h=o.magnitude();i.normalize(),r.normalize(),o.normalize();let l=0,u;return u=Math.abs(e.dot(i))-a,u>0&&(l+=u*u),u=Math.abs(e.dot(r))-c,u>0&&(l+=u*u),u=Math.abs(e.dot(o))-h,u>0&&(l+=u*u),l}computePlaneDistances(t,e,s=[-0,-0]){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,Un),h=a.getColumn(1,zn),l=a.getColumn(2,Hn),u=Gb.copy(c).add(h).add(l).add(o),d=vb.copy(u).subtract(t);let f=e.dot(d);return i=Math.min(f,i),r=Math.max(f,r),u.copy(o).add(c).add(h).subtract(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),u.copy(o).add(c).subtract(h).add(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),u.copy(o).add(c).subtract(h).subtract(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),o.copy(u).subtract(c).add(h).add(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),o.copy(u).subtract(c).add(h).subtract(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),o.copy(u).subtract(c).subtract(h).add(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),o.copy(u).subtract(c).subtract(h).subtract(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),s[0]=i,s[1]=r,s}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,Un);e.transformAsPoint(t);const s=this.halfAxes.getColumn(1,zn);s.transformAsPoint(t);const i=this.halfAxes.getColumn(2,Hn);return i.transformAsPoint(t),this.halfAxes=new q([...e,...s,...i]),this}getTransform(){throw new Error("not implemented")}}const Ac=new w,xc=new w;let Fe=class fu{constructor(t=[0,0,1],e=0){this.normal=new w,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return vt(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=Ac.from(t),this.normal.from(e).normalize();const s=-this.normal.dot(t);return this.distance=s,this}fromCoefficients(t,e,s,i){return this.normal.set(t,e,s),vt(te(this.normal.len(),1)),this.distance=i,this}clone(){return new fu(this.normal,this.distance)}equals(t){return te(this.distance,t.distance)&&te(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=xc.copy(this.normal).transformAsVector(t).normalize(),s=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(s,e)}projectPointOntoPlane(t,e=[0,0,0]){const s=Ac.from(t),i=this.getPointDistance(s),r=xc.copy(this.normal).scale(i);return s.subtract(r).to(e)}};const Tc=[new w([1,0,0]),new w([0,1,0]),new w([0,0,1])],Bc=new w,Ub=new w;class _t{constructor(t=[]){this.planes=t}fromBoundingSphere(t){this.planes.length=2*Tc.length;const e=t.center,s=t.radius;let i=0;for(const r of Tc){let o=this.planes[i],a=this.planes[i+1];o||(o=this.planes[i]=new Fe),a||(a=this.planes[i+1]=new Fe);const c=Bc.copy(r).scale(-s).add(e);o.fromPointNormal(c,r);const h=Bc.copy(r).scale(s).add(e),l=Ub.copy(r).negate();a.fromPointNormal(h,l),i+=2}return this}computeVisibility(t){let e=xt.INSIDE;for(const s of this.planes)switch(t.intersectPlane(s)){case xt.OUTSIDE:return xt.OUTSIDE;case xt.INTERSECTING:e=xt.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(vt(Number.isFinite(e),"parentPlaneMask is required."),e===_t.MASK_OUTSIDE||e===_t.MASK_INSIDE)return e;let s=_t.MASK_INSIDE;const i=this.planes;for(let r=0;r<this.planes.length;++r){const o=r<31?1<<r:0;if(r<31&&!(e&o))continue;const a=i[r],c=t.intersectPlane(a);if(c===xt.OUTSIDE)return _t.MASK_OUTSIDE;c===xt.INTERSECTING&&(s|=o)}return s}}_t.MASK_OUTSIDE=4294967295;_t.MASK_INSIDE=0;_t.MASK_INDETERMINATE=2147483647;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;new w;const Qt=new q,zb=new q,Hb=new q,jn=new q,wc=new q;function jb(n,t={}){const e=mb,s=10;let i=0,r=0;const o=zb,a=Hb;o.identity(),a.copy(n);const c=e*Vb(a);for(;r<s&&Jb(a)>c;)Wb(a,jn),wc.copy(jn).transpose(),a.multiplyRight(jn),a.multiplyLeft(wc),o.multiplyRight(jn),++i>2&&(++r,i=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=a.toTarget(t.diagonal),t}function Vb(n){let t=0;for(let e=0;e<9;++e){const s=n[e];t+=s*s}return Math.sqrt(t)}const Eo=[1,0,0],Co=[2,2,1];function Jb(n){let t=0;for(let e=0;e<3;++e){const s=n[Qt.getElementIndex(Co[e],Eo[e])];t+=2*s*s}return Math.sqrt(t)}function Wb(n,t){const e=du;let s=0,i=1;for(let h=0;h<3;++h){const l=Math.abs(n[Qt.getElementIndex(Co[h],Eo[h])]);l>s&&(i=h,s=l)}const r=Eo[i],o=Co[i];let a=1,c=0;if(Math.abs(n[Qt.getElementIndex(o,r)])>e){const h=n[Qt.getElementIndex(o,o)],l=n[Qt.getElementIndex(r,r)],u=n[Qt.getElementIndex(o,r)],d=(h-l)/2/u;let f;d<0?f=-1/(-d+Math.sqrt(1+d*d)):f=1/(d+Math.sqrt(1+d*d)),a=1/Math.sqrt(1+f*f),c=f*a}return q.IDENTITY.to(t),t[Qt.getElementIndex(r,r)]=t[Qt.getElementIndex(o,o)]=a,t[Qt.getElementIndex(o,r)]=c,t[Qt.getElementIndex(r,o)]=-c,t}const xe=new w,qb=new w,Kb=new w,Xb=new w,Qb=new w,Yb=new q,$b={diagonal:new q,unitary:new q};function Zb(n,t=new _n){if(!n||n.length===0)return t.halfAxes=new q([0,0,0,0,0,0,0,0,0]),t.center=new w,t;const e=n.length,s=new w(0,0,0);for(const F of n)s.add(F);const i=1/e;s.multiplyByScalar(i);let r=0,o=0,a=0,c=0,h=0,l=0;for(const F of n){const R=xe.copy(F).subtract(s);r+=R.x*R.x,o+=R.x*R.y,a+=R.x*R.z,c+=R.y*R.y,h+=R.y*R.z,l+=R.z*R.z}r*=i,o*=i,a*=i,c*=i,h*=i,l*=i;const u=Yb;u[0]=r,u[1]=o,u[2]=a,u[3]=o,u[4]=c,u[5]=h,u[6]=a,u[7]=h,u[8]=l;const{unitary:d}=jb(u,$b),f=t.halfAxes.copy(d);let p=f.getColumn(0,Kb),m=f.getColumn(1,Xb),g=f.getColumn(2,Qb),b=-Number.MAX_VALUE,y=-Number.MAX_VALUE,x=-Number.MAX_VALUE,A=Number.MAX_VALUE,B=Number.MAX_VALUE,E=Number.MAX_VALUE;for(const F of n)xe.copy(F),b=Math.max(xe.dot(p),b),y=Math.max(xe.dot(m),y),x=Math.max(xe.dot(g),x),A=Math.min(xe.dot(p),A),B=Math.min(xe.dot(m),B),E=Math.min(xe.dot(g),E);p=p.multiplyByScalar(.5*(A+b)),m=m.multiplyByScalar(.5*(B+y)),g=g.multiplyByScalar(.5*(E+x)),t.center.copy(p).add(m).add(g);const C=qb.set(b-A,y-B,x-E).multiplyByScalar(.5),S=new q([C[0],0,0,0,C[1],0,0,0,C[2]]);return t.halfAxes.multiplyRight(S),t}const Mc=new w,mr=new w,_o=new _t([new Fe,new Fe,new Fe,new Fe,new Fe,new Fe]);function tg(n,t){const{cameraDirection:e,cameraUp:s,height:i}=n,{metersPerUnit:r}=n.distanceScales,o=Bi(n,n.center),a=J.WGS84.eastNorthUpToFixedFrame(o),c=n.unprojectPosition(n.cameraPosition),h=J.WGS84.cartographicToCartesian(c,new w),l=new w(a.transformAsVector(new w(e).scale(r))).normalize(),u=new w(a.transformAsVector(new w(s).scale(r))).normalize();sg(n);const d=n.constructor,{longitude:f,latitude:p,width:m,bearing:g,zoom:b}=n,y=new d({longitude:f,latitude:p,height:i,width:m,bearing:g,zoom:b,pitch:0});return{camera:{position:h,direction:l,up:u},viewport:n,topDownViewport:y,height:i,cullingVolume:_o,frameNumber:t,sseDenominator:1.15}}function eg(n,t,e){if(e===0||n.length<=e)return[n,[]];const s=[],{longitude:i,latitude:r}=t.viewport;for(const[h,l]of n.entries()){const[u,d]=l.header.mbs,f=Math.abs(i-u),p=Math.abs(r-d),m=Math.sqrt(p*p+f*f);s.push([h,m])}const o=s.sort((h,l)=>h[1]-l[1]),a=[];for(let h=0;h<e;h++)a.push(n[o[h][0]]);const c=[];for(let h=e;h<o.length;h++)c.push(n[o[h][0]]);return[a,c]}function sg(n){const t=n.getFrustumPlanes(),e=Ec(t.near,n.cameraPosition),s=Bi(n,e),i=Bi(n,n.cameraPosition,mr);let r=0;_o.planes[r++].fromPointNormal(s,Mc.copy(s).subtract(i));for(const o in t){if(o==="near")continue;const a=t[o],c=Ec(a,e,mr),h=Bi(n,c,mr);_o.planes[r++].fromPointNormal(h,Mc.copy(s).subtract(h))}}function Ec(n,t,e=new w){const s=n.normal.dot(t);return e.copy(n.normal).scale(n.distance-s).add(t),e}function Bi(n,t,e=new w){const s=n.unprojectPosition(t);return J.WGS84.cartographicToCartesian(s,e)}const ng=6378137,ig=6378137,So=6356752314245179e-9,Ms=new w;function rg(n,t){if(n instanceof _n){const{halfAxes:e}=n,s=ag(e);return Math.log2(So/(s+t[2]))}else if(n instanceof Cn){const{radius:e}=n;return Math.log2(So/(e+t[2]))}else if(n.width&&n.height){const{width:e,height:s}=n,i=Math.log2(ng/e),r=Math.log2(ig/s);return(i+r)/2}return 1}function pu(n,t,e){J.WGS84.cartographicToCartesian([n.xmax,n.ymax,n.zmax],Ms);const s=Math.sqrt(Math.pow(Ms[0]-e[0],2)+Math.pow(Ms[1]-e[1],2)+Math.pow(Ms[2]-e[2],2));return Math.log2(So/(s+t[2]))}function og(n,t,e){const[s,i,r,o]=n;return pu({xmax:r,ymax:o,zmax:0},t,e)}function ag(n){n.getColumn(0,Ms);const t=n.getColumn(1),e=n.getColumn(2);return Ms.add(t).add(e).len()}const bt={UNLOADED:0,LOADING:1,READY:3,EXPIRED:4,FAILED:5};var Vt;(function(n){n[n.ADD=1]="ADD",n[n.REPLACE=2]="REPLACE"})(Vt||(Vt={}));var Es;(function(n){n.EMPTY="empty",n.SCENEGRAPH="scenegraph",n.POINTCLOUD="pointcloud",n.MESH="mesh"})(Es||(Es={}));var ft;(function(n){n.I3S="I3S",n.TILES3D="TILES3D"})(ft||(ft={}));var Ds;(function(n){n.GEOMETRIC_ERROR="geometricError",n.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Ds||(Ds={}));const cg={USE_OPTIMIZATION:1};function mu(n){return n!=null}const ot=new w,wi=new w,hg=new w,lg=new w,Ne=new w,Cc=new w,_c=new w,Sc=new w;function br(n,t,e){if(j(n,"3D Tile: boundingVolume must be defined"),n.box)return bu(n.box,t,e);if(n.region)return fg(n.region);if(n.sphere)return dg(n.sphere,t,e);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function ug(n,t){if(n.box)return pg(t);if(n.region){const[e,s,i,r,o,a]=n.region;return[[Gt(e),Gt(s),o],[Gt(i),Gt(r),a]]}if(n.sphere)return mg(t);throw new Error("Unkown boundingVolume type")}function bu(n,t,e){const s=new w(n[0],n[1],n[2]);t.transform(s,s);let i=[];if(n.length===10){const h=n.slice(3,6),l=new Fi;l.fromArray(n,6);const u=new w([1,0,0]),d=new w([0,1,0]),f=new w([0,0,1]);u.transformByQuaternion(l),u.scale(h[0]),d.transformByQuaternion(l),d.scale(h[1]),f.transformByQuaternion(l),f.scale(h[2]),i=[...u.toArray(),...d.toArray(),...f.toArray()]}else i=[...n.slice(3,6),...n.slice(6,9),...n.slice(9,12)];const r=t.transformAsVector(i.slice(0,3)),o=t.transformAsVector(i.slice(3,6)),a=t.transformAsVector(i.slice(6,9)),c=new q([r[0],r[1],r[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return mu(e)?(e.center=s,e.halfAxes=c,e):new _n(s,c)}function dg(n,t,e){const s=new w(n[0],n[1],n[2]);t.transform(s,s);const i=t.getScale(wi),r=Math.max(Math.max(i[0],i[1]),i[2]),o=n[3]*r;return mu(e)?(e.center=s,e.radius=o,e):new Cn(s,o)}function fg(n){const[t,e,s,i,r,o]=n,a=J.WGS84.cartographicToCartesian([Gt(t),Gt(i),r],hg),c=J.WGS84.cartographicToCartesian([Gt(s),Gt(e),o],lg),h=new w().addVectors(a,c).multiplyByScalar(.5);return J.WGS84.cartesianToCartographic(h,Ne),J.WGS84.cartographicToCartesian([Gt(s),Ne[1],Ne[2]],Cc),J.WGS84.cartographicToCartesian([Ne[0],Gt(i),Ne[2]],_c),J.WGS84.cartographicToCartesian([Ne[0],Ne[1],o],Sc),bu([...h,...Cc.subtract(h),..._c.subtract(h),...Sc.subtract(h)],new V)}function pg(n){const t=gu(),{halfAxes:e}=n,s=new w(e.getColumn(0)),i=new w(e.getColumn(1)),r=new w(e.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let c=0;c<2;c++)ot.copy(n.center),ot.add(s),ot.add(i),ot.add(r),yu(t,ot),r.negate();i.negate()}s.negate()}return t}function mg(n){const t=gu(),{center:e,radius:s}=n,i=J.WGS84.scaleToGeodeticSurface(e,ot);let r;i?r=J.WGS84.geodeticSurfaceNormal(i):r=new w(0,0,1);let o=new w(r[2],-r[1],0);o.len()>0?o.normalize():o=new w(0,1,0);const a=o.clone().cross(r);for(const c of[o,a,r]){wi.copy(c).scale(s);for(let h=0;h<2;h++)ot.copy(e),ot.add(wi),yu(t,ot),wi.negate()}return t}function gu(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function yu(n,t){J.WGS84.cartesianToCartographic(t,ot),n[0][0]=Math.min(n[0][0],ot[0]),n[0][1]=Math.min(n[0][1],ot[1]),n[0][2]=Math.min(n[0][2],ot[2]),n[1][0]=Math.max(n[1][0],ot[0]),n[1][1]=Math.max(n[1][1],ot[1]),n[1][2]=Math.max(n[1][2],ot[2])}new w;new w;new V;new w;new w;new w;function bg(n,t){const e=n*t;return 1-Math.exp(-(e*e))}function gg(n,t){if(n.dynamicScreenSpaceError&&n.dynamicScreenSpaceErrorComputedDensity){const e=n.dynamicScreenSpaceErrorComputedDensity,s=n.dynamicScreenSpaceErrorFactor;return bg(t,e)*s}return 0}function yg(n,t,e){const s=n.tileset,i=n.parent&&n.parent.lodMetricValue||n.lodMetricValue,r=e?i:n.lodMetricValue;if(r===0)return 0;const o=Math.max(n._distanceToCamera,1e-7),{height:a,sseDenominator:c}=t,{viewDistanceScale:h}=s.options;let l=r*a*(h||1)/(o*c);return l-=gg(s,o),l}const gr=new w,Fc=new w,Te=new w,Rc=new w,Ag=new w,yr=new V,Ic=new V;function xg(n,t){if(n.lodMetricValue===0||isNaN(n.lodMetricValue))return"DIG";const e=2*Au(n,t);return e<2?"OUT":!n.header.children||e<=n.lodMetricValue?"DRAW":n.header.children?"DIG":"OUT"}function Au(n,t){const{topDownViewport:e}=t,s=n.header.mbs[1],i=n.header.mbs[0],r=n.header.mbs[2],o=n.header.mbs[3],a=[...n.boundingVolume.center],c=e.unprojectPosition(e.cameraPosition);J.WGS84.cartographicToCartesian(c,gr),Fc.copy(gr).subtract(a).normalize(),J.WGS84.eastNorthUpToFixedFrame(a,yr),Ic.copy(yr).invert(),Te.copy(gr).transform(Ic);const h=Math.sqrt(Te[0]*Te[0]+Te[1]*Te[1]),l=h*h/Te[2];Rc.copy([Te[0],Te[1],l]);const d=Rc.transform(yr).subtract(a).normalize(),p=Fc.cross(d).normalize().scale(o).add(a),m=J.WGS84.cartesianToCartographic(p),g=e.project([i,s,r]),b=e.project(m);return Ag.copy(g).subtract(b).magnitude()}function Tg(n){return{assetGltfUpAxis:n.asset&&n.asset.gltfUpAxis||"Y"}}class Dc{constructor(t=0){T(this,"_map",new Map);T(this,"_array");T(this,"_length");this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return j(t<this._array.length),this._array[t]}set(t,e){j(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){j(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){j(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const Bg={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class qi{constructor(t){T(this,"options");T(this,"root",null);T(this,"selectedTiles",{});T(this,"requestedTiles",{});T(this,"emptyTiles",{});T(this,"lastUpdate",new Date().getTime());T(this,"updateDebounceTime",1e3);T(this,"_traversalStack",new Dc);T(this,"_emptyTraversalStack",new Dc);T(this,"_frameNumber",null);this.options={...Bg,...t}}traversalFinished(t){return!0}traverse(t,e,s){this.root=t,this.options={...this.options,...s},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const s=this._traversalStack;for(t._selectionDepth=1,s.push(t);s.length>0;){const r=s.pop();let o=!1;this.canTraverse(r,e)&&(this.updateChildTiles(r,e),o=this.updateAndPushChildren(r,e,s,r.hasRenderContent?r._selectionDepth+1:r._selectionDepth));const a=r.parent,c=!!(!a||a._shouldRefine),h=!o;r.hasRenderContent?r.refine===Vt.ADD?(this.loadTile(r,e),this.selectTile(r,e)):r.refine===Vt.REPLACE&&(this.loadTile(r,e),h&&this.selectTile(r,e)):(this.emptyTiles[r.id]=r,this.loadTile(r,e),h&&this.selectTile(r,e)),this.touchTile(r,e),r._shouldRefine=o&&c}const i=new Date().getTime();(this.traversalFinished(e)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(e))}updateChildTiles(t,e){const s=t.children;for(const i of s)this.updateTile(i,e)}updateAndPushChildren(t,e,s,i){const{loadSiblings:r,skipLevelOfDetail:o}=this.options,a=t.children;a.sort(this.compareDistanceToCamera.bind(this));const c=t.refine===Vt.REPLACE&&t.hasRenderContent&&!o;let h=!1,l=!0;for(const u of a)if(u._selectionDepth=i,u.isVisibleAndInRequestVolume?(s.find(u)&&s.delete(u),s.push(u),h=!0):(c||r)&&(this.loadTile(u,e),this.touchTile(u,e)),c){let d;if(u._inRequestVolume?u.hasRenderContent?d=u.contentAvailable:d=this.executeEmptyTraversal(u,e):d=!1,l=l&&d,!l)return!1}return h||(l=!1),l}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e){return t.hasChildren?t.hasTilesetContent?!t.contentExpired:this.shouldRefine(t,e):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e,s=!1){let i=t._screenSpaceError;return s&&(i=t.getScreenSpaceError(e,!0)),i>t.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(t,e){const s=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===e.viewport.id&&s.push(i);else s.push(e.viewport.id);t.updateVisibility(e,s)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let s=!1;for(const i of t.children)i.updateVisibility(e),s=s||i.isVisibleAndInRequestVolume;return s}executeEmptyTraversal(t,e){let s=!0;const i=this._emptyTraversalStack;for(i.push(t);i.length>0;){const r=i.pop(),o=!r.hasRenderContent&&this.canTraverse(r,e),a=!r.hasRenderContent&&r.children.length===0;if(!o&&!r.contentAvailable&&!a&&(s=!1),this.updateTile(r,e),r.isVisibleAndInRequestVolume||(this.loadTile(r,e),this.touchTile(r,e)),o){const c=r.children;for(const h of c)i.push(h)}}return s}}const Oc=new w;function wg(n){return n!=null}class Fo{constructor(t,e,s,i=""){T(this,"tileset");T(this,"header");T(this,"id");T(this,"url");T(this,"parent");T(this,"refine");T(this,"type");T(this,"contentUrl");T(this,"lodMetricType","geometricError");T(this,"lodMetricValue",0);T(this,"boundingVolume",null);T(this,"content",null);T(this,"contentState",bt.UNLOADED);T(this,"gpuMemoryUsageInBytes",0);T(this,"children",[]);T(this,"depth",0);T(this,"viewportIds",[]);T(this,"transform",new V);T(this,"extensions",null);T(this,"implicitTiling",null);T(this,"userData",{});T(this,"computedTransform");T(this,"hasEmptyContent",!1);T(this,"hasTilesetContent",!1);T(this,"traverser",new qi({}));T(this,"_cacheNode",null);T(this,"_frameNumber",null);T(this,"_expireDate",null);T(this,"_expiredContent",null);T(this,"_boundingBox");T(this,"_distanceToCamera",0);T(this,"_screenSpaceError",0);T(this,"_visibilityPlaneMask");T(this,"_visible");T(this,"_contentBoundingVolume");T(this,"_viewerRequestVolume");T(this,"_initialTransform",new V);T(this,"_priority",0);T(this,"_selectedFrame",0);T(this,"_requestedFrame",0);T(this,"_selectionDepth",0);T(this,"_touchedFrame",0);T(this,"_centerZDepth",0);T(this,"_shouldRefine",!1);T(this,"_stackLength",0);T(this,"_visitedFrame",0);T(this,"_inRequestVolume",!1);T(this,"_lodJudge",null);this.header=e,this.tileset=t,this.id=i||e.id,this.url=e.url,this.parent=s,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===bt.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===bt.UNLOADED}get contentExpired(){return this.contentState===bt.EXPIRED}get contentFailed(){return this.contentState===bt.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=ug(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,e){switch(this.tileset.type){case ft.I3S:return Au(this,t);case ft.TILES3D:return yg(this,t,e);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,s=this.refine===Vt.ADD||e;if(s&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===bt.UNLOADED)return-1;const i=this.parent,o=i&&(!s||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,a=t.root?t.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=bt.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=bt.UNLOADED,!1;try{const s=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,r={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await En(s,i,r),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=bt.READY,this._onContentLoaded(),!0}catch(s){throw this.contentState=bt.FAILED,s}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=bt.UNLOADED,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const s=this.parent,i=s?s._visibilityPlaneMask:_t.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const r=s?s.computedTransform:this.tileset.modelMatrix;this._updateTransform(r)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,i),this._visible=this._visibilityPlaneMask!==_t.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:s}=t,{boundingVolume:i}=this;return s.computeVisibilityWithPlaneMask(i,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const e=this.boundingVolume;return Oc.subVectors(e.center,t.position),t.direction.dot(Oc)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(wg(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=bt.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new V(t.transform):new V;const e=this.parent,s=this.tileset,i=e&&e.computedTransform?e.computedTransform.clone():s.modelMatrix.clone();this.computedTransform=new V(i).multiplyRight(this.transform);const r=e&&e._initialTransform?e._initialTransform.clone():new V;this._initialTransform=new V(r).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=bt.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=_t.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Vt.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=br(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=br(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=br(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new V){const e=t.clone().multiplyRight(this.transform);e.equals(this.computedTransform)||(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Tg(this.tileset.tileset)}}}class Mg extends qi{compareDistanceToCamera(t,e){return e._distanceToCamera===0&&t._distanceToCamera===0?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const s=t.children.length>0;if(t.hasTilesetContent&&s){const o=t.children[0];this.updateTileVisibility(o,e),t._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(t,e)){t._visible=!1;return}const i=t.refine===Vt.REPLACE,r=t._optimChildrenWithinParent===cg.USE_OPTIMIZATION;if(i&&r&&s&&!this.anyChildrenVisible(t,e)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,e){const{parent:s}=t;return!s||s.hasTilesetContent||s.refine!==Vt.ADD?!1:!this.shouldRefine(t,e,!0)}}class Eg{constructor(){T(this,"frameNumberMap",new Map)}register(t,e){const s=this.frameNumberMap.get(t)||new Map,i=s.get(e)||0;s.set(e,i+1),this.frameNumberMap.set(t,s)}deregister(t,e){const s=this.frameNumberMap.get(t);if(!s)return;const i=s.get(e)||1;s.set(e,i-1)}isZero(t,e){var i;return(((i=this.frameNumberMap.get(t))==null?void 0:i.get(e))||0)===0}}const Ar={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Cg{constructor(){T(this,"_statusMap");T(this,"pendingTilesRegister",new Eg);this._statusMap={}}add(t,e,s,i){if(!this._statusMap[e]){const{frameNumber:r,viewport:{id:o}}=i;this._statusMap[e]={request:t,callback:s,key:e,frameState:i,status:Ar.REQUESTED},this.pendingTilesRegister.register(o,r),t().then(a=>{this._statusMap[e].status=Ar.COMPLETED;const{frameNumber:c,viewport:{id:h}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(h,c),this._statusMap[e].callback(a,i)}).catch(a=>{this._statusMap[e].status=Ar.ERROR;const{frameNumber:c,viewport:{id:h}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(h,c),s(a)})}}update(t,e){if(this._statusMap[t]){const{frameNumber:s,viewport:{id:i}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(i,s);const{frameNumber:r,viewport:{id:o}}=e;this.pendingTilesRegister.register(o,r),this._statusMap[t].frameState=e}}find(t){return this._statusMap[t]}hasPendingTiles(t,e){return!this.pendingTilesRegister.isZero(t,e)}}class _g extends qi{constructor(e){super(e);T(this,"_tileManager");this._tileManager=new Cg}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,s){return e._lodJudge=xg(e,s),e._lodJudge==="DIG"}updateChildTiles(e,s){const i=e.header.children||[],r=e.children,o=e.tileset;for(const a of i){const c=`${a.id}-${s.viewport.id}`,h=r&&r.find(l=>l.id===c);if(h)h&&this.updateTile(h,s);else{let l=()=>this._loadTile(a.id,o);this._tileManager.find(c)?this._tileManager.update(c,s):(o.tileset.nodePages&&(l=()=>o.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(l,c,d=>this._onTileLoad(d,e,c),s))}}return!1}async _loadTile(e,s){const{loader:i}=s,r=s.getTileUrl(`${s.url}/nodes/${e}`),o={...s.loadOptions,i3s:{...s.loadOptions.i3s,isTileHeader:!0}};return await En(r,i,o)}_onTileLoad(e,s,i){const r=new Fo(s.tileset,e,s,i);s.children.push(r);const o=this._tileManager.find(r.id).frameState;this.updateTile(r,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,o)}}const Sg={description:"",ellipsoid:J.WGS84,modelMatrix:new V,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:n=>n,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Vn="Tiles In Tileset(s)",xr="Tiles In Memory",Lc="Tiles In View",Nc="Tiles To Render",kc="Tiles Loaded",Tr="Tiles Loading",Pc="Tiles Unloaded",Gc="Failed Tile Loads",vc="Points/Vertices",Br="Tile Memory Use",Uc="Maximum Screen Space Error";class Fg{constructor(t,e){T(this,"options");T(this,"loadOptions");T(this,"type");T(this,"tileset");T(this,"loader");T(this,"url");T(this,"basePath");T(this,"modelMatrix");T(this,"ellipsoid");T(this,"lodMetricType");T(this,"lodMetricValue");T(this,"refine");T(this,"root",null);T(this,"roots",{});T(this,"asset",{});T(this,"description","");T(this,"properties");T(this,"extras",null);T(this,"attributions",{});T(this,"credits",{});T(this,"stats");T(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});T(this,"cartographicCenter",null);T(this,"cartesianCenter",null);T(this,"zoom",1);T(this,"boundingVolume",null);T(this,"dynamicScreenSpaceErrorComputedDensity",0);T(this,"maximumMemoryUsage",32);T(this,"gpuMemoryUsageInBytes",0);T(this,"memoryAdjustedScreenSpaceError",0);T(this,"_cacheBytes",0);T(this,"_cacheOverflowBytes",0);T(this,"_frameNumber",0);T(this,"_queryParams",{});T(this,"_extensionsUsed",[]);T(this,"_tiles",{});T(this,"_pendingCount",0);T(this,"selectedTiles",[]);T(this,"traverseCounter",0);T(this,"geometricError",0);T(this,"lastUpdatedVieports",null);T(this,"_requestedTiles",[]);T(this,"_emptyTiles",[]);T(this,"frameStateData",{});T(this,"_traverser");T(this,"_cache",new Lb);T(this,"_requestScheduler");T(this,"updatePromise",null);T(this,"tilesetInitializationPromise");this.options={...Sg,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||sa(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Nf({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Il({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}getTileUrl(t){if(t.startsWith("data:"))return t;let s=t;return this.queryParams.length&&(s=`${t}${t.includes("?")?"&":"?"}${this.queryParams}`),s}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(t=null){this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(t=null){return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(e=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const e=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;const s=[];for(const i of e){const r=i.id;this._needTraverse(r)?s.push(r):this.traverseCounter--}for(const i of e){const r=i.id;if(this.roots[r]||(this.roots[r]=this._initializeTileHeaders(this.tileset,null)),!s.includes(r))continue;const o=tg(i,this._frameNumber);this._traverser.traverse(this.roots[r],o,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const s=this.frameStateData[e],i=Object.values(this._traverser.selectedTiles),[r,o]=eg(i,t,this.options.maximumTilesSelected);s.selectedTiles=r;for(const a of o)a.unselect();s._requestedTiles=Object.values(this._traverser.requestedTiles),s._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const s=new Set(t.map(o=>o.id)),i=new Set(e.map(o=>o.id));let r=t.filter(o=>!i.has(o.id)).length>0;return r=r||e.filter(o=>!s.has(o.id)).length>0,r}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_updateStats(){let t=0,e=0;for(const s of this.selectedTiles)s.contentAvailable&&s.content&&(t++,s.content.pointCount?e+=s.content.pointCount:e+=s.content.vertexCount);this.stats.get(Lc).count=this.selectedTiles.length,this.stats.get(Nc).count=t,this.stats.get(vc).count=e,this.stats.get(Uc).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(t){this.type===ft.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===ft.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===ft.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var s;const t=this.tileset.fullExtent;if(t){const{xmin:i,xmax:r,ymin:o,ymax:a,zmin:c,zmax:h}=t;this.cartographicCenter=new w(i+(r-i)/2,o+(a-o)/2,c+(h-c)/2),this.cartesianCenter=new w,J.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=pu(t,this.cartographicCenter,this.cartesianCenter);return}const e=(s=this.tileset.store)==null?void 0:s.extent;if(e){const[i,r,o,a]=e;this.cartographicCenter=new w(i+(o-i)/2,r+(a-r)/2,0),this.cartesianCenter=new w,J.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=og(e,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new w,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:e}=t.boundingVolume;if(!e){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new w,this.zoom=1;return}e[0]!==0||e[1]!==0||e[2]!==0?(this.cartographicCenter=new w,J.WGS84.cartesianToCartographic(e,this.cartographicCenter)):this.cartographicCenter=new w(0,0,-J.WGS84.radii[0]),this.cartesianCenter=e,this.zoom=rg(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Vn),this.stats.get(Tr),this.stats.get(xr),this.stats.get(Lc),this.stats.get(Nc),this.stats.get(kc),this.stats.get(Pc),this.stats.get(Gc),this.stats.get(vc),this.stats.get(Br,"memory"),this.stats.get(Uc)}_initializeTileHeaders(t,e){var i;const s=new Fo(this,t.root,e);if(e&&(e.children.push(s),s.depth=e.depth+1),this.type===ft.TILES3D){const r=[];for(r.push(s);r.length>0;){const o=r.pop();this.stats.get(Vn).incrementCount();const a=o.header.children||[];for(const c of a){const h=new Fo(this,c,o);if((i=h.contentUrl)!=null&&i.includes("?session=")){const u=new URL(h.contentUrl).searchParams.get("session");u&&(this._queryParams.session=u)}o.children.push(h),h.depth=o.depth+1,r.push(h)}}}return s}_initializeTraverser(){let t;switch(this.type){case ft.TILES3D:t=Mg;break;case ft.I3S:t=_g;break;default:t=qi}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(s){this._onTileLoadError(t,s instanceof Error?s:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(Gc).incrementCount();const s=e.message||e.toString(),i=t.url;console.error(`A 3D tile failed to load: ${t.url} ${s}`),this.options.onTileError(t,s,i)}_onTileLoad(t,e){var s,i;if(e){if(this.type===ft.I3S){const r=((i=(s=this.tileset)==null?void 0:s.nodePagesTile)==null?void 0:i.nodesInNodePages)||0;this.stats.get(Vn).reset(),this.stats.get(Vn).addCount(r)}t&&t.content&&Nb(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){var e;if(this.type===ft.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===ft.TILES3D){const{extensionsRemoved:s=[]}=((e=t.content)==null?void 0:e.gltf)||{};s.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),s.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),s.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Tr).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Tr).decrementCount()}_addTileToCache(t){this._cache.add(this,t,e=>e._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(kc).incrementCount(),this.stats.get(xr).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(Br).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(xr).decrementCount(),this.stats.get(Pc).incrementCount(),this.stats.get(Br).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const s of e.children)t.push(s);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,s=[];for(s.push(e);s.length>0;){t=s.pop();for(const i of t.children)s.push(i);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const e=new URLSearchParams(t.queryString),s=Object.fromEntries(e.entries());this._queryParams={...this._queryParams,...s}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const xu="4.3.1",Vs={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function Tu(n,t,e){j(n instanceof ArrayBuffer);const s=new TextDecoder("utf8"),i=new Uint8Array(n,t,e);return s.decode(i)}function Rg(n,t=0){const e=new DataView(n);return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}const Ig="4.3.1",Dg={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Ig,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Og(n,t,e){const s=Bu(t.metadata),i=[],r=Lg(t.attributes);for(const o in n){const a=n[o],c=zc(o,a,r[o]);i.push(c)}if(e){const o=zc("indices",e);i.push(o)}return{fields:i,metadata:s}}function Lg(n){const t={};for(const e in n){const s=n[e];t[s.name||"undefined"]=s}return t}function zc(n,t,e){const s=e?Bu(e.metadata):void 0;return jp(n,t,s)}function Bu(n){Object.entries(n);const t={};for(const e in n)t[`${e}.string`]=JSON.stringify(n[e]);return t}const Hc={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Ng={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},kg=4;class Pg{constructor(t){T(this,"draco");T(this,"decoder");T(this,"metadataQuerier");this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,e={}){const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const i=this.decoder.GetEncodedGeometryType(s),r=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(i){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(s,r);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(s,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!r.ptr){const d=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(d)}const a=this._getDracoLoaderData(r,i,e),c=this._getMeshData(r,a,e),h=Hp(c.attributes),l=Og(c.attributes,a,c.indices);return{loader:"draco",loaderData:a,header:{vertexCount:r.num_points(),boundingBox:h},...c,schema:l}}finally{this.draco.destroy(s),r&&this.draco.destroy(r)}}_getDracoLoaderData(t,e,s){const i=this._getTopLevelMetadata(t),r=this._getDracoAttributes(t,s);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:i,attributes:r}}_getDracoAttributes(t,e){const s={};for(let i=0;i<t.num_attributes();i++){const r=this.decoder.GetAttribute(t,i),o=this._getAttributeMetadata(t,i);s[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:i,metadata:o};const a=this._getQuantizationTransform(r,e);a&&(s[r.unique_id()].quantization_transform=a);const c=this._getOctahedronTransform(r,e);c&&(s[r.unique_id()].octahedron_transform=c)}return s}_getMeshData(t,e,s){const i=this._getMeshAttributes(e,t,s);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(s.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(t,e,s){const i={};for(const r of Object.values(t.attributes)){const o=this._deduceAttributeName(r,s);r.name=o;const a=this._getAttributeValues(e,r);if(a){const{value:c,size:h}=a;i[o]={value:c,size:h,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}}return i}_getTriangleListIndices(t){const s=t.num_faces()*3,i=s*kg,r=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(t,i,r),new Uint32Array(this.draco.HEAPF32.buffer,r,s).slice()}finally{this.draco._free(r)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),Ug(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const s=Ng[e.data_type];if(!s)return console.warn(`DRACO: Unsupported attribute type ${e.data_type}`),null;const i=e.num_components,o=t.num_points()*i,a=o*s.BYTES_PER_ELEMENT,c=Gg(this.draco,s);let h;const l=this.draco._malloc(a);try{const u=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,u,c,a,l),h=new s(this.draco.HEAPF32.buffer,l,o).slice()}finally{this.draco._free(l)}return{value:h,size:i}}_deduceAttributeName(t,e){const s=t.unique_id;for(const[o,a]of Object.entries(e.extraAttributes||{}))if(a===s)return o;const i=t.attribute_type;for(const o in Hc)if(this.draco[o]===i)return Hc[o];const r=e.attributeNameEntry||"name";return t.metadata[r]?t.metadata[r].string:`CUSTOM_ATTRIBUTE_${s}`}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const s=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(s)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},s=this.metadataQuerier.NumEntries(t);for(let i=0;i<s;i++){const r=this.metadataQuerier.GetEntryName(t,i);e[r]=this._getDracoMetadataField(t,r)}return e}_getDracoMetadataField(t,e){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,s);const i=vg(s);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:i}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:s=[]}=t,i=[...e,...s];for(const r of i)this.decoder.SkipAttributeTransform(this.draco[r])}_getQuantizationTransform(t,e){const{quantizedAttributes:s=[]}=e,i=t.attribute_type();if(s.map(o=>this.decoder[o]).includes(i)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:s=[]}=e,i=t.attribute_type();if(s.map(o=>this.decoder[o]).includes(i)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function Gg(n,t){switch(t){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32;default:return n.DT_INVALID}}function vg(n){const t=n.size(),e=new Int32Array(t);for(let s=0;s<t;s++)e[s]=n.GetValue(s);return e}function Ug(n){const t=n.size(),e=new Int32Array(t);for(let s=0;s<t;s++)e[s]=n.GetValue(s);return e}const zg="1.5.6",wr=`https://www.gstatic.com/draco/versioned/decoders/${zg}`,Ct={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js"},Mr={[Ct.DECODER]:`${wr}/${Ct.DECODER}`,[Ct.DECODER_WASM]:`${wr}/${Ct.DECODER_WASM}`,[Ct.FALLBACK_DECODER]:`${wr}/${Ct.FALLBACK_DECODER}`};let Er;async function Hg(n){const t=n.modules||{};return t.draco3d?Er||(Er=t.draco3d.createDecoderModule({}).then(e=>({draco:e}))):Er||(Er=jg(n)),await Er}async function jg(n){let t,e;switch(n.draco&&n.draco.decoderType){case"js":t=await Je(Mr[Ct.FALLBACK_DECODER],"draco",n,Ct.FALLBACK_DECODER);break;case"wasm":default:[t,e]=await Promise.all([await Je(Mr[Ct.DECODER],"draco",n,Ct.DECODER),await Je(Mr[Ct.DECODER_WASM],"draco",n,Ct.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await Vg(t,e)}function Vg(n,t){const e={};return t&&(e.wasmBinary=t),new Promise(s=>{n({...e,onModuleLoaded:i=>s({draco:i})})})}const wu={...Dg,parse:Jg};async function Jg(n,t){const{draco:e}=await Hg(t),s=new Pg(e);try{return s.parseSync(n,t==null?void 0:t.draco)}finally{s.destroy()}}const Wg={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},X={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},k={...Wg,...X},Cr={[X.DOUBLE]:Float64Array,[X.FLOAT]:Float32Array,[X.UNSIGNED_SHORT]:Uint16Array,[X.UNSIGNED_INT]:Uint32Array,[X.UNSIGNED_BYTE]:Uint8Array,[X.BYTE]:Int8Array,[X.SHORT]:Int16Array,[X.INT]:Int32Array},qg={DOUBLE:X.DOUBLE,FLOAT:X.FLOAT,UNSIGNED_SHORT:X.UNSIGNED_SHORT,UNSIGNED_INT:X.UNSIGNED_INT,UNSIGNED_BYTE:X.UNSIGNED_BYTE,BYTE:X.BYTE,SHORT:X.SHORT,INT:X.INT},_r="Failed to convert GL type";class Zt{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in Cr)if(Cr[e]===t)return e;throw new Error(_r)}static fromName(t){const e=qg[t];if(!e)throw new Error(_r);return e}static getArrayType(t){switch(t){case X.UNSIGNED_SHORT_5_6_5:case X.UNSIGNED_SHORT_4_4_4_4:case X.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=Cr[t];if(!e)throw new Error(_r);return e}}static getByteSize(t){return Zt.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!Zt.getArrayType(t)}static createTypedArray(t,e,s=0,i){i===void 0&&(i=(e.byteLength-s)/Zt.getByteSize(t));const r=Zt.getArrayType(t);return new r(e,s,i)}}function Kg(n,t){if(!n)throw new Error(`math.gl assertion failed. ${t}`)}function Xg(n,t=[0,0,0]){const e=n>>11&31,s=n>>5&63,i=n&31;return t[0]=e<<3,t[1]=s<<2,t[2]=i<<3,t}new ha;new w;new ha;new ha;function jc(n,t=255){return pn(n,0,t)/t*2-1}function Vc(n){return n<0?-1:1}function Qg(n,t,e,s){if(Kg(s),n<0||n>e||t<0||t>e)throw new Error(`x and y must be unsigned normalized integers between 0 and ${e}`);if(s.x=jc(n,e),s.y=jc(t,e),s.z=1-(Math.abs(s.x)+Math.abs(s.y)),s.z<0){const i=s.x;s.x=(1-Math.abs(s.y))*Vc(i),s.y=(1-Math.abs(i))*Vc(s.y)}return s.normalize()}function Yg(n,t,e){return Qg(n,t,255,e)}class fa{constructor(t,e){T(this,"json");T(this,"buffer");T(this,"featuresLength",0);T(this,"_cachedTypedArrays",{});this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t,e=k.UNSIGNED_INT,s=1){const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(t,e,s,1,i.byteOffset):i}getPropertyArray(t,e,s){const i=this.json[t];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(e=Zt.fromName(i.componentType)),this._getTypedArrayFromBinary(t,e,s,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(t,e,i)}getProperty(t,e,s,i,r){const o=this.json[t];if(!o)return o;const a=this.getPropertyArray(t,e,s);if(s===1)return a[i];for(let c=0;c<s;++c)r[c]=a[s*i+c];return r}_getTypedArrayFromBinary(t,e,s,i,r){const o=this._cachedTypedArrays;let a=o[t];return a||(a=Zt.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+r,i*s),o[t]=a),a}_getTypedArrayFromArray(t,e,s){const i=this._cachedTypedArrays;let r=i[t];return r||(r=Zt.createTypedArray(e,s),i[t]=r),r}}const $g={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Zg={SCALAR:(n,t)=>n[t],VEC2:(n,t)=>[n[2*t+0],n[2*t+1]],VEC3:(n,t)=>[n[3*t+0],n[3*t+1],n[3*t+2]],VEC4:(n,t)=>[n[4*t+0],n[4*t+1],n[4*t+2],n[4*t+3]],MAT2:(n,t)=>[n[4*t+0],n[4*t+1],n[4*t+2],n[4*t+3]],MAT3:(n,t)=>[n[9*t+0],n[9*t+1],n[9*t+2],n[9*t+3],n[9*t+4],n[9*t+5],n[9*t+6],n[9*t+7],n[9*t+8]],MAT4:(n,t)=>[n[16*t+0],n[16*t+1],n[16*t+2],n[16*t+3],n[16*t+4],n[16*t+5],n[16*t+6],n[16*t+7],n[16*t+8],n[16*t+9],n[16*t+10],n[16*t+11],n[16*t+12],n[16*t+13],n[16*t+14],n[16*t+15]]},ty={SCALAR:(n,t,e)=>{t[e]=n},VEC2:(n,t,e)=>{t[2*e+0]=n[0],t[2*e+1]=n[1]},VEC3:(n,t,e)=>{t[3*e+0]=n[0],t[3*e+1]=n[1],t[3*e+2]=n[2]},VEC4:(n,t,e)=>{t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},MAT2:(n,t,e)=>{t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},MAT3:(n,t,e)=>{t[9*e+0]=n[0],t[9*e+1]=n[1],t[9*e+2]=n[2],t[9*e+3]=n[3],t[9*e+4]=n[4],t[9*e+5]=n[5],t[9*e+6]=n[6],t[9*e+7]=n[7],t[9*e+8]=n[8],t[9*e+9]=n[9]},MAT4:(n,t,e)=>{t[16*e+0]=n[0],t[16*e+1]=n[1],t[16*e+2]=n[2],t[16*e+3]=n[3],t[16*e+4]=n[4],t[16*e+5]=n[5],t[16*e+6]=n[6],t[16*e+7]=n[7],t[16*e+8]=n[8],t[16*e+9]=n[9],t[16*e+10]=n[10],t[16*e+11]=n[11],t[16*e+12]=n[12],t[16*e+13]=n[13],t[16*e+14]=n[14],t[16*e+15]=n[15]}};function ey(n,t,e,s){const{componentType:i}=n;j(n.componentType);const r=typeof i=="string"?Zt.fromName(i):i,o=$g[n.type],a=Zg[n.type],c=ty[n.type];return e+=n.byteOffset,{values:Zt.createTypedArray(r,t,e,o*s),type:r,size:o,unpacker:a,packer:c}}const Yt=n=>n!==void 0;function sy(n,t,e){if(!t)return null;let s=n.getExtension("3DTILES_batch_table_hierarchy");const i=t.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=i,s=i),s?ny(s,e):null}function ny(n,t){let e,s,i;const r=n.instancesLength,o=n.classes;let a=n.classIds,c=n.parentCounts,h=n.parentIds,l=r;Yt(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,i=getBinaryAccessor(a),a=i.createArrayBufferView(t.buffer,t.byteOffset+a.byteOffset,r));let u;if(Yt(c))for(Yt(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),c=i.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,r)),u=new Uint16Array(r),l=0,e=0;e<r;++e)u[e]=l,l+=c[e];Yt(h)&&Yt(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,i=getBinaryAccessor(h),h=i.createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,l));const d=o.length;for(e=0;e<d;++e){const g=o[e].length,b=o[e].instances,y=getBinaryProperties(g,b,t);o[e].instances=combine(y,b)}const f=new Array(d).fill(0),p=new Uint16Array(r);for(e=0;e<r;++e)s=a[e],p[e]=f[s],++f[s];const m={classes:o,classIds:a,classIndexes:p,parentCounts:c,parentIndexes:u,parentIds:h};return oy(m),m}function Js(n,t,e){if(!n)return;const s=n.parentCounts;return n.parentIds?e(n,t):s>0?iy(n,t,e):ry(n,t,e)}function iy(n,t,e){const s=n.classIds,i=n.parentCounts,r=n.parentIds,o=n.parentIndexes,a=s.length,c=scratchVisited;c.length=Math.max(c.length,a);const h=++marker,l=scratchStack;for(l.length=0,l.push(t);l.length>0;){if(t=l.pop(),c[t]===h)continue;c[t]=h;const u=e(n,t);if(Yt(u))return u;const d=i[t],f=o[t];for(let p=0;p<d;++p){const m=r[f+p];m!==t&&l.push(m)}}return null}function ry(n,t,e){let s=!0;for(;s;){const i=e(n,t);if(Yt(i))return i;const r=n.parentIds[t];s=r!==t,t=r}throw new Error("traverseHierarchySingleParent")}function oy(n){const e=n.classIds.length;for(let s=0;s<e;++s)Mu(n,s,stack)}function Mu(n,t,e){const s=n.parentCounts,i=n.parentIds,r=n.parentIndexes,a=n.classIds.length;if(!Yt(i))return;assert(t<a,`Parent index ${t} exceeds the total number of instances: ${a}`),assert(e.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),e.push(t);const c=Yt(s)?s[t]:1,h=Yt(s)?r[t]:t;for(let l=0;l<c;++l){const u=i[h+l];u!==t&&Mu(n,u,e)}e.pop(t)}function dt(n){return n!=null}const Jn=(n,t)=>n,ay={HIERARCHY:!0,extensions:!0,extras:!0};class Eu{constructor(t,e,s,i={}){T(this,"json");T(this,"binary");T(this,"featureCount");T(this,"_extensions");T(this,"_properties");T(this,"_binaryProperties");T(this,"_hierarchy");var r;j(s>=0),this.json=t||{},this.binary=e,this.featureCount=s,this._extensions=((r=this.json)==null?void 0:r.extensions)||{},this._properties={};for(const o in this.json)ay[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=sy(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),j(typeof e=="string",e),this._hierarchy){const s=Js(this._hierarchy,t,(i,r)=>{const o=i.classIds[r];return i.classes[o].name===e});return dt(s)}return!1}isExactClass(t,e){return j(typeof e=="string",e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),j(typeof e=="string",e),dt(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),e=dt(e)?e:[],e.length=0;const s=Object.keys(this._properties);return e.push(...s),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),j(typeof e=="string",e),this._binaryProperties){const i=this._binaryProperties[e];if(dt(i))return this._getBinaryProperty(i,t)}const s=this._properties[e];if(dt(s))return Jn(s[t]);if(this._hierarchy){const i=this._getHierarchyProperty(t,e);if(dt(i))return i}}setProperty(t,e,s){const i=this.featureCount;if(this._checkBatchId(t),j(typeof e=="string",e),this._binaryProperties){const o=this._binaryProperties[e];if(o){this._setBinaryProperty(o,t,s);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,s))return;let r=this._properties[e];dt(r)||(this._properties[e]=new Array(i),r=this._properties[e]),r[t]=Jn(s)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,s){t.pack(s,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const s=this._properties[e],i=this._initializeBinaryProperty(e,s);i&&(t=t||{},t[e]=i)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const s=e;j(this.binary,`Property ${t} requires a batch table binary.`),j(s.type,`Property ${t} requires a type.`);const i=ey(s,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const s=Js(this._hierarchy,t,(i,r)=>{const o=i.classIds[r],a=i.classes[o].instances;return dt(a[e])});return dt(s)}_getPropertyNamesInHierarchy(t,e){Js(this._hierarchy,t,(s,i)=>{const r=s.classIds[i],o=s.classes[r].instances;for(const a in o)o.hasOwnProperty(a)&&e.indexOf(a)===-1&&e.push(a)})}_getHierarchyProperty(t,e){return Js(this._hierarchy,t,(s,i)=>{const r=s.classIds[i],o=s.classes[r],a=s.classIndexes[i],c=o.instances[e];return dt(c)?dt(c.typedArray)?this._getBinaryProperty(c,a):Jn(c[a]):null})}_setHierarchyProperty(t,e,s,i){const r=Js(this._hierarchy,e,(o,a)=>{const c=o.classIds[a],h=o.classes[c],l=o.classIndexes[a],u=h.instances[s];return dt(u)?(j(a===e,`Inherited property "${s}" is read-only.`),dt(u.typedArray)?this._setBinaryProperty(u,l,i):u[l]=Jn(i),!0):!1});return dt(r)}}const Sr=4;function Ki(n,t,e=0){const s=new DataView(t);if(n.magic=s.getUint32(e,!0),e+=Sr,n.version=s.getUint32(e,!0),e+=Sr,n.byteLength=s.getUint32(e,!0),e+=Sr,n.version!==1)throw new Error(`3D Tile Version ${n.version} not supported`);return e}const os=4,Jc="b3dm tile in legacy format.";function pa(n,t,e){const s=new DataView(t);let i;n.header=n.header||{};let r=s.getUint32(e,!0);e+=os;let o=s.getUint32(e,!0);e+=os;let a=s.getUint32(e,!0);e+=os;let c=s.getUint32(e,!0);return e+=os,a>=570425344?(e-=os*2,i=r,a=o,c=0,r=0,o=0,console.warn(Jc)):c>=570425344&&(e-=os,i=a,a=r,c=o,r=0,o=0,console.warn(Jc)),n.header.featureTableJsonByteLength=r,n.header.featureTableBinaryByteLength=o,n.header.batchTableJsonByteLength=a,n.header.batchTableBinaryByteLength=c,n.header.batchLength=i,e}function ma(n,t,e,s){return e=cy(n,t,e),e=hy(n,t,e),e}function cy(n,t,e,s){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:r,batchLength:o}=n.header||{};if(n.featureTableJson={BATCH_LENGTH:o||0},i&&i>0){const a=Tu(t,e,i);n.featureTableJson=JSON.parse(a)}return e+=i||0,n.featureTableBinary=new Uint8Array(t,e,r),e+=r||0,e}function hy(n,t,e,s){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:r}=n.header||{};if(i&&i>0){const o=Tu(t,e,i);n.batchTableJson=JSON.parse(o),e+=i,r&&r>0&&(n.batchTableBinary=new Uint8Array(t,e,r),n.batchTableBinary=new Uint8Array(n.batchTableBinary),e+=r)}return e}function Cu(n,t,e){if(!t&&(!n||!n.batchIds||!e))return null;const{batchIds:s,isRGB565:i,pointCount:r=0}=n;if(s&&e){const o=new Uint8ClampedArray(r*3);for(let a=0;a<r;a++){const c=s[a],l=e.getProperty(c,"dimensions").map(u=>u*255);o[a*3]=l[0],o[a*3+1]=l[1],o[a*3+2]=l[2]}return{type:k.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(t&&i){const o=new Uint8ClampedArray(r*3);for(let a=0;a<r;a++){const c=Xg(t[a]);o[a*3]=c[0],o[a*3+1]=c[1],o[a*3+2]=c[2]}return{type:k.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return t&&t.length===r*3?{type:k.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:k.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}const Wc=new w;function ly(n,t){if(!t)return null;if(n.isOctEncoded16P){const e=new Float32Array((n.pointsLength||0)*3);for(let s=0;s<(n.pointsLength||0);s++)Yg(t[s*2],t[s*2+1],Wc),Wc.toArray(e,s*3);return{type:k.FLOAT,size:2,value:e}}return{type:k.FLOAT,size:2,value:t}}function uy(n,t,e){return n.isQuantized?e["3d-tiles"]&&e["3d-tiles"].decodeQuantizedPositions?(n.isQuantized=!1,dy(n,t)):{type:k.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function dy(n,t){const e=new w,s=new Float32Array(n.pointCount*3);for(let i=0;i<n.pointCount;i++)e.set(t[i*3],t[i*3+1],t[i*3+2]).scale(1/n.quantizedRange).multiply(n.quantizedVolumeScale).add(n.quantizedVolumeOffset).toArray(s,i*3);return s}async function fy(n,t,e,s,i){e=Ki(n,t,e),e=pa(n,t,e),e=ma(n,t,e),py(n);const{featureTable:r,batchTable:o}=my(n);return await xy(n,r,o,s,i),by(n,r,s),gy(n,r,o),yy(n,r),e}function py(n){n.attributes={positions:null,colors:null,normals:null,batchIds:null},n.isQuantized=!1,n.isTranslucent=!1,n.isRGB565=!1,n.isOctEncoded16P=!1}function my(n){const t=new fa(n.featureTableJson,n.featureTableBinary),e=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(e))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=e,n.featuresLength=e,n.pointsLength=e,n.pointCount=e,n.rtcCenter=t.getGlobalProperty("RTC_CENTER",k.FLOAT,3);const s=Ay(n,t);return{featureTable:t,batchTable:s}}function by(n,t,e){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.positions){if(t.hasProperty("POSITION"))n.attributes.positions=t.getPropertyArray("POSITION",k.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const s=t.getPropertyArray("POSITION_QUANTIZED",k.UNSIGNED_SHORT,3);if(n.isQuantized=!0,n.quantizedRange=65535,n.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",k.FLOAT,3),!n.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(n.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",k.FLOAT,3),!n.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");n.attributes.positions=uy(n,s,e)}}if(!n.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function gy(n,t,e){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.colors){let s=null;t.hasProperty("RGBA")?(s=t.getPropertyArray("RGBA",k.UNSIGNED_BYTE,4),n.isTranslucent=!0):t.hasProperty("RGB")?s=t.getPropertyArray("RGB",k.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(s=t.getPropertyArray("RGB565",k.UNSIGNED_SHORT,1),n.isRGB565=!0),n.attributes.colors=Cu(n,s,e)}t.hasProperty("CONSTANT_RGBA")&&(n.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",k.UNSIGNED_BYTE,4))}function yy(n,t){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.normals){let e=null;t.hasProperty("NORMAL")?e=t.getPropertyArray("NORMAL",k.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(e=t.getPropertyArray("NORMAL_OCT16P",k.UNSIGNED_BYTE,2),n.isOctEncoded16P=!0),n.attributes.normals=ly(n,e)}}function Ay(n,t){let e=null;if(!n.batchIds&&t.hasProperty("BATCH_ID")&&(n.batchIds=t.getPropertyArray("BATCH_ID",k.UNSIGNED_SHORT,1),n.batchIds)){const s=t.getGlobalProperty("BATCH_LENGTH");if(!s)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:r}=n;e=new Eu(i,r,s)}return e}async function xy(n,t,e,s,i){let r,o,a;const c=n.batchTableJson&&n.batchTableJson.extensions&&n.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const h=t.getExtension("3DTILES_draco_point_compression");if(h){o=h.properties;const u=h.byteOffset,d=h.byteLength;if(!o||!Number.isFinite(u)||!d)throw new Error("Draco properties, byteOffset, and byteLength must be defined");r=(n.featureTableBinary||[]).slice(u,u+d),n.hasPositions=Number.isFinite(o.POSITION),n.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),n.hasNormals=Number.isFinite(o.NORMAL),n.hasBatchIds=Number.isFinite(o.BATCH_ID),n.isTranslucent=Number.isFinite(o.RGBA)}if(!r)return!0;const l={buffer:r,properties:{...o,...a},batchTableProperties:a};return await Ty(n,l,s,i)}async function Ty(n,t,e,s){if(!s)return;const i={...e,draco:{...e==null?void 0:e.draco,extraAttributes:t.batchTableProperties||{}}};delete i["3d-tiles"];const r=await Tn(t.buffer,wu,i,s),o=r.attributes.POSITION&&r.attributes.POSITION.value,a=r.attributes.COLOR_0&&r.attributes.COLOR_0.value,c=r.attributes.NORMAL&&r.attributes.NORMAL.value,h=r.attributes.BATCH_ID&&r.attributes.BATCH_ID.value,l=o&&r.attributes.POSITION.value.quantization,u=c&&r.attributes.NORMAL.value.quantization;if(l){const f=r.POSITION.data.quantization,p=f.range;n.quantizedVolumeScale=new w(p,p,p),n.quantizedVolumeOffset=new w(f.minValues),n.quantizedRange=(1<<f.quantizationBits)-1,n.isQuantizedDraco=!0}u&&(n.octEncodedRange=(1<<r.NORMAL.data.quantization.quantizationBits)-1,n.isOctEncodedDraco=!0);const d={};if(t.batchTableProperties)for(const f of Object.keys(t.batchTableProperties))r.attributes[f]&&r.attributes[f].value&&(d[f.toLowerCase()]=r.attributes[f].value);n.attributes={positions:o,colors:Cu(n,a,void 0),normals:c,batchIds:h,...d}}const By="4.3.1";var Bl;const wy=(Bl=globalThis.loaders)==null?void 0:Bl.parseImageNode,Ro=typeof Image<"u",Io=typeof ImageBitmap<"u",My=!!wy,Do=Vi?!0:My;function Ey(n){switch(n){case"auto":return Io||Ro||Do;case"imagebitmap":return Io;case"image":return Ro;case"data":return Do;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function Cy(){if(Io)return"imagebitmap";if(Ro)return"image";if(Do)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function _y(n){const t=Sy(n);if(!t)throw new Error("Not an image");return t}function _u(n){switch(_y(n)){case"data":return n;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=n.width,t.height=n.height,e.drawImage(n,0,0),e.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function Sy(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const Fy=/^data:image\/svg\+xml/,Ry=/\.svg((\?|#).*)?$/;function ba(n){return n&&(Fy.test(n)||Ry.test(n))}function Iy(n,t){if(ba(t)){let s=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(s=unescape(encodeURIComponent(s)))}catch(r){throw new Error(r.message)}return`data:image/svg+xml;base64,${btoa(s)}`}return Su(n,t)}function Su(n,t){if(ba(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function Fu(n,t,e){const s=Iy(n,e),i=self.URL||self.webkitURL,r=typeof s!="string"&&i.createObjectURL(s);try{return await Dy(r||s,t)}finally{r&&i.revokeObjectURL(r)}}async function Dy(n,t){const e=new Image;return e.src=n,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((s,i)=>{try{e.onload=()=>s(e),e.onerror=r=>{const o=r instanceof Error?r.message:"error";i(new Error(o))}}catch(r){i(r)}})}const Oy={};let qc=!0;async function Ly(n,t,e){let s;ba(e)?s=await Fu(n,t,e):s=Su(n,e);const i=t&&t.imagebitmap;return await Ny(s,i)}async function Ny(n,t=null){if((ky(t)||!qc)&&(t=null),t)try{return await createImageBitmap(n,t)}catch(e){console.warn(e),qc=!1}return await createImageBitmap(n)}function ky(n){for(const t in n||Oy)return!1;return!0}function Py(n){return!zy(n,"ftyp",4)||!(n[8]&96)?null:Gy(n)}function Gy(n){switch(vy(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function vy(n,t,e){return String.fromCharCode(...n.slice(t,e))}function Uy(n){return[...n].map(t=>t.charCodeAt(0))}function zy(n,t,e=0){const s=Uy(t);for(let i=0;i<s.length;++i)if(s[i]!==n[i+e])return!1;return!0}const $t=!1,ln=!0;function ga(n){const t=Sn(n);return jy(t)||Wy(t)||Vy(t)||Jy(t)||Hy(t)}function Hy(n){const t=new Uint8Array(n instanceof DataView?n.buffer:n),e=Py(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function jy(n){const t=Sn(n);return t.byteLength>=24&&t.getUint32(0,$t)===2303741511?{mimeType:"image/png",width:t.getUint32(16,$t),height:t.getUint32(20,$t)}:null}function Vy(n){const t=Sn(n);return t.byteLength>=10&&t.getUint32(0,$t)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,ln),height:t.getUint16(8,ln)}:null}function Jy(n){const t=Sn(n);return t.byteLength>=14&&t.getUint16(0,$t)===16973&&t.getUint32(2,ln)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,ln),height:t.getUint32(22,ln)}:null}function Wy(n){const t=Sn(n);if(!(t.byteLength>=3&&t.getUint16(0,$t)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:s,sofMarkers:i}=qy();let r=2;for(;r+9<t.byteLength;){const o=t.getUint16(r,$t);if(i.has(o))return{mimeType:"image/jpeg",height:t.getUint16(r+5,$t),width:t.getUint16(r+7,$t)};if(!s.has(o))return null;r+=2,r+=t.getUint16(r,$t)}return null}function qy(){const n=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)n.add(e);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Sn(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function Ky(n,t){var i;const{mimeType:e}=ga(n)||{},s=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return j(s),await s(n,e)}async function Xy(n,t,e){t=t||{};const i=(t.image||{}).type||"auto",{url:r}=e||{},o=Qy(i);let a;switch(o){case"imagebitmap":a=await Ly(n,t,r);break;case"image":a=await Fu(n,t,r);break;case"data":a=await Ky(n);break;default:j(!1)}return i==="data"&&(a=_u(a)),a}function Qy(n){switch(n){case"auto":case"data":return Cy();default:return Ey(n),n}}const Yy=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],$y=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Zy={image:{type:"auto",decode:!0}},tA={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:By,mimeTypes:$y,extensions:Yy,parse:Xy,tests:[n=>!!ga(new DataView(n))],options:Zy},Fr={};function eA(n){if(Fr[n]===void 0){const t=Vi?nA(n):sA(n);Fr[n]=t}return Fr[n]}function sA(n){var i,r;const t=["image/png","image/jpeg","image/gif"],e=((i=globalThis.loaders)==null?void 0:i.imageFormatsNode)||t;return!!((r=globalThis.loaders)==null?void 0:r.parseImageNode)&&e.includes(n)}function nA(n){switch(n){case"image/avif":case"image/webp":return iA(n);default:return!0}}function iA(n){try{return document.createElement("canvas").toDataURL(n).indexOf(`data:${n}`)===0}catch{return!1}}function Tt(n,t){if(!n)throw new Error(t||"assert failed: gltf")}const Ru={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Iu={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},rA=1.33,Kc=["SCALAR","VEC2","VEC3","VEC4"],oA=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],aA=new Map(oA),cA={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hA={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},lA={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Du(n){return Kc[n-1]||Kc[0]}function Xi(n){const t=aA.get(n.constructor);if(!t)throw new Error("Illegal typed array");return t}function ya(n,t){const e=lA[n.componentType],s=cA[n.type],i=hA[n.componentType],r=n.count*s,o=n.count*s*i;Tt(o>=0&&o<=t.byteLength);const a=Iu[n.componentType],c=Ru[n.type];return{ArrayType:e,length:r,byteLength:o,componentByteSize:a,numberOfComponentsInElement:c}}function Ou(n){let{images:t,bufferViews:e}=n;t=t||[],e=e||[];const s=t.map(o=>o.bufferView);e=e.filter(o=>!s.includes(o));const i=e.reduce((o,a)=>o+a.byteLength,0),r=t.reduce((o,a)=>{const{width:c,height:h}=a.image;return o+c*h},0);return i+Math.ceil(4*r*rA)}function uA(n,t,e){const s=n.bufferViews[e];Tt(s);const i=s.buffer,r=t[i];Tt(r);const o=(s.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,o,s.byteLength)}function dA(n,t,e){var m,g;const s=typeof e=="number"?(m=n.accessors)==null?void 0:m[e]:e;if(!s)throw new Error(`No gltf accessor ${JSON.stringify(e)}`);const i=(g=n.bufferViews)==null?void 0:g[s.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:r,byteOffset:o}=t[i.buffer],a=(o||0)+(s.byteOffset||0)+(i.byteOffset||0),{ArrayType:c,length:h,componentByteSize:l,numberOfComponentsInElement:u}=ya(s,i),d=l*u,f=i.byteStride||d;if(typeof i.byteStride>"u"||i.byteStride===d)return new c(r,a,h);const p=new c(h);for(let b=0;b<s.count;b++){const y=new c(r,a+b*f,u);p.set(y,b*u)}return p}function fA(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class et{constructor(t){T(this,"gltf");T(this,"sourceBuffers");T(this,"byteLength");this.gltf={json:(t==null?void 0:t.json)||fA(),buffers:(t==null?void 0:t.buffers)||[],images:(t==null?void 0:t.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const e=this.getUsedExtensions().find(i=>i===t),s=this.getRequiredExtensions().find(i=>i===t);return typeof e=="string"||typeof s=="string"}getExtension(t){const e=this.getUsedExtensions().find(i=>i===t),s=this.json.extensions||{};return e?s[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(s=>s===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const s=this.json[t]&&this.json[t][e];if(!s)throw new Error(`glTF file error: Could not find ${t}[${e}]`);return s}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,s=this.gltf.buffers[e];Tt(s);const i=(t.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,i,t.byteLength)}getTypedArrayForAccessor(t){const e=this.getAccessor(t);return dA(this.gltf.json,this.gltf.buffers,e)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),i=this.getBuffer(e.buffer).data,r=e.byteOffset||0;return new Uint8Array(i,r,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,s){return t.extensions=t.extensions||{},t.extensions[e]=s,this.registerUsedExtension(e),this}setObjectExtension(t,e,s){const i=t.extensions||{};i[e]=s}removeObjectExtension(t,e){const s=(t==null?void 0:t.extensions)||{};if(s[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(e)||i.push(e)}delete s[e]}addExtension(t,e={}){return Tt(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t,e={}){return Tt(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){var e;if((e=this.json.extensions)!=null&&e[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(t)||s.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:s}=t;this.json.nodes=this.json.nodes||[];const i={mesh:e};return s&&(i.matrix=s),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:s,material:i,mode:r=4}=t,a={primitives:[{attributes:this._addAttributes(e),mode:r}]};if(s){const c=this._addIndices(s);a.primitives[0].indices=c}return Number.isFinite(i)&&(a.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(t){const s={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addImage(t,e){const s=ga(t),i=e||(s==null?void 0:s.mimeType),o={bufferView:this.addBufferView(t),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(t,e=0,s=this.byteLength){const i=t.byteLength;Tt(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const r={buffer:e,byteOffset:s,byteLength:i};return this.byteLength+=wn(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(t,e){const s={bufferView:t,type:Du(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(s),this.json.accessors.length-1}addBinaryBuffer(t,e={size:3}){const s=this.addBufferView(t);let i={min:e.min,max:e.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(t,e.size));const r={size:e.size,componentType:Xi(t),count:Math.round(t.length/e.size),min:i.min,max:i.max};return this.addAccessor(s,Object.assign(r,e))}addTexture(t){const{imageIndex:e}=t,s={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(s),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var r,o;const t=this.byteLength,e=new ArrayBuffer(t),s=new Uint8Array(e);let i=0;for(const a of this.sourceBuffers||[])i=_f(a,s,i);(o=(r=this.json)==null?void 0:r.buffers)!=null&&o[0]?this.json.buffers[0].byteLength=t:this.json.buffers=[{byteLength:t}],this.gltf.binary=e,this.sourceBuffers=[e],this.gltf.buffers=[{arrayBuffer:e,byteOffset:0,byteLength:e.byteLength}]}_removeStringFromArray(t,e){let s=!0;for(;s;){const i=t.indexOf(e);i>-1?t.splice(i,1):s=!1}}_addAttributes(t={}){const e={};for(const s in t){const i=t[s],r=this._getGltfAttributeName(s),o=this.addBinaryBuffer(i.value,i);e[r]=o}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const s={min:null,max:null};if(t.length<e)return s;s.min=[],s.max=[];const i=t.subarray(0,e);for(const r of i)s.min.push(r),s.max.push(r);for(let r=e;r<t.length;r+=e)for(let o=0;o<e;o++)s.min[0+o]=Math.min(s.min[0+o],t[r+o]),s.max[0+o]=Math.max(s.max[0+o],t[r+o]);return s}}function Xc(n){return(n%1+1)%1}const Lu={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},pA={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},Nu={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Aa(n,t){return Nu[t]*Lu[n]}function Qi(n,t,e,s){if(e!=="UINT8"&&e!=="UINT16"&&e!=="UINT32"&&e!=="UINT64")return null;const i=n.getTypedArrayForBufferView(t),r=Yi(i,"SCALAR",e,s+1);return r instanceof BigInt64Array||r instanceof BigUint64Array?null:r}function Yi(n,t,e,s=1){const i=Lu[t],r=pA[e],o=Nu[e],a=s*i,c=a*o;let h=n.buffer,l=n.byteOffset;return l%o!==0&&(h=new Uint8Array(h).slice(l,l+c).buffer,l=0),new r(h,l,a)}function xa(n,t,e){var h,l,u,d,f;const s=`TEXCOORD_${t.texCoord||0}`,i=e.attributes[s],r=n.getTypedArrayForAccessor(i),o=n.gltf.json,a=t.index,c=(l=(h=o.textures)==null?void 0:h[a])==null?void 0:l.source;if(typeof c<"u"){const p=(d=(u=o.images)==null?void 0:u[c])==null?void 0:d.mimeType,m=(f=n.gltf.images)==null?void 0:f[c];if(m&&typeof m.width<"u"){const g=[];for(let b=0;b<r.length;b+=2){const y=mA(m,p,r,b,t.channels);g.push(y)}return g}}return[]}function ku(n,t,e,s,i){if(!(e!=null&&e.length))return;const r=[];for(const l of e){let u=s.findIndex(d=>d===l);u===-1&&(u=s.push(l)-1),r.push(u)}const o=new Uint32Array(r),a=n.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,c=n.addBufferView(o,a,0),h=n.addAccessor(c,{size:1,componentType:Xi(o),count:o.length});i.attributes[t]=h}function mA(n,t,e,s,i=[0]){const r={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=e[s],a=e[s+1];let c=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(c=4);const h=bA(o,a,n,c);let l=0;for(const u of i){const d=typeof u=="number"?Object.values(r)[u]:r[u],f=h+d.offset,p=_u(n);if(p.data.length<=f)throw new Error(`${p.data.length} <= ${f}`);const m=p.data[f];l|=m<<d.shift}return l}function bA(n,t,e,s=1){const i=e.width,r=Xc(n)*(i-1),o=Math.round(r),a=e.height,c=Xc(t)*(a-1),h=Math.round(c),l=e.components?e.components:s;return(h*i+o)*l}function Pu(n,t,e,s,i){const r=[];for(let o=0;o<t;o++){const a=e[o],c=e[o+1]-e[o];if(c+a>s)break;const h=a/i,l=c/i;r.push(n.slice(h,h+l))}return r}function Gu(n,t,e){const s=[];for(let i=0;i<t;i++){const r=i*e;s.push(n.slice(r,r+e))}return s}function vu(n,t,e,s){if(e)throw new Error("Not implemented - arrayOffsets for strings is specified");if(s){const i=[],r=new TextDecoder("utf8");let o=0;for(let a=0;a<n;a++){const c=s[a+1]-s[a];if(c+o<=t.length){const h=t.subarray(o,c+o),l=r.decode(h);i.push(l),o+=c}}return i}return[]}const Ss="EXT_mesh_features",gA=Ss;async function yA(n,t){const e=new et(n);xA(e,t)}function AA(n,t){const e=new et(n);return BA(e),e.createBinaryChunk(),e.gltf}function xA(n,t){const e=n.gltf.json;if(e.meshes)for(const s of e.meshes)for(const i of s.primitives)TA(n,i,t)}function TA(n,t,e){var r,o,a;if(!((r=e==null?void 0:e.gltf)!=null&&r.loadBuffers))return;const s=(o=t.extensions)==null?void 0:o[Ss],i=s==null?void 0:s.featureIds;if(i)for(const c of i){let h;if(typeof c.attribute<"u"){const l=`_FEATURE_ID_${c.attribute}`,u=t.attributes[l];h=n.getTypedArrayForAccessor(u)}else typeof c.texture<"u"&&((a=e==null?void 0:e.gltf)!=null&&a.loadImages)?h=xa(n,c.texture,t):h=[];c.data=h}}function BA(n,t){const e=n.gltf.json.meshes;if(e)for(const s of e)for(const i of s.primitives)MA(n,i)}function wA(n,t,e,s){t.extensions||(t.extensions={});let i=t.extensions[Ss];i||(i={featureIds:[]},t.extensions[Ss]=i);const{featureIds:r}=i,o={featureCount:e.length,propertyTable:s,data:e};r.push(o),n.addObjectExtension(t,Ss,i)}function MA(n,t){var i;const e=(i=t.extensions)==null?void 0:i[Ss];if(!e)return;const s=e.featureIds;s.forEach((r,o)=>{if(r.data){const{accessorKey:a,index:c}=EA(t.attributes),h=new Uint32Array(r.data);s[o]={featureCount:h.length,propertyTable:r.propertyTable,attribute:c},n.gltf.buffers.push({arrayBuffer:h.buffer,byteOffset:h.byteOffset,byteLength:h.byteLength});const l=n.addBufferView(h),u=n.addAccessor(l,{size:1,componentType:Xi(h),count:h.length});t.attributes[a]=u}})}function EA(n){const t="_FEATURE_ID_",e=Object.keys(n).filter(r=>r.indexOf(t)===0);let s=-1;for(const r of e){const o=Number(r.substring(t.length));o>s&&(s=o)}return s++,{accessorKey:`${t}${s}`,index:s}}const CA=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:wA,decode:yA,encode:AA,name:gA},Symbol.toStringTag,{value:"Module"})),Os="EXT_structural_metadata",_A=Os;async function SA(n,t){const e=new et(n);RA(e,t)}function FA(n,t){const e=new et(n);return WA(e),e.createBinaryChunk(),e.gltf}function RA(n,t){var s,i;if(!((s=t.gltf)!=null&&s.loadBuffers))return;const e=n.getExtension(Os);e&&((i=t.gltf)!=null&&i.loadImages&&IA(n,e),DA(n,e))}function IA(n,t){const e=t.propertyTextures,s=n.gltf.json;if(e&&s.meshes)for(const i of s.meshes)for(const r of i.primitives)LA(n,e,r,t)}function DA(n,t){const e=t.schema;if(!e)return;const s=e.classes,i=t.propertyTables;if(s&&i)for(const r in s){const o=OA(i,r);o&&kA(n,e,o)}}function OA(n,t){for(const e of n)if(e.class===t)return e;return null}function LA(n,t,e,s){var o;if(!t)return;const i=(o=e.extensions)==null?void 0:o[Os],r=i==null?void 0:i.propertyTextures;if(r)for(const a of r){const c=t[a];NA(n,c,e,s)}}function NA(n,t,e,s){var r;if(!t.properties)return;s.dataAttributeNames||(s.dataAttributeNames=[]);const i=t.class;for(const o in t.properties){const a=`${i}_${o}`,c=(r=t.properties)==null?void 0:r[o];if(!c)continue;c.data||(c.data=[]);const h=c.data,l=xa(n,c,e);l!==null&&(ku(n,a,l,h,e),c.data=h,s.dataAttributeNames.push(a))}}function kA(n,t,e){var r,o;const s=(r=t.classes)==null?void 0:r[e.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${e.class}`);const i=e.count;for(const a in s.properties){const c=s.properties[a],h=(o=e.properties)==null?void 0:o[a];if(h){const l=PA(n,t,c,i,h);h.data=l}}}function PA(n,t,e,s,i){let r=[];const o=i.values,a=n.getTypedArrayForBufferView(o),c=GA(n,e,i,s),h=vA(n,i,s);switch(e.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{r=UA(e,s,a,c);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${e.type}`);case"STRING":{r=vu(s,a,c,h);break}case"ENUM":{r=zA(t,e,s,a,c);break}default:throw new Error(`Unknown classProperty type ${e.type}`)}return r}function GA(n,t,e,s){return t.array&&typeof t.count>"u"&&typeof e.arrayOffsets<"u"?Qi(n,e.arrayOffsets,e.arrayOffsetType||"UINT32",s):null}function vA(n,t,e){return typeof t.stringOffsets<"u"?Qi(n,t.stringOffsets,t.stringOffsetType||"UINT32",e):null}function UA(n,t,e,s){const i=n.array,r=n.count,o=Aa(n.type,n.componentType),a=e.byteLength/o;let c;return n.componentType?c=Yi(e,n.type,n.componentType,a):c=e,i?s?Pu(c,t,s,e.length,o):r?Gu(c,t,r):[]:c}function zA(n,t,e,s,i){var u;const r=t.enumType;if(!r)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=(u=n.enums)==null?void 0:u[r];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${r}`);const a=o.valueType||"UINT16",c=Aa(t.type,a),h=s.byteLength/c;let l=Yi(s,t.type,a,h);if(l||(l=s),t.array){if(i)return HA({valuesData:l,numberOfElements:e,arrayOffsets:i,valuesDataBytesLength:s.length,elementSize:c,enumEntry:o});const d=t.count;return d?jA(l,e,d,o):[]}return Ta(l,0,e,o)}function HA(n){const{valuesData:t,numberOfElements:e,arrayOffsets:s,valuesDataBytesLength:i,elementSize:r,enumEntry:o}=n,a=[];for(let c=0;c<e;c++){const h=s[c],l=s[c+1]-s[c];if(l+h>i)break;const u=h/r,d=l/r,f=Ta(t,u,d,o);a.push(f)}return a}function jA(n,t,e,s){const i=[];for(let r=0;r<t;r++){const o=e*r,a=Ta(n,o,e,s);i.push(a)}return i}function Ta(n,t,e,s){const i=[];for(let r=0;r<e;r++)if(n instanceof BigInt64Array||n instanceof BigUint64Array)i.push("");else{const o=n[t+r],a=VA(s,o);a?i.push(a.name):i.push("")}return i}function VA(n,t){for(const e of n.values)if(e.value===t)return e;return null}const JA="schemaClassId";function WA(n,t){var s,i;const e=n.getExtension(Os);if(e&&e.propertyTables)for(const r of e.propertyTables){const o=r.class,a=(i=(s=e.schema)==null?void 0:s.classes)==null?void 0:i[o];r.properties&&a&&qA(r,a,n)}}function qA(n,t,e){for(const s in n.properties){const i=n.properties[s].data;if(i){const r=t.properties[s];if(r){const o=YA(i,r,e);n.properties[s]=o}}}}function KA(n,t,e=JA){let s=n.getExtension(Os);s||(s=n.addExtension(Os)),s.schema=XA(t,e,s.schema);const i=QA(t,e,s.schema);return s.propertyTables||(s.propertyTables=[]),s.propertyTables.push(i)-1}function XA(n,t,e){const s=e??{id:"schema_id"},i={properties:{}};for(const r of n){const o={type:r.elementType,componentType:r.componentType};i.properties[r.name]=o}return s.classes={},s.classes[t]=i,s}function QA(n,t,e){var o;const s={class:t,count:0};let i=0;const r=(o=e.classes)==null?void 0:o[t];for(const a of n){if(i===0&&(i=a.values.length),i!==a.values.length&&a.values.length)throw new Error("Illegal values in attributes");(r==null?void 0:r.properties[a.name])&&(s.properties||(s.properties={}),s.properties[a.name]={values:0,data:a.values})}return s.count=i,s}function YA(n,t,e){const s={values:0};if(t.type==="STRING"){const{stringData:i,stringOffsets:r}=t0(n);s.stringOffsets=Rr(r,e),s.values=Rr(i,e)}else if(t.type==="SCALAR"&&t.componentType){const i=ZA(n,t.componentType);s.values=Rr(i,e)}return s}const $A={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function ZA(n,t){const e=[];for(const i of n)e.push(Number(i));const s=$A[t];if(!s)throw new Error("Illegal component type");return new s(e)}function t0(n){const t=new TextEncoder,e=[];let s=0;for(const c of n){const h=t.encode(c);s+=h.length,e.push(h)}const i=new Uint8Array(s),r=[];let o=0;for(const c of e)i.set(c,o),r.push(o),o+=c.length;r.push(o);const a=new Uint32Array(r);return{stringData:i,stringOffsets:a}}function Rr(n,t){return t.gltf.buffers.push({arrayBuffer:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}),t.addBufferView(n)}const e0=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:KA,decode:SA,encode:FA,name:_A},Symbol.toStringTag,{value:"Module"})),Uu="EXT_feature_metadata",s0=Uu;async function n0(n,t){const e=new et(n);i0(e,t)}function i0(n,t){var s,i;if(!((s=t.gltf)!=null&&s.loadBuffers))return;const e=n.getExtension(Uu);e&&((i=t.gltf)!=null&&i.loadImages&&r0(n,e),o0(n,e))}function r0(n,t){const e=t.schema;if(!e)return;const s=e.classes,{featureTextures:i}=t;if(s&&i)for(const r in s){const o=s[r],a=c0(i,r);a&&l0(n,a,o)}}function o0(n,t){const e=t.schema;if(!e)return;const s=e.classes,i=t.featureTables;if(s&&i)for(const r in s){const o=a0(i,r);o&&h0(n,e,o)}}function a0(n,t){for(const e in n){const s=n[e];if(s.class===t)return s}return null}function c0(n,t){for(const e in n){const s=n[e];if(s.class===t)return s}return null}function h0(n,t,e){var r,o;if(!e.class)return;const s=(r=t.classes)==null?void 0:r[e.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${e.class}`);const i=e.count;for(const a in s.properties){const c=s.properties[a],h=(o=e.properties)==null?void 0:o[a];if(h){const l=u0(n,t,c,i,h);h.data=l}}}function l0(n,t,e){var i;const s=t.class;for(const r in e.properties){const o=(i=t==null?void 0:t.properties)==null?void 0:i[r];if(o){const a=b0(n,o,s);o.data=a}}}function u0(n,t,e,s,i){let r=[];const o=i.bufferView,a=n.getTypedArrayForBufferView(o),c=d0(n,e,i,s),h=f0(n,e,i,s);return e.type==="STRING"||e.componentType==="STRING"?r=vu(s,a,c,h):p0(e)&&(r=m0(e,s,a,c)),r}function d0(n,t,e,s){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof e.arrayOffsetBufferView<"u"?Qi(n,e.arrayOffsetBufferView,e.offsetType||"UINT32",s):null}function f0(n,t,e,s){return typeof e.stringOffsetBufferView<"u"?Qi(n,e.stringOffsetBufferView,e.offsetType||"UINT32",s):null}function p0(n){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(n.type)||typeof n.componentType<"u"&&t.includes(n.componentType)}function m0(n,t,e,s){const i=n.type==="ARRAY",r=n.componentCount,o="SCALAR",a=n.componentType||n.type,c=Aa(o,a),h=e.byteLength/c,l=Yi(e,o,a,h);return i?s?Pu(l,t,s,e.length,c):r?Gu(l,t,r):[]:l}function b0(n,t,e){const s=n.gltf.json;if(!s.meshes)return[];const i=[];for(const r of s.meshes)for(const o of r.primitives)g0(n,e,t,i,o);return i}function g0(n,t,e,s,i){const r={channels:e.channels,...e.texture},o=xa(n,r,i);o&&ku(n,t,o,s,i)}const y0=Object.freeze(Object.defineProperty({__proto__:null,decode:n0,name:s0},Symbol.toStringTag,{value:"Module"})),A0="4.3.1",x0="4.3.1",Ri={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let Qc;async function Yc(n){tf(n.modules);const t=ef("basis");return t||(Qc||(Qc=T0(n)),await Qc)}async function T0(n){let t=null,e=null;return[t,e]=await Promise.all([await Je(Ri.TRANSCODER,"textures",n),await Je(Ri.TRANSCODER_WASM,"textures",n)]),t=t||globalThis.BASIS,await B0(t,e)}function B0(n,t){const e={};return t&&(e.wasmBinary=t),new Promise(s=>{n(e).then(i=>{const{BasisFile:r,initializeBasis:o}=i;o(),s({BasisFile:r})})})}let Ir;async function $c(n){const t=n.modules||{};return t.basisEncoder?t.basisEncoder:(Ir=Ir||w0(n),await Ir)}async function w0(n){let t=null,e=null;return[t,e]=await Promise.all([await Je(Ri.ENCODER,"textures",n),await Je(Ri.ENCODER_WASM,"textures",n)]),t=t||globalThis.BASIS,await M0(t,e)}function M0(n,t){const e={};return t&&(e.wasmBinary=t),new Promise(s=>{n(e).then(i=>{const{BasisFile:r,KTX2File:o,initializeBasis:a,BasisEncoder:c}=i;a(),s({BasisFile:r,KTX2File:o,BasisEncoder:c})})})}const as={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},E0=["","WEBKIT_","MOZ_"],Zc={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Wn=null;function C0(n){if(!Wn){n=n||_0()||void 0,Wn=new Set;for(const t of E0)for(const e in Zc)if(n&&n.getExtension(`${t}${e}`)){const s=Zc[e];Wn.add(s)}}return Wn}function _0(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const gt=[171,75,84,88,32,50,48,187,13,10,26,10];function S0(n){const t=new Uint8Array(n);return!(t.byteLength<gt.length||t[0]!==gt[0]||t[1]!==gt[1]||t[2]!==gt[2]||t[3]!==gt[3]||t[4]!==gt[4]||t[5]!==gt[5]||t[6]!==gt[6]||t[7]!==gt[7]||t[8]!==gt[8]||t[9]!==gt[9]||t[10]!==gt[10]||t[11]!==gt[11])}const F0={etc1:{basisFormat:0,compressed:!0,format:as.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:as.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:as.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:as.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:as.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:as.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function R0(n,t){if(t.basis.containerFormat==="auto"){if(S0(n)){const s=await $c(t);return th(s.KTX2File,n,t)}const{BasisFile:e}=await Yc(t);return Dr(e,n,t)}switch(t.basis.module){case"encoder":const e=await $c(t);switch(t.basis.containerFormat){case"ktx2":return th(e.KTX2File,n,t);case"basis":default:return Dr(e.BasisFile,n,t)}case"transcoder":default:const{BasisFile:s}=await Yc(t);return Dr(s,n,t)}}function Dr(n,t,e){const s=new n(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");const i=s.getNumImages(),r=[];for(let o=0;o<i;o++){const a=s.getNumLevels(o),c=[];for(let h=0;h<a;h++)c.push(I0(s,o,h,e));r.push(c)}return r}finally{s.close(),s.delete()}}function I0(n,t,e,s){const i=n.getImageWidth(t,e),r=n.getImageHeight(t,e),o=n.getHasAlpha(),{compressed:a,format:c,basisFormat:h}=zu(s,o),l=n.getImageTranscodedSizeInBytes(t,e,h),u=new Uint8Array(l);if(!n.transcodeImage(u,t,e,h,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:r,data:u,compressed:a,format:c,hasAlpha:o}}function th(n,t,e){const s=new n(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=s.getLevels(),r=[];for(let o=0;o<i;o++)r.push(D0(s,o,e));return[r]}finally{s.close(),s.delete()}}function D0(n,t,e){const{alphaFlag:s,height:i,width:r}=n.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:c}=zu(e,s),h=n.getImageTranscodedSizeInBytes(t,0,0,c),l=new Uint8Array(h);if(!n.transcodeImage(l,t,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:r,height:i,data:l,compressed:o,levelSize:h,hasAlpha:s,format:a}}function zu(n,t){let e=n&&n.basis&&n.basis.format;return e==="auto"&&(e=Hu()),typeof e=="object"&&(e=t?e.alpha:e.noAlpha),e=e.toLowerCase(),F0[e]}function Hu(){const n=C0();return n.has("astc")?"astc-4x4":n.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:n.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:n.has("etc1")?"etc1":n.has("etc2")?"etc2":"rgb565"}const O0={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:x0,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},L0={...O0,parse:R0},Ls=!0,eh=1735152710,Ba=12,Ii=8,N0=1313821514,k0=5130562,P0=0,G0=0,v0=1;function U0(n,t=0){return`${String.fromCharCode(n.getUint8(t+0))}${String.fromCharCode(n.getUint8(t+1))}${String.fromCharCode(n.getUint8(t+2))}${String.fromCharCode(n.getUint8(t+3))}`}function z0(n,t=0,e={}){const s=new DataView(n),{magic:i=eh}=e,r=s.getUint32(t,!1);return r===i||r===eh}function H0(n,t,e=0,s={}){const i=new DataView(t),r=U0(i,e+0),o=i.getUint32(e+4,Ls),a=i.getUint32(e+8,Ls);switch(Object.assign(n,{header:{byteOffset:e,byteLength:a,hasBinChunk:!1},type:r,version:o,json:{},binChunks:[]}),e+=Ba,n.version){case 1:return j0(n,i,e);case 2:return V0(n,i,e,s={});default:throw new Error(`Invalid GLB version ${n.version}. Only supports version 1 and 2.`)}}function j0(n,t,e){j(n.header.byteLength>Ba+Ii);const s=t.getUint32(e+0,Ls),i=t.getUint32(e+4,Ls);return e+=Ii,j(i===P0),Oo(n,t,e,s),e+=s,e+=Lo(n,t,e,n.header.byteLength),e}function V0(n,t,e,s){return j(n.header.byteLength>Ba+Ii),J0(n,t,e,s),e+n.header.byteLength}function J0(n,t,e,s){for(;e+8<=n.header.byteLength;){const i=t.getUint32(e+0,Ls),r=t.getUint32(e+4,Ls);switch(e+=Ii,r){case N0:Oo(n,t,e,i);break;case k0:Lo(n,t,e,i);break;case G0:s.strict||Oo(n,t,e,i);break;case v0:s.strict||Lo(n,t,e,i);break}e+=wn(i,4)}return e}function Oo(n,t,e,s){const i=new Uint8Array(t.buffer,e,s),o=new TextDecoder("utf8").decode(i);return n.json=JSON.parse(o),wn(s,4)}function Lo(n,t,e,s){return n.header.hasBinChunk=!0,n.binChunks.push({byteOffset:e,byteLength:s,arrayBuffer:t.buffer}),wn(s,4)}function ju(n,t){if(n.startsWith("data:")||n.startsWith("http:")||n.startsWith("https:"))return n;const s=t.baseUri||t.uri;if(!s)throw new Error(`'baseUri' must be provided to resolve relative url ${n}`);return s.substr(0,s.lastIndexOf("/")+1)+n}const W0="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",q0="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",K0=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),X0=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Q0={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Y0={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function $0(n,t,e,s,i,r="NONE"){const o=await Z0();s1(o,o.exports[Y0[i]],n,t,e,s,o.exports[Q0[r||"NONE"]])}let Or;async function Z0(){return Or||(Or=t1()),Or}async function t1(){let n=W0;WebAssembly.validate(K0)&&(n=q0,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(e1(n),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function e1(n){const t=new Uint8Array(n.length);for(let s=0;s<n.length;++s){const i=n.charCodeAt(s);t[s]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let e=0;for(let s=0;s<n.length;++s)t[e++]=t[s]<60?X0[t[s]]:(t[s]-60)*64+t[++s];return t.buffer.slice(0,e)}function s1(n,t,e,s,i,r,o){const a=n.exports.sbrk,c=s+3&-4,h=a(c*i),l=a(r.length),u=new Uint8Array(n.exports.memory.buffer);u.set(r,l);const d=t(h,s,i,l,r.length);if(d===0&&o&&o(h,c,i),e.set(u.subarray(h,h+s*i)),a(h-a(0)),d!==0)throw new Error(`Malformed buffer data: ${d}`)}const Di="EXT_meshopt_compression",n1=Di;async function i1(n,t){var i,r;const e=new et(n);if(!((i=t==null?void 0:t.gltf)!=null&&i.decompressMeshes)||!((r=t.gltf)!=null&&r.loadBuffers))return;const s=[];for(const o of n.json.bufferViews||[])s.push(r1(e,o));await Promise.all(s),e.removeExtension(Di)}async function r1(n,t){const e=n.getObjectExtension(t,Di);if(e){const{byteOffset:s=0,byteLength:i=0,byteStride:r,count:o,mode:a,filter:c="NONE",buffer:h}=e,l=n.gltf.buffers[h],u=new Uint8Array(l.arrayBuffer,l.byteOffset+s,i),d=new Uint8Array(n.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await $0(d,o,r,u,a,c),n.removeObjectExtension(t,Di)}}const o1=Object.freeze(Object.defineProperty({__proto__:null,decode:i1,name:n1},Symbol.toStringTag,{value:"Module"})),Bs="EXT_texture_webp",a1=Bs;function c1(n,t){const e=new et(n);if(!eA("image/webp")){if(e.getRequiredExtensions().includes(Bs))throw new Error(`gltf: Required extension ${Bs} not supported by browser`);return}const{json:s}=e;for(const i of s.textures||[]){const r=e.getObjectExtension(i,Bs);r&&(i.source=r.source),e.removeObjectExtension(i,Bs)}e.removeExtension(Bs)}const h1=Object.freeze(Object.defineProperty({__proto__:null,name:a1,preprocess:c1},Symbol.toStringTag,{value:"Module"})),Mi="KHR_texture_basisu",l1=Mi;function u1(n,t){const e=new et(n),{json:s}=e;for(const i of s.textures||[]){const r=e.getObjectExtension(i,Mi);r&&(i.source=r.source,e.removeObjectExtension(i,Mi))}e.removeExtension(Mi)}const d1=Object.freeze(Object.defineProperty({__proto__:null,name:l1,preprocess:u1},Symbol.toStringTag,{value:"Module"}));function f1(n){const t={};for(const e in n){const s=n[e];if(e!=="indices"){const i=Vu(s);t[e]=i}}return t}function Vu(n){const{buffer:t,size:e,count:s}=p1(n);return{value:t,size:e,byteOffset:0,count:s,type:Du(e),componentType:Xi(t)}}function p1(n){let t=n,e=1,s=0;return n&&n.value&&(t=n.value,e=n.size||1),t&&(ArrayBuffer.isView(t)||(t=m1(t,Float32Array)),s=t.length/e),{buffer:t,size:e,count:s}}function m1(n,t,e=!1){return n?Array.isArray(n)?new t(n):e&&!(n instanceof t)?new t(n):n:null}const Ke="KHR_draco_mesh_compression",b1=Ke;function g1(n,t,e){const s=new et(n);for(const i of Ju(s))s.getObjectExtension(i,Ke)}async function y1(n,t,e){var r;if(!((r=t==null?void 0:t.gltf)!=null&&r.decompressMeshes))return;const s=new et(n),i=[];for(const o of Ju(s))s.getObjectExtension(o,Ke)&&i.push(x1(s,o,t,e));await Promise.all(i),s.removeExtension(Ke)}function A1(n,t={}){const e=new et(n);for(const s of e.json.meshes||[])T1(),e.addRequiredExtension(Ke)}async function x1(n,t,e,s){const i=n.getObjectExtension(t,Ke);if(!i)return;const r=n.getTypedArrayForBufferView(i.bufferView),o=ea(r.buffer,r.byteOffset),a={...e};delete a["3d-tiles"];const c=await Tn(o,wu,a,s),h=f1(c.attributes);for(const[l,u]of Object.entries(h))if(l in t.attributes){const d=t.attributes[l],f=n.getAccessor(d);f!=null&&f.min&&(f!=null&&f.max)&&(u.min=f.min,u.max=f.max)}t.attributes=h,c.indices&&(t.indices=Vu(c.indices)),n.removeObjectExtension(t,Ke),B1(t)}function T1(n,t,e=4,s,i){if(!s.DracoWriter)throw new Error("options.gltf.DracoWriter not provided")}function B1(n){if(!n.attributes&&Object.keys(n.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Ju(n){for(const t of n.json.meshes||[])for(const e of t.primitives)yield e}const w1=Object.freeze(Object.defineProperty({__proto__:null,decode:y1,encode:A1,name:b1,preprocess:g1},Symbol.toStringTag,{value:"Module"})),$i="KHR_texture_transform",M1=$i,qn=new w,E1=new q,C1=new q;async function _1(n,t){var r;if(!new et(n).hasExtension($i)||!((r=t.gltf)!=null&&r.loadBuffers))return;const i=n.json.materials||[];for(let o=0;o<i.length;o++)S1(o,n)}function S1(n,t){var r,o,a,c;const e=(r=t.json.materials)==null?void 0:r[n],s=[(o=e==null?void 0:e.pbrMetallicRoughness)==null?void 0:o.baseColorTexture,e==null?void 0:e.emissiveTexture,e==null?void 0:e.normalTexture,e==null?void 0:e.occlusionTexture,(a=e==null?void 0:e.pbrMetallicRoughness)==null?void 0:a.metallicRoughnessTexture],i=[];for(const h of s)h&&((c=h==null?void 0:h.extensions)!=null&&c[$i])&&F1(t,n,h,i)}function F1(n,t,e,s){const i=R1(e,s);if(!i)return;const r=n.json.meshes||[];for(const o of r)for(const a of o.primitives){const c=a.material;Number.isFinite(c)&&t===c&&I1(n,a,i)}}function R1(n,t){var o;const e=(o=n.extensions)==null?void 0:o[$i],{texCoord:s=0}=n,{texCoord:i=s}=e;if(!(t.findIndex(([a,c])=>a===s&&c===i)!==-1)){const a=L1(e);return s!==i&&(n.texCoord=i),t.push([s,i]),{originalTexCoord:s,texCoord:i,matrix:a}}return null}function I1(n,t,e){var a,c;const{originalTexCoord:s,texCoord:i,matrix:r}=e,o=t.attributes[`TEXCOORD_${s}`];if(Number.isFinite(o)){const h=(a=n.json.accessors)==null?void 0:a[o];if(h&&h.bufferView){const l=(c=n.json.bufferViews)==null?void 0:c[h.bufferView];if(l){const{arrayBuffer:u,byteOffset:d}=n.buffers[l.buffer],f=(d||0)+(h.byteOffset||0)+(l.byteOffset||0),{ArrayType:p,length:m}=ya(h,l),g=Iu[h.componentType],b=Ru[h.type],y=l.byteStride||g*b,x=new Float32Array(m);for(let A=0;A<h.count;A++){const B=new p(u,f+A*y,2);qn.set(B[0],B[1],1),qn.transformByMatrix3(r),x.set([qn[0],qn[1]],A*b)}s===i?D1(h,l,n.buffers,x):O1(i,h,t,n,x)}}}}function D1(n,t,e,s){n.componentType=5126,e.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength}),t.buffer=e.length-1,t.byteLength=s.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function O1(n,t,e,s,i){s.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const r=s.json.bufferViews;if(!r)return;r.push({buffer:s.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const o=s.json.accessors;o&&(o.push({bufferView:(r==null?void 0:r.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),e.attributes[`TEXCOORD_${n}`]=o.length-1)}function L1(n){const{offset:t=[0,0],rotation:e=0,scale:s=[1,1]}=n,i=new q().set(1,0,0,0,1,0,t[0],t[1],1),r=E1.set(Math.cos(e),Math.sin(e),0,-Math.sin(e),Math.cos(e),0,0,0,1),o=C1.set(s[0],0,0,0,s[1],0,0,0,1);return i.multiplyRight(r).multiplyRight(o)}const N1=Object.freeze(Object.defineProperty({__proto__:null,decode:_1,name:M1},Symbol.toStringTag,{value:"Module"})),je="KHR_lights_punctual",k1=je;async function P1(n){const t=new et(n),{json:e}=t,s=t.getExtension(je);s&&(t.json.lights=s.lights,t.removeExtension(je));for(const i of e.nodes||[]){const r=t.getObjectExtension(i,je);r&&(i.light=r.light),t.removeObjectExtension(i,je)}}async function G1(n){const t=new et(n),{json:e}=t;if(e.lights){const s=t.addExtension(je);Tt(!s.lights),s.lights=e.lights,delete e.lights}if(t.json.lights){for(const s of t.json.lights){const i=s.node;t.addObjectExtension(i,je,s)}delete t.json.lights}}const v1=Object.freeze(Object.defineProperty({__proto__:null,decode:P1,encode:G1,name:k1},Symbol.toStringTag,{value:"Module"})),mn="KHR_materials_unlit",U1=mn;async function z1(n){const t=new et(n),{json:e}=t;for(const s of e.materials||[])s.extensions&&s.extensions.KHR_materials_unlit&&(s.unlit=!0),t.removeObjectExtension(s,mn);t.removeExtension(mn)}function H1(n){const t=new et(n),{json:e}=t;if(t.materials)for(const s of e.materials||[])s.unlit&&(delete s.unlit,t.addObjectExtension(s,mn,{}),t.addExtension(mn))}const j1=Object.freeze(Object.defineProperty({__proto__:null,decode:z1,encode:H1,name:U1},Symbol.toStringTag,{value:"Module"})),sn="KHR_techniques_webgl",V1=sn;async function J1(n){const t=new et(n),{json:e}=t,s=t.getExtension(sn);if(s){const i=q1(s,t);for(const r of e.materials||[]){const o=t.getObjectExtension(r,sn);o&&(r.technique=Object.assign({},o,i[o.technique]),r.technique.values=K1(r.technique,t)),t.removeObjectExtension(r,sn)}t.removeExtension(sn)}}async function W1(n,t){}function q1(n,t){const{programs:e=[],shaders:s=[],techniques:i=[]}=n,r=new TextDecoder;return s.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=r.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),e.forEach(o=>{o.fragmentShader=s[o.fragmentShader],o.vertexShader=s[o.vertexShader]}),i.forEach(o=>{o.program=e[o.program]}),i}function K1(n,t){const e=Object.assign({},n.values);return Object.keys(n.uniforms||{}).forEach(s=>{n.uniforms[s].value&&!(s in e)&&(e[s]=n.uniforms[s].value)}),Object.keys(e).forEach(s=>{typeof e[s]=="object"&&e[s].index!==void 0&&(e[s].texture=t.getTexture(e[s].index))}),e}const X1=Object.freeze(Object.defineProperty({__proto__:null,decode:J1,encode:W1,name:V1},Symbol.toStringTag,{value:"Module"})),Wu=[e0,CA,o1,h1,d1,w1,v1,j1,X1,N1,y0];function Q1(n,t={},e){var i;const s=Wu.filter(r=>qu(r.name,t));for(const r of s)(i=r.preprocess)==null||i.call(r,n,t,e)}async function Y1(n,t={},e){var i;const s=Wu.filter(r=>qu(r.name,t));for(const r of s)await((i=r.decode)==null?void 0:i.call(r,n,t,e))}function qu(n,t){var i;const e=((i=t==null?void 0:t.gltf)==null?void 0:i.excludeExtensions)||{};return!(n in e&&!e[n])}const Lr="KHR_binary_glTF";function $1(n){const t=new et(n),{json:e}=t;for(const s of e.images||[]){const i=t.getObjectExtension(s,Lr);i&&Object.assign(s,i),t.removeObjectExtension(s,Lr)}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,t.removeExtension(Lr)}const sh={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Z1={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class tx{constructor(){T(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});T(this,"json")}normalize(t,e){this.json=t.json;const s=t.json;switch(s.asset&&s.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${s.asset.version}`);return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(s),this._convertTopLevelObjectsToArrays(s),$1(t),this._convertObjectIdsToArrayIndices(s),this._updateObjects(s),this._updateMaterial(s)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in sh)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const s=t[e];if(!(!s||Array.isArray(s))){t[e]=[];for(const i in s){const r=s[i];r.id=r.id||i;const o=t[e].length;t[e].push(r),this.idToIndexMap[e][i]=o}}}_convertObjectIdsToArrayIndices(t){for(const e in sh)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:s,indices:i,material:r}=e;for(const o in s)s[o]=this._convertIdToIndex(s[o],"accessor");i&&(e.indices=this._convertIdToIndex(i,"accessor")),r&&(e.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn(`gltf v1: json doesn't contain attribute ${e}`),t[e]=[]);for(const s of t[e])for(const i in s){const r=s[i],o=this._convertIdToIndex(r,i);s[i]=o}}_convertIdToIndex(t,e){const s=Z1[e];if(s in this.idToIndexMap){const i=this.idToIndexMap[s][t];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${e} with id ${t}`);return i}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){var e,s,i;for(const r of t.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((e=r.values)==null?void 0:e.tex)||((s=r.values)==null?void 0:s.texture2d_0)||((i=r.values)==null?void 0:i.diffuseTex),a=t.textures.findIndex(c=>c.id===o);a!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:a})}}}function ex(n,t={}){return new tx().normalize(n,t)}async function sx(n,t,e=0,s,i){var r,o,a;return nx(n,t,e,s),ex(n,{normalize:(r=s==null?void 0:s.gltf)==null?void 0:r.normalize}),Q1(n,s,i),(o=s==null?void 0:s.gltf)!=null&&o.loadBuffers&&n.json.buffers&&await ix(n,s,i),(a=s==null?void 0:s.gltf)!=null&&a.loadImages&&await rx(n,s,i),await Y1(n,s,i),n}function nx(n,t,e,s){if(s.uri&&(n.baseUri=s.uri),t instanceof ArrayBuffer&&!z0(t,e,s)&&(t=new TextDecoder().decode(t)),typeof t=="string")n.json=wf(t);else if(t instanceof ArrayBuffer){const o={};e=H0(o,t,e,s.glb),Tt(o.type==="glTF",`Invalid GLB magic string ${o.type}`),n._glb=o,n.json=o.json}else Tt(!1,"GLTF: must be ArrayBuffer or string");const i=n.json.buffers||[];if(n.buffers=new Array(i.length).fill(null),n._glb&&n._glb.header.hasBinChunk){const{binChunks:o}=n._glb;n.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const r=n.json.images||[];n.images=new Array(r.length).fill({})}async function ix(n,t,e){var i,r;const s=n.json.buffers||[];for(let o=0;o<s.length;++o){const a=s[o];if(a.uri){const{fetch:c}=e;Tt(c);const h=ju(a.uri,t),l=await((i=e==null?void 0:e.fetch)==null?void 0:i.call(e,h)),u=await((r=l==null?void 0:l.arrayBuffer)==null?void 0:r.call(l));n.buffers[o]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete a.uri}else n.buffers[o]===null&&(n.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function rx(n,t,e){const s=ox(n),i=n.json.images||[],r=[];for(const o of s)r.push(ax(n,i[o],o,t,e));return await Promise.all(r)}function ox(n){const t=new Set,e=n.json.textures||[];for(const s of e)s.source!==void 0&&t.add(s.source);return Array.from(t).sort()}async function ax(n,t,e,s,i){let r;if(t.uri&&!t.hasOwnProperty("bufferView")){const a=ju(t.uri,s),{fetch:c}=i;r=await(await c(a)).arrayBuffer(),t.bufferView={data:r}}if(Number.isFinite(t.bufferView)){const a=uA(n.json,n.buffers,t.bufferView);r=ea(a.buffer,a.byteOffset,a.byteLength)}Tt(r,"glTF image has no data");let o=await Tn(r,[tA,L0],{...s,mimeType:t.mimeType,basis:s.basis||{format:Hu()}},i);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),n.images=n.images||[],n.images[e]=o}const Oi={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:A0,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:cx,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function cx(n,t={},e){t={...Oi.options,...t},t.gltf={...Oi.options.gltf,...t.gltf};const{byteOffset:s=0}=t;return await sx({},n,s,t,e)}const hx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lx={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Et={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},ux={magFilter:Et.TEXTURE_MAG_FILTER,minFilter:Et.TEXTURE_MIN_FILTER,wrapS:Et.TEXTURE_WRAP_S,wrapT:Et.TEXTURE_WRAP_T},dx={[Et.TEXTURE_MAG_FILTER]:Et.LINEAR,[Et.TEXTURE_MIN_FILTER]:Et.NEAREST_MIPMAP_LINEAR,[Et.TEXTURE_WRAP_S]:Et.REPEAT,[Et.TEXTURE_WRAP_T]:Et.REPEAT};function fx(){return{id:"default-sampler",parameters:dx}}function px(n){return lx[n]}function mx(n){return hx[n]}class bx{constructor(){T(this,"baseUri","");T(this,"jsonUnprocessed");T(this,"json");T(this,"buffers",[]);T(this,"images",[])}postProcess(t,e={}){const{json:s,buffers:i=[],images:r=[]}=t,{baseUri:o=""}=t;return Tt(s),this.baseUri=o,this.buffers=i,this.images=r,this.jsonUnprocessed=s,this.json=this._resolveTree(t.json,e),this.json}_resolveTree(t,e={}){const s={...t};return this.json=s,t.bufferViews&&(s.bufferViews=t.bufferViews.map((i,r)=>this._resolveBufferView(i,r))),t.images&&(s.images=t.images.map((i,r)=>this._resolveImage(i,r))),t.samplers&&(s.samplers=t.samplers.map((i,r)=>this._resolveSampler(i,r))),t.textures&&(s.textures=t.textures.map((i,r)=>this._resolveTexture(i,r))),t.accessors&&(s.accessors=t.accessors.map((i,r)=>this._resolveAccessor(i,r))),t.materials&&(s.materials=t.materials.map((i,r)=>this._resolveMaterial(i,r))),t.meshes&&(s.meshes=t.meshes.map((i,r)=>this._resolveMesh(i,r))),t.nodes&&(s.nodes=t.nodes.map((i,r)=>this._resolveNode(i,r)),s.nodes=s.nodes.map((i,r)=>this._resolveNodeChildren(i))),t.skins&&(s.skins=t.skins.map((i,r)=>this._resolveSkin(i,r))),t.scenes&&(s.scenes=t.scenes.map((i,r)=>this._resolveScene(i,r))),typeof this.json.scene=="number"&&s.scenes&&(s.scene=s.scenes[this.json.scene]),s}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,e){if(typeof e=="object")return e;const s=t&&t[e];return s||console.warn(`glTF file error: Could not find ${t}[${e}]`),s}_resolveScene(t,e){return{...t,id:t.id||`scene-${e}`,nodes:(t.nodes||[]).map(s=>this.getNode(s))}}_resolveNode(t,e){const s={...t,id:(t==null?void 0:t.id)||`node-${e}`};return t.mesh!==void 0&&(s.mesh=this.getMesh(t.mesh)),t.camera!==void 0&&(s.camera=this.getCamera(t.camera)),t.skin!==void 0&&(s.skin=this.getSkin(t.skin)),t.meshes!==void 0&&t.meshes.length&&(s.mesh=t.meshes.reduce((i,r)=>{const o=this.getMesh(r);return i.id=o.id,i.primitives=i.primitives.concat(o.primitives),i},{primitives:[]})),s}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map(e=>this.getNode(e))),t}_resolveSkin(t,e){const s=typeof t.inverseBindMatrices=="number"?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${e}`,inverseBindMatrices:s}}_resolveMesh(t,e){const s={...t,id:t.id||`mesh-${e}`,primitives:[]};return t.primitives&&(s.primitives=t.primitives.map(i=>{const r={...i,attributes:{},indices:void 0,material:void 0},o=i.attributes;for(const a in o)r.attributes[a]=this.getAccessor(o[a]);return i.indices!==void 0&&(r.indices=this.getAccessor(i.indices)),i.material!==void 0&&(r.material=this.getMaterial(i.material)),r})),s}_resolveMaterial(t,e){const s={...t,id:t.id||`material-${e}`};if(s.normalTexture&&(s.normalTexture={...s.normalTexture},s.normalTexture.texture=this.getTexture(s.normalTexture.index)),s.occlusionTexture&&(s.occlusionTexture={...s.occlusionTexture},s.occlusionTexture.texture=this.getTexture(s.occlusionTexture.index)),s.emissiveTexture&&(s.emissiveTexture={...s.emissiveTexture},s.emissiveTexture.texture=this.getTexture(s.emissiveTexture.index)),s.emissiveFactor||(s.emissiveFactor=s.emissiveTexture?[1,1,1]:[0,0,0]),s.pbrMetallicRoughness){s.pbrMetallicRoughness={...s.pbrMetallicRoughness};const i=s.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return s}_resolveAccessor(t,e){const s=px(t.componentType),i=mx(t.type),r=s*i,o={...t,id:t.id||`accessor-${e}`,bytesPerComponent:s,components:i,bytesPerElement:r,value:void 0,bufferView:void 0,sparse:void 0};if(t.bufferView!==void 0&&(o.bufferView=this.getBufferView(t.bufferView)),o.bufferView){const a=o.bufferView.buffer,{ArrayType:c,byteLength:h}=ya(o,o.bufferView),l=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+a.byteOffset;let u=a.arrayBuffer.slice(l,l+h);o.bufferView.byteStride&&(u=this._getValueFromInterleavedBuffer(a,l,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new c(u)}return o}_getValueFromInterleavedBuffer(t,e,s,i,r){const o=new Uint8Array(r*i);for(let a=0;a<r;a++){const c=e+a*s;o.set(new Uint8Array(t.arrayBuffer.slice(c,c+i)),a*i)}return o.buffer}_resolveTexture(t,e){return{...t,id:t.id||`texture-${e}`,sampler:typeof t.sampler=="number"?this.getSampler(t.sampler):fx(),source:typeof t.source=="number"?this.getImage(t.source):void 0}}_resolveSampler(t,e){const s={id:t.id||`sampler-${e}`,...t,parameters:{}};for(const i in s){const r=this._enumSamplerParameter(i);r!==void 0&&(s.parameters[r]=s[i])}return s}_enumSamplerParameter(t){return ux[t]}_resolveImage(t,e){const s={...t,id:t.id||`image-${e}`,image:null,bufferView:t.bufferView!==void 0?this.getBufferView(t.bufferView):void 0},i=this.images[e];return i&&(s.image=i),s}_resolveBufferView(t,e){const s=t.buffer,i=this.buffers[s].arrayBuffer;let r=this.buffers[s].byteOffset||0;return t.byteOffset&&(r+=t.byteOffset),{id:`bufferView-${e}`,...t,buffer:this.buffers[s],data:new Uint8Array(i,r,t.byteLength)}}_resolveCamera(t,e){const s={...t,id:t.id||`camera-${e}`};return s.perspective,s.orthographic,s}}function Ku(n,t){return new bx().postProcess(n,t)}const No={URI:0,EMBEDDED:1};function Xu(n,t,e,s){n.rotateYtoZ=!0;const i=(n.byteOffset||0)+(n.byteLength||0)-e;if(i===0)throw new Error("glTF byte length must be greater than 0.");return n.gltfUpAxis=s!=null&&s["3d-tiles"]&&s["3d-tiles"].assetGltfUpAxis?s["3d-tiles"].assetGltfUpAxis:"Y",n.gltfArrayBuffer=ea(t,e,i),n.gltfByteOffset=0,n.gltfByteLength=i,e%4===0||console.warn(`${n.type}: embedded glb is not aligned to a 4-byte boundary.`),(n.byteOffset||0)+(n.byteLength||0)}async function Qu(n,t,e,s){const i=(e==null?void 0:e["3d-tiles"])||{};if(gx(n,t),i.loadGLTF){if(!s)return;if(n.gltfUrl){const{fetch:r}=s,o=await r(n.gltfUrl,e);n.gltfArrayBuffer=await o.arrayBuffer(),n.gltfByteOffset=0}if(n.gltfArrayBuffer){const r=await Tn(n.gltfArrayBuffer,Oi,e,s);n.gltf=Ku(r),n.gpuMemoryUsageInBytes=Ou(n.gltf),delete n.gltfArrayBuffer,delete n.gltfByteOffset,delete n.gltfByteLength}}}function gx(n,t,e){switch(t){case No.URI:if(n.gltfArrayBuffer){const s=new Uint8Array(n.gltfArrayBuffer,n.gltfByteOffset),r=new TextDecoder().decode(s);n.gltfUrl=r.replace(/[\s\0]+$/,"")}delete n.gltfArrayBuffer,delete n.gltfByteOffset,delete n.gltfByteLength;break;case No.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function yx(n,t,e,s,i){var o;e=Ax(n,t,e,s),await Qu(n,No.EMBEDDED,s,i);const r=(o=n==null?void 0:n.gltf)==null?void 0:o.extensions;return r&&r.CESIUM_RTC&&(n.rtcCenter=r.CESIUM_RTC.center),e}function Ax(n,t,e,s,i){e=Ki(n,t,e),e=pa(n,t,e),e=ma(n,t,e),e=Xu(n,t,e,s);const r=new fa(n.featureTableJson,n.featureTableBinary);return n.rtcCenter=r.getGlobalProperty("RTC_CENTER",k.FLOAT,3),e}async function xx(n,t,e,s,i){return e=Tx(n,t,e,s),await Qu(n,n.gltfFormat||0,s,i),e}function Tx(n,t,e,s,i){var h;if(e=Ki(n,t,e),n.version!==1)throw new Error(`Instanced 3D Model version ${n.version} is not supported`);e=pa(n,t,e);const r=new DataView(t);if(n.gltfFormat=r.getUint32(e,!0),e+=4,e=ma(n,t,e),e=Xu(n,t,e,s),!((h=n==null?void 0:n.header)!=null&&h.featureTableJsonByteLength)||n.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new fa(n.featureTableJson,n.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");n.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),n.rtcCenter=o.getGlobalProperty("RTC_CENTER",k.FLOAT,3);const c=new Eu(n.batchTableJson,n.batchTableBinary,a);return Bx(n,o,c,a),e}function Bx(n,t,e,s){const i=new Array(s),r=new w;new w,new w,new w;const o=new q,a=new Fi,c=new w,h={},l=new V,u=[],d=[],f=[],p=[];for(let m=0;m<s;m++){let g;if(t.hasProperty("POSITION"))g=t.getProperty("POSITION",k.FLOAT,3,m,r);else if(t.hasProperty("POSITION_QUANTIZED")){g=t.getProperty("POSITION_QUANTIZED",k.UNSIGNED_SHORT,3,m,r);const E=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",k.FLOAT,3);if(!E)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const C=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",k.FLOAT,3);if(!C)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const S=65535;for(let F=0;F<3;F++)g[F]=g[F]/S*C[F]+E[F]}if(!g)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(r.copy(g),h.translation=r,n.normalUp=t.getProperty("NORMAL_UP",k.FLOAT,3,m,u),n.normalRight=t.getProperty("NORMAL_RIGHT",k.FLOAT,3,m,d),n.normalUp){if(!n.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");n.hasCustomOrientation=!0}else{if(n.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",k.UNSIGNED_SHORT,2,m,u),n.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",k.UNSIGNED_SHORT,2,m,d),n.octNormalUp)throw n.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");n.eastNorthUp?(J.WGS84.eastNorthUpToFixedFrame(r,l),l.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),h.rotation=a,c.set(1,1,1);const b=t.getProperty("SCALE",k.FLOAT,1,m,f);Number.isFinite(b)&&c.multiplyByScalar(b);const y=t.getProperty("SCALE_NON_UNIFORM",k.FLOAT,3,m,u);y&&c.scale(y),h.scale=c;let x=t.getProperty("BATCH_ID",k.UNSIGNED_SHORT,1,m,p);x===void 0&&(x=m);const A=new V().fromQuaternion(h.rotation);l.identity(),l.translate(h.translation),l.multiplyRight(A),l.scale(h.scale);const B=l.clone();i[m]={modelMatrix:B,batchId:x}}n.instances=i}async function wx(n,t,e,s,i,r){e=Ki(n,t,e);const o=new DataView(t);for(n.tilesLength=o.getUint32(e,!0),e+=4,n.tiles=[];n.tiles.length<n.tilesLength&&(n.byteLength||0)-e>12;){const a={shape:"tile3d"};n.tiles.push(a),e=await r(t,e,s,i,a)}return e}async function Mx(n,t,e,s){var i,r;if(n.rotateYtoZ=!0,n.gltfUpAxis=(i=e==null?void 0:e["3d-tiles"])!=null&&i.assetGltfUpAxis?e["3d-tiles"].assetGltfUpAxis:"Y",(r=e==null?void 0:e["3d-tiles"])!=null&&r.loadGLTF){if(!s)return t.byteLength;const o=await Tn(t,Oi,e,s);n.gltf=Ku(o),n.gpuMemoryUsageInBytes=Ou(n.gltf)}else n.gltfArrayBuffer=t;return t.byteLength}async function Yu(n,t=0,e,s,i={shape:"tile3d"}){switch(i.byteOffset=t,i.type=Rg(n,t),i.type){case Vs.COMPOSITE:return await wx(i,n,t,e,s,Yu);case Vs.BATCHED_3D_MODEL:return await yx(i,n,t,e,s);case Vs.GLTF:return await Mx(i,n,e,s);case Vs.INSTANCED_3D_MODEL:return await xx(i,n,t,e,s);case Vs.POINT_CLOUD:return await fy(i,n,t,e,s);default:throw new Error(`3DTileLoader: unknown type ${i.type}`)}}const Ex=1952609651,Cx=1;async function _x(n,t,e){if(new Uint32Array(n.slice(0,4))[0]!==Ex)throw new Error("Wrong subtree file magic number");if(new Uint32Array(n.slice(4,8))[0]!==Cx)throw new Error("Wrong subtree file verson, must be 1");const r=nh(n.slice(8,16)),o=new Uint8Array(n,24,r),c=new TextDecoder("utf8").decode(o),h=JSON.parse(c),l=nh(n.slice(16,24));let u=new ArrayBuffer(0);if(l&&(u=n.slice(24+r)),await Kn(h,h.tileAvailability,u,e),Array.isArray(h.contentAvailability))for(const d of h.contentAvailability)await Kn(h,d,u,e);else await Kn(h,h.contentAvailability,u,e);return await Kn(h,h.childSubtreeAvailability,u,e),h}async function Kn(n,t,e,s){const i=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if(typeof i!="number")return;const r=n.bufferViews[i],o=n.buffers[r.buffer];if(!(s!=null&&s.baseUrl))throw new Error("Url is not provided");if(!s.fetch)throw new Error("fetch is not provided");if(o.uri){const c=`${(s==null?void 0:s.baseUrl)||""}/${o.uri}`,l=await(await s.fetch(c)).arrayBuffer();t.explicitBitstream=new Uint8Array(l,r.byteOffset,r.byteLength);return}const a=n.buffers.slice(0,r.buffer).reduce((c,h)=>c+h.byteLength,0);t.explicitBitstream=new Uint8Array(e.slice(a,a+o.byteLength),r.byteOffset,r.byteLength)}function nh(n){const t=new DataView(n),e=t.getUint32(0,!0),s=t.getUint32(4,!0);return e+2**32*s}const $u={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:xu,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:_x,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var St=null;try{St=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function H(n,t,e){this.low=n|0,this.high=t|0,this.unsigned=!!e}H.prototype.__isLong__;Object.defineProperty(H.prototype,"__isLong__",{value:!0});function ct(n){return(n&&n.__isLong__)===!0}function ih(n){var t=Math.clz32(n&-n);return n?31-t:t}H.isLong=ct;var rh={},oh={};function Ye(n,t){var e,s,i;return t?(n>>>=0,(i=0<=n&&n<256)&&(s=oh[n],s)?s:(e=P(n,0,!0),i&&(oh[n]=e),e)):(n|=0,(i=-128<=n&&n<128)&&(s=rh[n],s)?s:(e=P(n,n<0?-1:0,!1),i&&(rh[n]=e),e))}H.fromInt=Ye;function Ft(n,t){if(isNaN(n))return t?me:Ht;if(t){if(n<0)return me;if(n>=Zu)return sd}else{if(n<=-ch)return pt;if(n+1>=ch)return ed}return n<0?Ft(-n,t).neg():P(n%Ns|0,n/Ns|0,t)}H.fromNumber=Ft;function P(n,t,e){return new H(n,t,e)}H.fromBits=P;var Li=Math.pow;function wa(n,t,e){if(n.length===0)throw Error("empty string");if(typeof t=="number"?(e=t,t=!1):t=!!t,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return t?me:Ht;if(e=e||10,e<2||36<e)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return wa(n.substring(1),t,e).neg();for(var i=Ft(Li(e,8)),r=Ht,o=0;o<n.length;o+=8){var a=Math.min(8,n.length-o),c=parseInt(n.substring(o,o+a),e);if(a<8){var h=Ft(Li(e,a));r=r.mul(h).add(Ft(c))}else r=r.mul(i),r=r.add(Ft(c))}return r.unsigned=t,r}H.fromString=wa;function Kt(n,t){return typeof n=="number"?Ft(n,t):typeof n=="string"?wa(n,t):P(n.low,n.high,typeof t=="boolean"?t:n.unsigned)}H.fromValue=Kt;var ah=65536,Sx=1<<24,Ns=ah*ah,Zu=Ns*Ns,ch=Zu/2,hh=Ye(Sx),Ht=Ye(0);H.ZERO=Ht;var me=Ye(0,!0);H.UZERO=me;var Cs=Ye(1);H.ONE=Cs;var td=Ye(1,!0);H.UONE=td;var ko=Ye(-1);H.NEG_ONE=ko;var ed=P(-1,2147483647,!1);H.MAX_VALUE=ed;var sd=P(-1,-1,!0);H.MAX_UNSIGNED_VALUE=sd;var pt=P(0,-2147483648,!1);H.MIN_VALUE=pt;var _=H.prototype;_.toInt=function(){return this.unsigned?this.low>>>0:this.low};_.toNumber=function(){return this.unsigned?(this.high>>>0)*Ns+(this.low>>>0):this.high*Ns+(this.low>>>0)};_.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(pt)){var e=Ft(t),s=this.div(e),i=s.mul(e).sub(this);return s.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var r=Ft(Li(t,6),this.unsigned),o=this,a="";;){var c=o.div(r),h=o.sub(c.mul(r)).toInt()>>>0,l=h.toString(t);if(o=c,o.isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}};_.getHighBits=function(){return this.high};_.getHighBitsUnsigned=function(){return this.high>>>0};_.getLowBits=function(){return this.low};_.getLowBitsUnsigned=function(){return this.low>>>0};_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(pt)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return this.high!=0?e+33:e+1};_.isZero=function(){return this.high===0&&this.low===0};_.eqz=_.isZero;_.isNegative=function(){return!this.unsigned&&this.high<0};_.isPositive=function(){return this.unsigned||this.high>=0};_.isOdd=function(){return(this.low&1)===1};_.isEven=function(){return(this.low&1)===0};_.equals=function(t){return ct(t)||(t=Kt(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};_.eq=_.equals;_.notEquals=function(t){return!this.eq(t)};_.neq=_.notEquals;_.ne=_.notEquals;_.lessThan=function(t){return this.comp(t)<0};_.lt=_.lessThan;_.lessThanOrEqual=function(t){return this.comp(t)<=0};_.lte=_.lessThanOrEqual;_.le=_.lessThanOrEqual;_.greaterThan=function(t){return this.comp(t)>0};_.gt=_.greaterThan;_.greaterThanOrEqual=function(t){return this.comp(t)>=0};_.gte=_.greaterThanOrEqual;_.ge=_.greaterThanOrEqual;_.compare=function(t){if(ct(t)||(t=Kt(t)),this.eq(t))return 0;var e=this.isNegative(),s=t.isNegative();return e&&!s?-1:!e&&s?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};_.comp=_.compare;_.negate=function(){return!this.unsigned&&this.eq(pt)?pt:this.not().add(Cs)};_.neg=_.negate;_.add=function(t){ct(t)||(t=Kt(t));var e=this.high>>>16,s=this.high&65535,i=this.low>>>16,r=this.low&65535,o=t.high>>>16,a=t.high&65535,c=t.low>>>16,h=t.low&65535,l=0,u=0,d=0,f=0;return f+=r+h,d+=f>>>16,f&=65535,d+=i+c,u+=d>>>16,d&=65535,u+=s+a,l+=u>>>16,u&=65535,l+=e+o,l&=65535,P(d<<16|f,l<<16|u,this.unsigned)};_.subtract=function(t){return ct(t)||(t=Kt(t)),this.add(t.neg())};_.sub=_.subtract;_.multiply=function(t){if(this.isZero())return this;if(ct(t)||(t=Kt(t)),St){var e=St.mul(this.low,this.high,t.low,t.high);return P(e,St.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?me:Ht;if(this.eq(pt))return t.isOdd()?pt:Ht;if(t.eq(pt))return this.isOdd()?pt:Ht;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(hh)&&t.lt(hh))return Ft(this.toNumber()*t.toNumber(),this.unsigned);var s=this.high>>>16,i=this.high&65535,r=this.low>>>16,o=this.low&65535,a=t.high>>>16,c=t.high&65535,h=t.low>>>16,l=t.low&65535,u=0,d=0,f=0,p=0;return p+=o*l,f+=p>>>16,p&=65535,f+=r*l,d+=f>>>16,f&=65535,f+=o*h,d+=f>>>16,f&=65535,d+=i*l,u+=d>>>16,d&=65535,d+=r*h,u+=d>>>16,d&=65535,d+=o*c,u+=d>>>16,d&=65535,u+=s*l+i*h+r*c+o*a,u&=65535,P(f<<16|p,u<<16|d,this.unsigned)};_.mul=_.multiply;_.divide=function(t){if(ct(t)||(t=Kt(t)),t.isZero())throw Error("division by zero");if(St){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?St.div_u:St.div_s)(this.low,this.high,t.low,t.high);return P(e,St.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?me:Ht;var s,i,r;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return me;if(t.gt(this.shru(1)))return td;r=me}else{if(this.eq(pt)){if(t.eq(Cs)||t.eq(ko))return pt;if(t.eq(pt))return Cs;var o=this.shr(1);return s=o.div(t).shl(1),s.eq(Ht)?t.isNegative()?Cs:ko:(i=this.sub(t.mul(s)),r=s.add(i.div(t)),r)}else if(t.eq(pt))return this.unsigned?me:Ht;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=Ht}for(i=this;i.gte(t);){s=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),c=a<=48?1:Li(2,a-48),h=Ft(s),l=h.mul(t);l.isNegative()||l.gt(i);)s-=c,h=Ft(s,this.unsigned),l=h.mul(t);h.isZero()&&(h=Cs),r=r.add(h),i=i.sub(l)}return r};_.div=_.divide;_.modulo=function(t){if(ct(t)||(t=Kt(t)),St){var e=(this.unsigned?St.rem_u:St.rem_s)(this.low,this.high,t.low,t.high);return P(e,St.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};_.mod=_.modulo;_.rem=_.modulo;_.not=function(){return P(~this.low,~this.high,this.unsigned)};_.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};_.clz=_.countLeadingZeros;_.countTrailingZeros=function(){return this.low?ih(this.low):ih(this.high)+32};_.ctz=_.countTrailingZeros;_.and=function(t){return ct(t)||(t=Kt(t)),P(this.low&t.low,this.high&t.high,this.unsigned)};_.or=function(t){return ct(t)||(t=Kt(t)),P(this.low|t.low,this.high|t.high,this.unsigned)};_.xor=function(t){return ct(t)||(t=Kt(t)),P(this.low^t.low,this.high^t.high,this.unsigned)};_.shiftLeft=function(t){return ct(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?P(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):P(0,this.low<<t-32,this.unsigned)};_.shl=_.shiftLeft;_.shiftRight=function(t){return ct(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?P(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):P(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};_.shr=_.shiftRight;_.shiftRightUnsigned=function(t){return ct(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?P(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?P(this.high,0,this.unsigned):P(this.high>>>t-32,0,this.unsigned)};_.shru=_.shiftRightUnsigned;_.shr_u=_.shiftRightUnsigned;_.rotateLeft=function(t){var e;return ct(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?P(this.high,this.low,this.unsigned):t<32?(e=32-t,P(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(t-=32,e=32-t,P(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))};_.rotl=_.rotateLeft;_.rotateRight=function(t){var e;return ct(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?P(this.high,this.low,this.unsigned):t<32?(e=32-t,P(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(t-=32,e=32-t,P(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))};_.rotr=_.rotateRight;_.toSigned=function(){return this.unsigned?P(this.low,this.high,!1):this};_.toUnsigned=function(){return this.unsigned?this:P(this.low,this.high,!0)};_.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};_.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};_.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]};H.fromBytes=function(t,e,s){return s?H.fromBytesLE(t,e):H.fromBytesBE(t,e)};H.fromBytesLE=function(t,e){return new H(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)};H.fromBytesBE=function(t,e){return new H(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};const Fx=16;function nd(n){n==="X"&&(n="");const t=n.padEnd(Fx,"0");return H.fromString(t,!0,16)}function Rx(n){if(n.isZero())return"X";let t=n.countTrailingZeros();const e=t%4;t=(t-e)/4;const s=t;t*=4;const r=n.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-s-r.length).join("0")+r}function Ix(n,t){const e=Dx(n).shiftRightUnsigned(2);return n.add(H.fromNumber(2*t+1-4).multiply(e))}function Dx(n){return n.and(n.not().add(1))}const Ox=3,Lx=30,Nx=2*Lx+1,lh=180/Math.PI;function kx(n){if(n.length===0)throw new Error(`Invalid Hilbert quad key ${n}`);const t=n.split("/"),e=parseInt(t[0],10),s=t[1],i=s.length;let r=0;const o=[0,0];for(let a=i-1;a>=0;a--){r=i-a;const c=s[a];let h=0,l=0;c==="1"?l=1:c==="2"?(h=1,l=1):c==="3"&&(h=1);const u=Math.pow(2,r-1);Gx(u,o,h,l),o[0]+=u*h,o[1]+=u*l}if(e%2===1){const a=o[0];o[0]=o[1],o[1]=a}return{face:e,ij:o,level:r}}function Px(n){if(n.isZero())return"";let t=n.toString(2);for(;t.length<Ox+Nx;)t="0"+t;const e=t.lastIndexOf("1"),s=t.substring(0,3),i=t.substring(3,e),r=i.length/2,o=H.fromString(s,!0,2).toString(10);let a="";if(r!==0)for(a=H.fromString(i,!0,2).toString(4);a.length<r;)a="0"+a;return`${o}/${a}`}function id(n,t,e){const s=1<<t;return[(n[0]+e[0])/s,(n[1]+e[1])/s]}function uh(n){return n>=.5?1/3*(4*n*n-1):1/3*(1-4*(1-n)*(1-n))}function rd(n){return[uh(n[0]),uh(n[1])]}function od(n,[t,e]){switch(n){case 0:return[1,t,e];case 1:return[-t,1,e];case 2:return[-t,-e,1];case 3:return[-1,-e,-t];case 4:return[e,-1,-t];case 5:return[e,t,-1];default:throw new Error("Invalid face")}}function ad([n,t,e]){const s=Math.atan2(e,Math.sqrt(n*n+t*t));return[Math.atan2(t,n)*lh,s*lh]}function Gx(n,t,e,s){if(s===0){e===1&&(t[0]=n-1-t[0],t[1]=n-1-t[1]);const i=t[0];t[0]=t[1],t[1]=i}}function vx(n){const t=id(n.ij,n.level,[.5,.5]),e=rd(t),s=od(n.face,e);return ad(s)}const Ux=100;function dh(n){const{face:t,ij:e,level:s}=n,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],r=Math.max(1,Math.ceil(Ux*Math.pow(2,-s))),o=new Float64Array(4*r*2+2);let a=0,c=0;for(let h=0;h<4;h++){const l=i[h].slice(0),u=i[h+1],d=(u[0]-l[0])/r,f=(u[1]-l[1])/r;for(let p=0;p<r;p++){l[0]+=d,l[1]+=f;const m=id(e,s,l),g=rd(m),b=od(t,g),y=ad(b);Math.abs(y[1])>89.999&&(y[0]=c);const x=y[0]-c;y[0]+=x>180?-360:x<-180?360:0,o[a++]=y[0],o[a++]=y[1],c=y[0]}}return o[a++]=o[0],o[a++]=o[1],o}function Ma(n){const t=zx(n);return kx(t)}function zx(n){if(n.indexOf("/")>0)return n;const t=nd(n);return Px(t)}function Hx(n){const t=Ma(n);return vx(t)}function jx(n){let t;if(n.face===2||n.face===5){let e=null,s=0;for(let i=0;i<4;i++){const r=`${n.face}/${i}`,o=Ma(r),a=dh(o);(typeof e>"u"||e===null)&&(e=new Float64Array(4*a.length)),e.set(a,s),s+=a.length}t=fh(e)}else{const e=dh(n);t=fh(e)}return t}function fh(n){if(n.length%2!==0)throw new Error("Invalid corners");const t=[],e=[];for(let s=0;s<n.length;s+=2)t.push(n[s]),e.push(n[s+1]);return t.sort((s,i)=>s-i),e.sort((s,i)=>s-i),{west:t[0],east:t[t.length-1],north:e[e.length-1],south:e[0]}}function Vx(n,t){const e=(t==null?void 0:t.minimumHeight)||0,s=(t==null?void 0:t.maximumHeight)||0,i=Ma(n),r=jx(i),o=r.west,a=r.south,c=r.east,h=r.north,l=[];return l.push(new w(o,h,e)),l.push(new w(c,h,e)),l.push(new w(c,a,e)),l.push(new w(o,a,e)),l.push(new w(o,h,s)),l.push(new w(c,h,s)),l.push(new w(c,a,s)),l.push(new w(o,a,s)),l}function cd(n){const t=n.token,e={minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight},s=Vx(t,e),i=Hx(t),r=i[0],o=i[1],a=J.WGS84.cartographicToCartesian([r,o,e.maximumHeight]),c=new w(a[0],a[1],a[2]);s.push(c);const h=Zb(s);return[...h.center,...h.halfAxes]}const Jx=4,Wx=8,qx={QUADTREE:Jx,OCTREE:Wx};function Kx(n,t,e){if(n!=null&&n.box){const s=nd(n.s2VolumeInfo.token),i=Ix(s,t),r=Rx(i),o={...n.s2VolumeInfo};switch(o.token=r,e){case"OCTREE":const h=n.s2VolumeInfo,l=h.maximumHeight-h.minimumHeight,u=l/2,d=h.minimumHeight+l/2;h.minimumHeight=d-u,h.maximumHeight=d+u;break}return{box:cd(o),s2VolumeInfo:o}}}async function hd(n){const{subtree:t,subtreeData:e={level:0,x:0,y:0,z:0},parentData:s={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:i=0,implicitOptions:r,loaderOptions:o,s2VolumeBox:a}=n,{subdivisionScheme:c,subtreeLevels:h,maximumLevel:l,contentUrlTemplate:u,subtreesUriTemplate:d,basePath:f}=r,p={children:[],lodMetricValue:0,contentUrl:""};if(!l)return Cl.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${u} won't be loaded...`),p;const m=s.localLevel+1,g=e.level+m;if(g>l)return p;const b=qx[c],y=Math.log2(b),x=i&1,A=i>>1&1,B=i>>2&1,E=ke(s.localX,x,1),C=ke(s.localY,A,1),S=ke(s.localZ,B,1),F=ke(e.x,E,m),R=ke(e.y,C,m),I=ke(e.z,S,m),G=ke(s.mortonIndex,i,y),N=m===h&&Nr(t.childSubtreeAvailability,G);let D,st,Xt,Ot;if(N){const mt=`${f}/${d}`,re=Po(mt,g,F,R,I);D=await En(re,$u,o),Ot=0,st={level:g,x:F,y:R,z:I},Xt={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else D=t,Ot=(b**m-1)/(b-1)+G,st=e,Xt={mortonIndex:G,localLevel:m,localX:E,localY:C,localZ:S};if(!Nr(D.tileAvailability,Ot))return p;Nr(D.contentAvailability,Ot)&&(p.contentUrl=Po(u,g,F,R,I));for(let mt=0;mt<b;mt++){const re=Kx(a,mt,c),Rn=await hd({subtree:D,subtreeData:st,parentData:Xt,childIndex:mt,implicitOptions:r,loaderOptions:o,s2VolumeBox:re});(Rn.contentUrl||Rn.children.length)&&p.children.push(Rn)}return p.contentUrl||p.children.length?Xx(p,{level:g,x:F,y:R,z:I},r,a):p}function Nr(n,t){let e;return Array.isArray(n)?(e=n[0],n.length>1&&Cl.once('Not supported extension "3DTILES_multiple_contents" has been detected')):e=n,"constant"in e?!!e.constant:e.explicitBitstream?$x(t,e.explicitBitstream):!1}function Xx(n,t,e,s){const{basePath:i,refine:r,getRefine:o,lodMetricType:a,getTileType:c,rootLodMetricValue:h,rootBoundingVolume:l}=e,u=n.contentUrl&&n.contentUrl.replace(`${i}/`,""),d=h/2**t.level,f=s!=null&&s.box?{box:s.box}:l,p=Qx(f,t,e.subdivisionScheme);return{children:n.children,contentUrl:n.contentUrl,content:{uri:u},id:n.contentUrl,refine:o(r),type:c(n),lodMetricType:a,lodMetricValue:d,geometricError:d,transform:n.transform,boundingVolume:p}}function Qx(n,t,e){if(n.region){const{level:s,x:i,y:r,z:o}=t,[a,c,h,l,u,d]=n.region,f=2**s,p=(h-a)/f,[m,g]=[a+p*i,a+p*(i+1)],b=(l-c)/f,[y,x]=[c+b*r,c+b*(r+1)];let A,B;if(e==="OCTREE"){const E=(d-u)/f;[A,B]=[u+E*o,u+E*(o+1)]}else[A,B]=[u,d];return{region:[m,y,g,x,A,B]}}if(n.box)return n;throw new Error(`Unsupported bounding volume type ${JSON.stringify(n)}`)}function ke(n,t,e){return(n<<e)+t}function Po(n,t,e,s,i){const r=Yx({level:t,x:e,y:s,z:i});return n.replace(/{level}|{x}|{y}|{z}/gi,o=>r[o])}function Yx(n){const t={};for(const e in n)t[`{${e}}`]=n[e];return t}function $x(n,t){const e=Math.floor(n/8),s=n%8;return(t[e]>>s&1)===1}function Ea(n,t=""){if(!t)return Es.EMPTY;const s=t.split("?")[0].split(".").pop();switch(s){case"pnts":return Es.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Es.SCENEGRAPH;default:return s||Es.EMPTY}}function Ca(n){switch(n){case"REPLACE":case"replace":return Vt.REPLACE;case"ADD":case"add":return Vt.ADD;default:return n}}function Go(n,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const s=new URL(n,`${t}/`);return decodeURI(s.toString())}else if(n.startsWith("/"))return n;return Uf(t,n)}function ph(n,t){var i;if(!n)return null;let e;if(n.content){const r=n.content.uri||((i=n.content)==null?void 0:i.url);typeof r<"u"&&(e=Go(r,t))}return{...n,id:e,contentUrl:e,lodMetricType:Ds.GEOMETRIC_ERROR,lodMetricValue:n.geometricError,transformMatrix:n.transform,type:Ea(n,e),refine:Ca(n.refine)}}async function Zx(n,t,e){let s=null;const i=bh(n.root);i&&n.root?s=await mh(n.root,n,t,i,e):s=ph(n.root,t);const r=[];for(r.push(s);r.length>0;){const o=r.pop()||{},a=o.children||[],c=[];for(const h of a){const l=bh(h);let u;l?u=await mh(h,n,t,l,e):u=ph(h,t),u&&(c.push(u),r.push(u))}o.children=c}return s}async function mh(n,t,e,s,i){var A,B,E;const{subdivisionScheme:r,maximumLevel:o,availableLevels:a,subtreeLevels:c,subtrees:{uri:h}}=s,l=Po(h,0,0,0,0),u=Go(l,e),d=await En(u,$u,i),f=(A=n.content)==null?void 0:A.uri,p=f?Go(f,e):"",m=(B=t==null?void 0:t.root)==null?void 0:B.refine,g=n.geometricError,b=(E=n.boundingVolume.extensions)==null?void 0:E["3DTILES_bounding_volume_S2"];if(b){const S={box:cd(b),s2VolumeInfo:b};n.boundingVolume=S}const y=n.boundingVolume,x={contentUrlTemplate:p,subtreesUriTemplate:h,subdivisionScheme:r,subtreeLevels:c,maximumLevel:Number.isFinite(a)?a-1:o,refine:m,basePath:e,lodMetricType:Ds.GEOMETRIC_ERROR,rootLodMetricValue:g,rootBoundingVolume:y,getTileType:Ea,getRefine:Ca};return await tT(n,e,d,x,i)}async function tT(n,t,e,s,i){if(!n)return null;const{children:r,contentUrl:o}=await hd({subtree:e,implicitOptions:s,loaderOptions:i});let a,c=null;return o&&(a=o,c={uri:o.replace(`${t}/`,"")}),{...n,id:a,contentUrl:a,lodMetricType:Ds.GEOMETRIC_ERROR,lodMetricValue:n.geometricError,transformMatrix:n.transform,type:Ea(n,a),refine:Ca(n.refine),content:c||n.content,children:r}}function bh(n){var t;return((t=n==null?void 0:n.extensions)==null?void 0:t["3DTILES_implicit_tiling"])||(n==null?void 0:n.implicitTiling)}const ld={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:xu,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:eT,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function eT(n,t={},e){const s=t["3d-tiles"]||{};let i;return s.isTileset==="auto"?i=(e==null?void 0:e.url)&&e.url.indexOf(".json")!==-1:i=s.isTileset,i?sT(n,t,e):nT(n,t,e)}async function sT(n,t,e){var c;const s=JSON.parse(new TextDecoder().decode(n)),i=(e==null?void 0:e.url)||"",r=iT(i),o=await Zx(s,r,t||{});return{...s,shape:"tileset3d",loader:ld,url:i,queryString:(e==null?void 0:e.queryString)||"",basePath:r,root:o||s.root,type:ft.TILES3D,lodMetricType:Ds.GEOMETRIC_ERROR,lodMetricValue:((c=s.root)==null?void 0:c.geometricError)||0}}async function nT(n,t,e){const s={content:{shape:"tile3d",featureIds:null}};return await Yu(n,0,t,e,s.content),s.content}function iT(n){return sa(n)}const rT=new Bn({id:"deck"}),kr={WEB_MERCATOR:1,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0};function oT(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Fs(n,t){const e=cu([],t,n);return au(e,e,1/e[3]),e}function vo(n,t,e){return n<t?t:n>e?e:n}function aT(n){return Math.log(n)*Math.LOG2E}const ud=Math.log2||aT;function ye(n,t){if(!n)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const jt=Math.PI,dd=jt/4,It=jt/180,Uo=180/jt,ks=512,Ni=4003e4,Xn=85.051129,cT=1.5;function hT(n){return ud(n)}function ki(n){const[t,e]=n;ye(Number.isFinite(t)),ye(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const s=t*It,i=e*It,r=ks*(s+jt)/(2*jt),o=ks*(jt+Math.log(Math.tan(dd+i*.5)))/(2*jt);return[r,o]}function Zi(n){const[t,e]=n,s=t/ks*(2*jt)-jt,i=2*(Math.atan(Math.exp(e/ks*(2*jt)-jt))-dd);return[s*Uo,i*Uo]}function lT(n){const{latitude:t}=n;ye(Number.isFinite(t));const e=Math.cos(t*It);return hT(Ni*e)-9}function Pr(n){const t=Math.cos(n*It);return ks/Ni/t}function zo(n){const{latitude:t,longitude:e,highPrecision:s=!1}=n;ye(Number.isFinite(t)&&Number.isFinite(e));const i=ks,r=Math.cos(t*It),o=i/360,a=o/r,c=i/Ni/r,h={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[o,a,c],degreesPerUnit:[1/o,1/a,1/c]};if(s){const l=It*Math.tan(t*It)/r,u=o*l/2,d=i/Ni*l,f=d/a*c;h.unitsPerDegree2=[0,u,d],h.unitsPerMeter2=[f,0,f]}return h}function uT(n,t){const[e,s,i]=n,[r,o,a]=t,{unitsPerMeter:c,unitsPerMeter2:h}=zo({longitude:e,latitude:s,highPrecision:!0}),l=ki(n);l[0]+=r*(c[0]+h[0]*o),l[1]+=o*(c[1]+h[1]*o);const u=Zi(l),d=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[u[0],u[1],d]:u}function dT(n){const{height:t,pitch:e,bearing:s,altitude:i,scale:r,center:o}=n,a=oT();Si(a,a,[0,0,-i]),ru(a,a,-e*It),ou(a,a,s*It);const c=r/t;return da(a,a,[c,c,c]),o&&Si(a,a,am([],o)),a}function fT(n){const{width:t,height:e,altitude:s,pitch:i=0,offset:r,center:o,scale:a,nearZMultiplier:c=1,farZMultiplier:h=1}=n;let{fovy:l=Pi(cT)}=n;s!==void 0&&(l=Pi(s));const u=l*It,d=i*It,f=fd(l);let p=f;o&&(p+=o[2]*a/Math.cos(d)/e);const m=u*(.5+(r?r[1]:0)/e),g=Math.sin(m)*p/Math.sin(vo(Math.PI/2-d-m,.01,Math.PI-.01)),b=Math.sin(d)*g+p,y=p*10,x=Math.min(b*h,y);return{fov:u,aspect:t/e,focalDistance:f,near:c,far:x}}function Pi(n){return 2*Math.atan(.5/n)*Uo}function fd(n){return .5/Math.tan(.5*n*It)}function pT(n,t){const[e,s,i=0]=n;return ye(Number.isFinite(e)&&Number.isFinite(s)&&Number.isFinite(i)),Fs(t,[e,s,i,1])}function pd(n,t,e=0){const[s,i,r]=n;if(ye(Number.isFinite(s)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(r))return Fs(t,[s,i,r,1]);const o=Fs(t,[s,i,0,1]),a=Fs(t,[s,i,1,1]),c=o[2],h=a[2],l=c===h?0:((e||0)-c)/(h-c);return Wl([],o,a,l)}function mT(n){const{width:t,height:e,bounds:s,minExtent:i=0,maxZoom:r=24,offset:o=[0,0]}=n,[[a,c],[h,l]]=s,u=bT(n.padding),d=ki([a,vo(l,-Xn,Xn)]),f=ki([h,vo(c,-Xn,Xn)]),p=[Math.max(Math.abs(f[0]-d[0]),i),Math.max(Math.abs(f[1]-d[1]),i)],m=[t-u.left-u.right-Math.abs(o[0])*2,e-u.top-u.bottom-Math.abs(o[1])*2];ye(m[0]>0&&m[1]>0);const g=m[0]/p[0],b=m[1]/p[1],y=(u.right-u.left)/2/g,x=(u.top-u.bottom)/2/b,A=[(f[0]+d[0])/2+y,(f[1]+d[1])/2+x],B=Zi(A),E=Math.min(r,ud(Math.abs(Math.min(g,b))));return ye(Number.isFinite(E)),{longitude:B[0],latitude:B[1],zoom:E}}function bT(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(ye(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const gh=Math.PI/180;function gT(n,t=0){const{width:e,height:s,unproject:i}=n,r={targetZ:t},o=i([0,s],r),a=i([e,s],r);let c,h;const l=n.fovy?.5*n.fovy*gh:Math.atan(.5/n.altitude),u=(90-n.pitch)*gh;return l>u-.01?(c=yh(n,0,t),h=yh(n,e,t)):(c=i([0,0],r),h=i([e,0],r)),[o,a,h,c]}function yh(n,t,e){const{pixelUnprojectionMatrix:s}=n,i=Fs(s,[t,0,1,1]),r=Fs(s,[t,n.height,1,1]),a=(e*n.distanceScales.unitsPerMeter[2]-i[2])/(r[2]-i[2]),c=Wl([],i,r,a),h=Zi(c);return h.push(e),h}function nn(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function yT(n){return[n[12],n[13],n[14]]}function AT(n){return{left:cs(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:cs(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:cs(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:cs(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:cs(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:cs(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const Ah=new w;function cs(n,t,e,s){Ah.set(n,t,e);const i=Ah.len();return{distance:s/i,normal:new w(-n/i,-t/i,-e/i)}}const xT=Math.PI/180,TT=nn(),xh=[0,0,0],BT={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function wT({width:n,height:t,orthographic:e,fovyRadians:s,focalDistance:i,padding:r,near:o,far:a}){const c=n/t,h=e?new V().orthographic({fovy:s,aspect:c,focalDistance:i,near:o,far:a}):new V().perspective({fovy:s,aspect:c,near:o,far:a});if(r){const{left:l=0,right:u=0,top:d=0,bottom:f=0}=r,p=pn((l+n-u)/2,0,n)-n/2,m=pn((d+t-f)/2,0,t)-t/2;h[8]-=p*2/n,h[9]+=m*2/t}return h}class tr{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||BT,this.focalDistance=t.focalDistance||1,this.position=t.position||xh,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:s}=t;this.isGeospatial=Number.isFinite(s)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?kr.WEB_MERCATOR:kr.WEB_MERCATOR_AUTO_OFFSET:kr.IDENTITY}equals(t){return t instanceof tr?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&te(t.projectionMatrix,this.projectionMatrix)&&te(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:e=!0}={}){const s=this.projectPosition(t),i=pT(s,this.pixelProjectionMatrix),[r,o]=i,a=e?o:this.height-o;return t.length===2?[r,a]:[r,a,i[2]]}unproject(t,{topLeft:e=!0,targetZ:s}={}){const[i,r,o]=t,a=e?r:this.height-r,c=s&&s*this.distanceScales.unitsPerMeter[2],h=pd([i,a,o],this.pixelUnprojectionMatrix,c),[l,u,d]=this.unprojectPosition(h);return Number.isFinite(o)?[l,u,d]:Number.isFinite(s)?[l,u,s]:[l,u]}projectPosition(t){const[e,s]=this.projectFlat(t),i=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,s,i]}unprojectPosition(t){const[e,s]=this.unprojectFlat(t),i=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,s,i]}projectFlat(t){if(this.isGeospatial){const e=ki(t);return e[1]=pn(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?Zi(t):t}getBounds(t={}){const e={targetZ:t.z||0},s=this.unproject([0,0],e),i=this.unproject([this.width,0],e),r=this.unproject([0,this.height],e),o=this.unproject([this.width,this.height],e);return[Math.min(s[0],i[0],r[0],o[0]),Math.min(s[1],i[1],r[1],o[1]),Math.max(s[0],i[0],r[0],o[0]),Math.max(s[1],i[1],r[1],o[1])]}getDistanceScales(t){return t?zo({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:e,width:s=1,height:i=1}){return t<this.x+this.width&&this.x<t+s&&e<this.y+this.height&&this.y<e+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,AT(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,s=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=lT({latitude:s})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||zo({latitude:s,longitude:e}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:r,modelMatrix:o}=t;let a=xh;if(r&&(a=o?new V(o).transformAsVector(r,[]):r),this.isGeospatial){const c=this.projectPosition([e,s,0]);this.center=new w(a).scale(this.distanceScales.unitsPerMeter).add(c)}else this.center=this.projectPosition(a)}_initMatrices(t){const{viewMatrix:e=TT,projectionMatrix:s=null,orthographic:i=!1,fovyRadians:r,fovy:o=75,near:a=.1,far:c=1e3,padding:h=null,focalDistance:l=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new V().multiplyRight(e).translate(new w(this.center).negate()),this.projectionMatrix=s||wT({width:this.width,height:this.height,orthographic:i,fovyRadians:r||o*xT,focalDistance:l,padding:h,near:a,far:c});const u=nn();hn(u,u,this.projectionMatrix),hn(u,u,this.viewMatrix),this.viewProjectionMatrix=u,this.viewMatrixInverse=wo([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=yT(this.viewMatrixInverse);const d=nn(),f=nn();da(d,d,[this.width/2,-this.height/2,1]),Si(d,d,[1,-1,0]),hn(f,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=f,this.pixelUnprojectionMatrix=wo(nn(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||rT.warn("Pixel project matrix not invertible")()}}tr.displayName="Viewport";class bn extends tr{constructor(t={}){const{latitude:e=0,longitude:s=0,zoom:i=0,pitch:r=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:c=1.01,nearZ:h,farZ:l,orthographic:u=!1,projectionMatrix:d,repeat:f=!1,worldOffset:p=0,position:m,padding:g,legacyMeterSizes:b=!1}=t;let{width:y,height:x,altitude:A=1.5}=t;const B=Math.pow(2,i);y=y||1,x=x||1;let E,C=null;if(d)A=d[5]/2,E=Pi(A);else{t.fovy?(E=t.fovy,A=fd(E)):E=Pi(A);let F;if(g){const{top:R=0,bottom:I=0}=g;F=[0,pn((R+x-I)/2,0,x)-x/2]}C=fT({width:y,height:x,scale:B,center:m&&[0,0,m[2]*Pr(e)],offset:F,pitch:r,fovy:E,nearZMultiplier:a,farZMultiplier:c}),Number.isFinite(h)&&(C.near=h),Number.isFinite(l)&&(C.far=l)}let S=dT({height:x,pitch:r,bearing:o,scale:B,altitude:A});p&&(S=new V().translate([512*p,0,0]).multiplyLeft(S)),super({...t,width:y,height:x,viewMatrix:S,longitude:s,latitude:e,zoom:i,...C,fovy:E,focalDistance:A}),this.latitude=e,this.longitude=s,this.zoom=i,this.pitch=r,this.bearing=o,this.altitude=A,this.fovy=E,this.orthographic=u,this._subViewports=f?[]:null,this._pseudoMeters=b,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),s=Math.ceil((t[2]-180)/360);for(let i=e;i<=s;i++){const r=i?new bn({...this,worldOffset:i}):this;this._subViewports.push(r)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,s]=this.projectFlat(t),i=(t[2]||0)*Pr(t[1]);return[e,s,i]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,s]=this.unprojectFlat(t),i=(t[2]||0)/Pr(s);return[e,s,i]}addMetersToLngLat(t,e){return uT(t,e)}panByPosition(t,e){const s=pd(e,this.pixelUnprojectionMatrix),i=this.projectFlat(t),r=ac([],i,sm([],s)),o=ac([],this.center,r),[a,c]=this.unprojectFlat(o);return{longitude:a,latitude:c}}getBounds(t={}){const e=gT(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t,e={}){const{width:s,height:i}=this,{longitude:r,latitude:o,zoom:a}=mT({width:s,height:i,bounds:t,...e});return new bn({width:s,height:i,longitude:r,latitude:o,zoom:a})}}bn.displayName="WebMercatorViewport";/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const md="170",Gi=0,MT=1,ET=2,Th=1,Bh=100,wh=204,Mh=205,Eh=3,CT=0,Ch="attached",_T="detached",bd=300,gn=1e3,rn=1001,Ho=1002,vi=1003,ST=1004,FT=1005,Ui=1006,RT=1007,_a=1008,IT=1009,Sa=1015,gd=1023,DT=1028,yn=2300,An=2301,Gr=2302,_h=2400,Sh=2401,Fh=2402,OT=2500,LT=0,yd=1,jo=2,NT=0,Ad="",$="srgb",Dt="srgb-linear",xd="linear",Vo="srgb",hs=7680,Rh=519,Jo=35044,Ve=2e3,Wo=2001;class er{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const i=this._listeners[t];if(i!==void 0){const r=i.indexOf(e);r!==-1&&i.splice(r,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const s=this._listeners[t.type];if(s!==void 0){t.target=this;const i=s.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,t);t.target=null}}}const nt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Ih=1234567;const un=Math.PI/180,xn=180/Math.PI;function Jt(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(nt[n&255]+nt[n>>8&255]+nt[n>>16&255]+nt[n>>24&255]+"-"+nt[t&255]+nt[t>>8&255]+"-"+nt[t>>16&15|64]+nt[t>>24&255]+"-"+nt[e&63|128]+nt[e>>8&255]+"-"+nt[e>>16&255]+nt[e>>24&255]+nt[s&255]+nt[s>>8&255]+nt[s>>16&255]+nt[s>>24&255]).toLowerCase()}function at(n,t,e){return Math.max(t,Math.min(e,n))}function Fa(n,t){return(n%t+t)%t}function kT(n,t,e,s,i){return s+(n-t)*(i-s)/(e-t)}function PT(n,t,e){return n!==t?(e-n)/(t-n):0}function dn(n,t,e){return(1-e)*n+e*t}function GT(n,t,e,s){return dn(n,t,1-Math.exp(-e*s))}function vT(n,t=1){return t-Math.abs(Fa(n,t*2)-t)}function UT(n,t,e){return n<=t?0:n>=e?1:(n=(n-t)/(e-t),n*n*(3-2*n))}function zT(n,t,e){return n<=t?0:n>=e?1:(n=(n-t)/(e-t),n*n*n*(n*(n*6-15)+10))}function HT(n,t){return n+Math.floor(Math.random()*(t-n+1))}function jT(n,t){return n+Math.random()*(t-n)}function VT(n){return n*(.5-Math.random())}function JT(n){n!==void 0&&(Ih=n);let t=Ih+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function WT(n){return n*un}function qT(n){return n*xn}function KT(n){return(n&n-1)===0&&n!==0}function XT(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function QT(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function YT(n,t,e,s,i){const r=Math.cos,o=Math.sin,a=r(e/2),c=o(e/2),h=r((t+s)/2),l=o((t+s)/2),u=r((t-s)/2),d=o((t-s)/2),f=r((s-t)/2),p=o((s-t)/2);switch(i){case"XYX":n.set(a*l,c*u,c*d,a*h);break;case"YZY":n.set(c*d,a*l,c*u,a*h);break;case"ZXZ":n.set(c*u,c*d,a*l,a*h);break;case"XZX":n.set(a*l,c*p,c*f,a*h);break;case"YXY":n.set(c*f,a*l,c*p,a*h);break;case"ZYZ":n.set(c*p,c*f,a*l,a*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Ut(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function U(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const $T={DEG2RAD:un,RAD2DEG:xn,generateUUID:Jt,clamp:at,euclideanModulo:Fa,mapLinear:kT,inverseLerp:PT,lerp:dn,damp:GT,pingpong:vT,smoothstep:UT,smootherstep:zT,randInt:HT,randFloat:jT,randFloatSpread:VT,seededRandom:JT,degToRad:WT,radToDeg:qT,isPowerOfTwo:KT,ceilPowerOfTwo:XT,floorPowerOfTwo:QT,setQuaternionFromProperEuler:YT,normalize:U,denormalize:Ut};class Q{constructor(t=0,e=0){Q.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6],this.y=i[1]*e+i[4]*s+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(at(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),i=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*s-o*i+t.x,this.y=r*i+o*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ae{constructor(t,e,s,i,r,o,a,c,h){Ae.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,s,i,r,o,a,c,h)}set(t,e,s,i,r,o,a,c,h){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=e,l[4]=r,l[5]=c,l[6]=s,l[7]=o,l[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,r=this.elements,o=s[0],a=s[3],c=s[6],h=s[1],l=s[4],u=s[7],d=s[2],f=s[5],p=s[8],m=i[0],g=i[3],b=i[6],y=i[1],x=i[4],A=i[7],B=i[2],E=i[5],C=i[8];return r[0]=o*m+a*y+c*B,r[3]=o*g+a*x+c*E,r[6]=o*b+a*A+c*C,r[1]=h*m+l*y+u*B,r[4]=h*g+l*x+u*E,r[7]=h*b+l*A+u*C,r[2]=d*m+f*y+p*B,r[5]=d*g+f*x+p*E,r[8]=d*b+f*A+p*C,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],i=t[2],r=t[3],o=t[4],a=t[5],c=t[6],h=t[7],l=t[8];return e*o*l-e*a*h-s*r*l+s*a*c+i*r*h-i*o*c}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],r=t[3],o=t[4],a=t[5],c=t[6],h=t[7],l=t[8],u=l*o-a*h,d=a*c-l*r,f=h*r-o*c,p=e*u+s*d+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=u*m,t[1]=(i*h-l*s)*m,t[2]=(a*s-i*o)*m,t[3]=d*m,t[4]=(l*e-i*c)*m,t[5]=(i*r-a*e)*m,t[6]=f*m,t[7]=(s*c-h*e)*m,t[8]=(o*e-s*r)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,i,r,o,a){const c=Math.cos(r),h=Math.sin(r);return this.set(s*c,s*h,-s*(c*o+h*a)+o+t,-i*h,i*c,-i*(-h*o+c*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(vr.makeScale(t,e)),this}rotate(t){return this.premultiply(vr.makeRotation(-t)),this}translate(t,e){return this.premultiply(vr.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<9;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const vr=new Ae;function ZT(n){for(let t=n.length-1;t>=0;--t)if(n[t]>=65535)return!0;return!1}function qo(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}const lt={enabled:!0,workingColorSpace:Dt,spaces:{},convert:function(n,t,e){return this.enabled===!1||t===e||!t||!e||(this.spaces[t].transfer===Vo&&(n.r=be(n.r),n.g=be(n.g),n.b=be(n.b)),this.spaces[t].primaries!==this.spaces[e].primaries&&(n.applyMatrix3(this.spaces[t].toXYZ),n.applyMatrix3(this.spaces[e].fromXYZ)),this.spaces[e].transfer===Vo&&(n.r=Rs(n.r),n.g=Rs(n.g),n.b=Rs(n.b))),n},fromWorkingColorSpace:function(n,t){return this.convert(n,this.workingColorSpace,t)},toWorkingColorSpace:function(n,t){return this.convert(n,t,this.workingColorSpace)},getPrimaries:function(n){return this.spaces[n].primaries},getTransfer:function(n){return n===Ad?xd:this.spaces[n].transfer},getLuminanceCoefficients:function(n,t=this.workingColorSpace){return n.fromArray(this.spaces[t].luminanceCoefficients)},define:function(n){Object.assign(this.spaces,n)},_getMatrix:function(n,t,e){return n.copy(this.spaces[t].toXYZ).multiply(this.spaces[e].fromXYZ)},_getDrawingBufferColorSpace:function(n){return this.spaces[n].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(n=this.workingColorSpace){return this.spaces[n].workingColorSpaceConfig.unpackColorSpace}};function be(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Rs(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}const Dh=[.64,.33,.3,.6,.15,.06],Oh=[.2126,.7152,.0722],Lh=[.3127,.329],Nh=new Ae().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),kh=new Ae().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);lt.define({[Dt]:{primaries:Dh,whitePoint:Lh,transfer:xd,toXYZ:Nh,fromXYZ:kh,luminanceCoefficients:Oh,workingColorSpaceConfig:{unpackColorSpace:$},outputColorSpaceConfig:{drawingBufferColorSpace:$}},[$]:{primaries:Dh,whitePoint:Lh,transfer:Vo,toXYZ:Nh,fromXYZ:kh,luminanceCoefficients:Oh,outputColorSpaceConfig:{drawingBufferColorSpace:$}}});let ls;class tB{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{ls===void 0&&(ls=qo("canvas")),ls.width=t.width,ls.height=t.height;const s=ls.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=ls}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=qo("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const i=s.getImageData(0,0,t.width,t.height),r=i.data;for(let o=0;o<r.length;o++)r[o]=be(r[o]/255)*255;return s.putImageData(i,0,0),e}else if(t.data){const e=t.data.slice(0);for(let s=0;s<e.length;s++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[s]=Math.floor(be(e[s]/255)*255):e[s]=be(e[s]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let eB=0;class sB{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:eB++}),this.uuid=Jt(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(i!==null){let r;if(Array.isArray(i)){r=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?r.push(Ur(i[o].image)):r.push(Ur(i[o]))}else r=Ur(i);s.url=r}return e||(t.images[this.uuid]=s),s}}function Ur(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?tB.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let nB=0;class Wt extends er{constructor(t=Wt.DEFAULT_IMAGE,e=Wt.DEFAULT_MAPPING,s=rn,i=rn,r=Ui,o=_a,a=gd,c=IT,h=Wt.DEFAULT_ANISOTROPY,l=Ad){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:nB++}),this.uuid=Jt(),this.name="",this.source=new sB(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=h,this.format=a,this.internalFormat=null,this.type=c,this.offset=new Q(0,0),this.repeat=new Q(1,1),this.center=new Q(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ae,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==bd)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case gn:t.x=t.x-Math.floor(t.x);break;case rn:t.x=t.x<0?0:1;break;case Ho:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case gn:t.y=t.y-Math.floor(t.y);break;case rn:t.y=t.y<0?0:1;break;case Ho:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Wt.DEFAULT_IMAGE=null;Wt.DEFAULT_MAPPING=bd;Wt.DEFAULT_ANISOTROPY=1;class ut{constructor(t=0,e=0,s=0,i=1){ut.prototype.isVector4=!0,this.x=t,this.y=e,this.z=s,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,s,i){return this.x=t,this.y=e,this.z=s,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*s+o[8]*i+o[12]*r,this.y=o[1]*e+o[5]*s+o[9]*i+o[13]*r,this.z=o[2]*e+o[6]*s+o[10]*i+o[14]*r,this.w=o[3]*e+o[7]*s+o[11]*i+o[15]*r,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,s,i,r;const c=t.elements,h=c[0],l=c[4],u=c[8],d=c[1],f=c[5],p=c[9],m=c[2],g=c[6],b=c[10];if(Math.abs(l-d)<.01&&Math.abs(u-m)<.01&&Math.abs(p-g)<.01){if(Math.abs(l+d)<.1&&Math.abs(u+m)<.1&&Math.abs(p+g)<.1&&Math.abs(h+f+b-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const x=(h+1)/2,A=(f+1)/2,B=(b+1)/2,E=(l+d)/4,C=(u+m)/4,S=(p+g)/4;return x>A&&x>B?x<.01?(s=0,i=.707106781,r=.707106781):(s=Math.sqrt(x),i=E/s,r=C/s):A>B?A<.01?(s=.707106781,i=0,r=.707106781):(i=Math.sqrt(A),s=E/i,r=S/i):B<.01?(s=.707106781,i=.707106781,r=0):(r=Math.sqrt(B),s=C/r,i=S/r),this.set(s,i,r,e),this}let y=Math.sqrt((g-p)*(g-p)+(u-m)*(u-m)+(d-l)*(d-l));return Math.abs(y)<.001&&(y=1),this.x=(g-p)/y,this.y=(u-m)/y,this.z=(d-l)/y,this.w=Math.acos((h+f+b-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this.w=t.w+(e.w-t.w)*s,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Oe{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static slerpFlat(t,e,s,i,r,o,a){let c=s[i+0],h=s[i+1],l=s[i+2],u=s[i+3];const d=r[o+0],f=r[o+1],p=r[o+2],m=r[o+3];if(a===0){t[e+0]=c,t[e+1]=h,t[e+2]=l,t[e+3]=u;return}if(a===1){t[e+0]=d,t[e+1]=f,t[e+2]=p,t[e+3]=m;return}if(u!==m||c!==d||h!==f||l!==p){let g=1-a;const b=c*d+h*f+l*p+u*m,y=b>=0?1:-1,x=1-b*b;if(x>Number.EPSILON){const B=Math.sqrt(x),E=Math.atan2(B,b*y);g=Math.sin(g*E)/B,a=Math.sin(a*E)/B}const A=a*y;if(c=c*g+d*A,h=h*g+f*A,l=l*g+p*A,u=u*g+m*A,g===1-a){const B=1/Math.sqrt(c*c+h*h+l*l+u*u);c*=B,h*=B,l*=B,u*=B}}t[e]=c,t[e+1]=h,t[e+2]=l,t[e+3]=u}static multiplyQuaternionsFlat(t,e,s,i,r,o){const a=s[i],c=s[i+1],h=s[i+2],l=s[i+3],u=r[o],d=r[o+1],f=r[o+2],p=r[o+3];return t[e]=a*p+l*u+c*f-h*d,t[e+1]=c*p+l*d+h*u-a*f,t[e+2]=h*p+l*f+a*d-c*u,t[e+3]=l*p-a*u-c*d-h*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,i=t._y,r=t._z,o=t._order,a=Math.cos,c=Math.sin,h=a(s/2),l=a(i/2),u=a(r/2),d=c(s/2),f=c(i/2),p=c(r/2);switch(o){case"XYZ":this._x=d*l*u+h*f*p,this._y=h*f*u-d*l*p,this._z=h*l*p+d*f*u,this._w=h*l*u-d*f*p;break;case"YXZ":this._x=d*l*u+h*f*p,this._y=h*f*u-d*l*p,this._z=h*l*p-d*f*u,this._w=h*l*u+d*f*p;break;case"ZXY":this._x=d*l*u-h*f*p,this._y=h*f*u+d*l*p,this._z=h*l*p+d*f*u,this._w=h*l*u-d*f*p;break;case"ZYX":this._x=d*l*u-h*f*p,this._y=h*f*u+d*l*p,this._z=h*l*p-d*f*u,this._w=h*l*u+d*f*p;break;case"YZX":this._x=d*l*u+h*f*p,this._y=h*f*u+d*l*p,this._z=h*l*p-d*f*u,this._w=h*l*u-d*f*p;break;case"XZY":this._x=d*l*u-h*f*p,this._y=h*f*u-d*l*p,this._z=h*l*p+d*f*u,this._w=h*l*u+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],r=e[8],o=e[1],a=e[5],c=e[9],h=e[2],l=e[6],u=e[10],d=s+a+u;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(l-c)*f,this._y=(r-h)*f,this._z=(o-i)*f}else if(s>a&&s>u){const f=2*Math.sqrt(1+s-a-u);this._w=(l-c)/f,this._x=.25*f,this._y=(i+o)/f,this._z=(r+h)/f}else if(a>u){const f=2*Math.sqrt(1+a-s-u);this._w=(r-h)/f,this._x=(i+o)/f,this._y=.25*f,this._z=(c+l)/f}else{const f=2*Math.sqrt(1+u-s-a);this._w=(o-i)/f,this._x=(r+h)/f,this._y=(c+l)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(at(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(s===0)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,r=t._z,o=t._w,a=e._x,c=e._y,h=e._z,l=e._w;return this._x=s*l+o*a+i*h-r*c,this._y=i*l+o*c+r*a-s*h,this._z=r*l+o*h+s*c-i*a,this._w=o*l-s*a-i*c-r*h,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const s=this._x,i=this._y,r=this._z,o=this._w;let a=o*t._w+s*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=s,this._y=i,this._z=r,this;const c=1-a*a;if(c<=Number.EPSILON){const f=1-e;return this._w=f*o+e*this._w,this._x=f*s+e*this._x,this._y=f*i+e*this._y,this._z=f*r+e*this._z,this.normalize(),this}const h=Math.sqrt(c),l=Math.atan2(h,a),u=Math.sin((1-e)*l)/h,d=Math.sin(e*l)/h;return this._w=o*u+this._w*d,this._x=s*u+this._x*d,this._y=i*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),r=Math.sqrt(s);return this.set(i*Math.sin(t),i*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class M{constructor(t=0,e=0,s=0){M.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return s===void 0&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Ph.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Ph.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*s+r[6]*i,this.y=r[1]*e+r[4]*s+r[7]*i,this.z=r[2]*e+r[5]*s+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,r=t.elements,o=1/(r[3]*e+r[7]*s+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*s+r[8]*i+r[12])*o,this.y=(r[1]*e+r[5]*s+r[9]*i+r[13])*o,this.z=(r[2]*e+r[6]*s+r[10]*i+r[14])*o,this}applyQuaternion(t){const e=this.x,s=this.y,i=this.z,r=t.x,o=t.y,a=t.z,c=t.w,h=2*(o*i-a*s),l=2*(a*e-r*i),u=2*(r*s-o*e);return this.x=e+c*h+o*u-a*l,this.y=s+c*l+a*h-r*u,this.z=i+c*u+r*l-o*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*s+r[8]*i,this.y=r[1]*e+r[5]*s+r[9]*i,this.z=r[2]*e+r[6]*s+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,i=t.y,r=t.z,o=e.x,a=e.y,c=e.z;return this.x=i*c-r*a,this.y=r*o-s*c,this.z=s*a-i*o,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return zr.copy(this).projectOnVector(t),this.sub(zr)}reflect(t){return this.sub(zr.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(at(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const i=Math.sin(e)*t;return this.x=i*Math.sin(s),this.y=Math.cos(e)*t,this.z=i*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,s=Math.sqrt(1-e*e);return this.x=s*Math.cos(t),this.y=e,this.z=s*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const zr=new M,Ph=new Oe;class ee{constructor(t=new M(1/0,1/0,1/0),e=new M(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(Nt.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(Nt.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=Nt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const s=t.geometry;if(s!==void 0){const r=s.getAttribute("position");if(e===!0&&r!==void 0&&t.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)t.isMesh===!0?t.getVertexPosition(o,Nt):Nt.fromBufferAttribute(r,o),Nt.applyMatrix4(t.matrixWorld),this.expandByPoint(Nt);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),Qn.copy(t.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),Qn.copy(s.boundingBox)),Qn.applyMatrix4(t.matrixWorld),this.union(Qn)}const i=t.children;for(let r=0,o=i.length;r<o;r++)this.expandByObject(i[r],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Nt),Nt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ws),Yn.subVectors(this.max,Ws),us.subVectors(t.a,Ws),ds.subVectors(t.b,Ws),fs.subVectors(t.c,Ws),Be.subVectors(ds,us),we.subVectors(fs,ds),Pe.subVectors(us,fs);let e=[0,-Be.z,Be.y,0,-we.z,we.y,0,-Pe.z,Pe.y,Be.z,0,-Be.x,we.z,0,-we.x,Pe.z,0,-Pe.x,-Be.y,Be.x,0,-we.y,we.x,0,-Pe.y,Pe.x,0];return!Hr(e,us,ds,fs,Yn)||(e=[1,0,0,0,1,0,0,0,1],!Hr(e,us,ds,fs,Yn))?!1:($n.crossVectors(Be,we),e=[$n.x,$n.y,$n.z],Hr(e,us,ds,fs,Yn))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Nt).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Nt).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(ce[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ce[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ce[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ce[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ce[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ce[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ce[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ce[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ce),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const ce=[new M,new M,new M,new M,new M,new M,new M,new M],Nt=new M,Qn=new ee,us=new M,ds=new M,fs=new M,Be=new M,we=new M,Pe=new M,Ws=new M,Yn=new M,$n=new M,Ge=new M;function Hr(n,t,e,s,i){for(let r=0,o=n.length-3;r<=o;r+=3){Ge.fromArray(n,r);const a=i.x*Math.abs(Ge.x)+i.y*Math.abs(Ge.y)+i.z*Math.abs(Ge.z),c=t.dot(Ge),h=e.dot(Ge),l=s.dot(Ge);if(Math.max(-Math.max(c,h,l),Math.min(c,h,l))>a)return!1}return!0}const iB=new ee,qs=new M,jr=new M;class se{constructor(t=new M,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const s=this.center;e!==void 0?s.copy(e):iB.setFromPoints(t).getCenter(s);let i=0;for(let r=0,o=t.length;r<o;r++)i=Math.max(i,s.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;qs.subVectors(t,this.center);const e=qs.lengthSq();if(e>this.radius*this.radius){const s=Math.sqrt(e),i=(s-this.radius)*.5;this.center.addScaledVector(qs,i/s),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(jr.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(qs.copy(t.center).add(jr)),this.expandByPoint(qs.copy(t.center).sub(jr))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const he=new M,Vr=new M,Zn=new M,Me=new M,Jr=new M,ti=new M,Wr=new M;class sr{constructor(t=new M,e=new M(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,he)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const s=e.dot(this.direction);return s<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=he.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(he.copy(this.origin).addScaledVector(this.direction,e),he.distanceToSquared(t))}distanceSqToSegment(t,e,s,i){Vr.copy(t).add(e).multiplyScalar(.5),Zn.copy(e).sub(t).normalize(),Me.copy(this.origin).sub(Vr);const r=t.distanceTo(e)*.5,o=-this.direction.dot(Zn),a=Me.dot(this.direction),c=-Me.dot(Zn),h=Me.lengthSq(),l=Math.abs(1-o*o);let u,d,f,p;if(l>0)if(u=o*c-a,d=o*a-c,p=r*l,u>=0)if(d>=-p)if(d<=p){const m=1/l;u*=m,d*=m,f=u*(u+o*d+2*a)+d*(o*u+d+2*c)+h}else d=r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*c)+h;else d=-r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*c)+h;else d<=-p?(u=Math.max(0,-(-o*r+a)),d=u>0?-r:Math.min(Math.max(-r,-c),r),f=-u*u+d*(d+2*c)+h):d<=p?(u=0,d=Math.min(Math.max(-r,-c),r),f=d*(d+2*c)+h):(u=Math.max(0,-(o*r+a)),d=u>0?r:Math.min(Math.max(-r,-c),r),f=-u*u+d*(d+2*c)+h);else d=o>0?-r:r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*c)+h;return s&&s.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Vr).addScaledVector(Zn,d),f}intersectSphere(t,e){he.subVectors(t.center,this.origin);const s=he.dot(this.direction),i=he.dot(he)-s*s,r=t.radius*t.radius;if(i>r)return null;const o=Math.sqrt(r-i),a=s-o,c=s+o;return c<0?null:a<0?this.at(c,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(t.normal)+t.constant)/e;return s>=0?s:null}intersectPlane(t,e){const s=this.distanceToPlane(t);return s===null?null:this.at(s,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let s,i,r,o,a,c;const h=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,d=this.origin;return h>=0?(s=(t.min.x-d.x)*h,i=(t.max.x-d.x)*h):(s=(t.max.x-d.x)*h,i=(t.min.x-d.x)*h),l>=0?(r=(t.min.y-d.y)*l,o=(t.max.y-d.y)*l):(r=(t.max.y-d.y)*l,o=(t.min.y-d.y)*l),s>o||r>i||((r>s||isNaN(s))&&(s=r),(o<i||isNaN(i))&&(i=o),u>=0?(a=(t.min.z-d.z)*u,c=(t.max.z-d.z)*u):(a=(t.max.z-d.z)*u,c=(t.min.z-d.z)*u),s>c||a>i)||((a>s||s!==s)&&(s=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(s>=0?s:i,e)}intersectsBox(t){return this.intersectBox(t,he)!==null}intersectTriangle(t,e,s,i,r){Jr.subVectors(e,t),ti.subVectors(s,t),Wr.crossVectors(Jr,ti);let o=this.direction.dot(Wr),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Me.subVectors(this.origin,t);const c=a*this.direction.dot(ti.crossVectors(Me,ti));if(c<0)return null;const h=a*this.direction.dot(Jr.cross(Me));if(h<0||c+h>o)return null;const l=-a*Me.dot(Wr);return l<0?null:this.at(l/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class L{constructor(t,e,s,i,r,o,a,c,h,l,u,d,f,p,m,g){L.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,s,i,r,o,a,c,h,l,u,d,f,p,m,g)}set(t,e,s,i,r,o,a,c,h,l,u,d,f,p,m,g){const b=this.elements;return b[0]=t,b[4]=e,b[8]=s,b[12]=i,b[1]=r,b[5]=o,b[9]=a,b[13]=c,b[2]=h,b[6]=l,b[10]=u,b[14]=d,b[3]=f,b[7]=p,b[11]=m,b[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new L().fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,i=1/ps.setFromMatrixColumn(t,0).length(),r=1/ps.setFromMatrixColumn(t,1).length(),o=1/ps.setFromMatrixColumn(t,2).length();return e[0]=s[0]*i,e[1]=s[1]*i,e[2]=s[2]*i,e[3]=0,e[4]=s[4]*r,e[5]=s[5]*r,e[6]=s[6]*r,e[7]=0,e[8]=s[8]*o,e[9]=s[9]*o,e[10]=s[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,i=t.y,r=t.z,o=Math.cos(s),a=Math.sin(s),c=Math.cos(i),h=Math.sin(i),l=Math.cos(r),u=Math.sin(r);if(t.order==="XYZ"){const d=o*l,f=o*u,p=a*l,m=a*u;e[0]=c*l,e[4]=-c*u,e[8]=h,e[1]=f+p*h,e[5]=d-m*h,e[9]=-a*c,e[2]=m-d*h,e[6]=p+f*h,e[10]=o*c}else if(t.order==="YXZ"){const d=c*l,f=c*u,p=h*l,m=h*u;e[0]=d+m*a,e[4]=p*a-f,e[8]=o*h,e[1]=o*u,e[5]=o*l,e[9]=-a,e[2]=f*a-p,e[6]=m+d*a,e[10]=o*c}else if(t.order==="ZXY"){const d=c*l,f=c*u,p=h*l,m=h*u;e[0]=d-m*a,e[4]=-o*u,e[8]=p+f*a,e[1]=f+p*a,e[5]=o*l,e[9]=m-d*a,e[2]=-o*h,e[6]=a,e[10]=o*c}else if(t.order==="ZYX"){const d=o*l,f=o*u,p=a*l,m=a*u;e[0]=c*l,e[4]=p*h-f,e[8]=d*h+m,e[1]=c*u,e[5]=m*h+d,e[9]=f*h-p,e[2]=-h,e[6]=a*c,e[10]=o*c}else if(t.order==="YZX"){const d=o*c,f=o*h,p=a*c,m=a*h;e[0]=c*l,e[4]=m-d*u,e[8]=p*u+f,e[1]=u,e[5]=o*l,e[9]=-a*l,e[2]=-h*l,e[6]=f*u+p,e[10]=d-m*u}else if(t.order==="XZY"){const d=o*c,f=o*h,p=a*c,m=a*h;e[0]=c*l,e[4]=-u,e[8]=h*l,e[1]=d*u+m,e[5]=o*l,e[9]=f*u-p,e[2]=p*u-f,e[6]=a*l,e[10]=m*u+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(rB,t,oB)}lookAt(t,e,s){const i=this.elements;return yt.subVectors(t,e),yt.lengthSq()===0&&(yt.z=1),yt.normalize(),Ee.crossVectors(s,yt),Ee.lengthSq()===0&&(Math.abs(s.z)===1?yt.x+=1e-4:yt.z+=1e-4,yt.normalize(),Ee.crossVectors(s,yt)),Ee.normalize(),ei.crossVectors(yt,Ee),i[0]=Ee.x,i[4]=ei.x,i[8]=yt.x,i[1]=Ee.y,i[5]=ei.y,i[9]=yt.y,i[2]=Ee.z,i[6]=ei.z,i[10]=yt.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,r=this.elements,o=s[0],a=s[4],c=s[8],h=s[12],l=s[1],u=s[5],d=s[9],f=s[13],p=s[2],m=s[6],g=s[10],b=s[14],y=s[3],x=s[7],A=s[11],B=s[15],E=i[0],C=i[4],S=i[8],F=i[12],R=i[1],I=i[5],G=i[9],N=i[13],D=i[2],st=i[6],Xt=i[10],Ot=i[14],ts=i[3],Le=i[7],mt=i[11],re=i[15];return r[0]=o*E+a*R+c*D+h*ts,r[4]=o*C+a*I+c*st+h*Le,r[8]=o*S+a*G+c*Xt+h*mt,r[12]=o*F+a*N+c*Ot+h*re,r[1]=l*E+u*R+d*D+f*ts,r[5]=l*C+u*I+d*st+f*Le,r[9]=l*S+u*G+d*Xt+f*mt,r[13]=l*F+u*N+d*Ot+f*re,r[2]=p*E+m*R+g*D+b*ts,r[6]=p*C+m*I+g*st+b*Le,r[10]=p*S+m*G+g*Xt+b*mt,r[14]=p*F+m*N+g*Ot+b*re,r[3]=y*E+x*R+A*D+B*ts,r[7]=y*C+x*I+A*st+B*Le,r[11]=y*S+x*G+A*Xt+B*mt,r[15]=y*F+x*N+A*Ot+B*re,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],i=t[8],r=t[12],o=t[1],a=t[5],c=t[9],h=t[13],l=t[2],u=t[6],d=t[10],f=t[14],p=t[3],m=t[7],g=t[11],b=t[15];return p*(+r*c*u-i*h*u-r*a*d+s*h*d+i*a*f-s*c*f)+m*(+e*c*f-e*h*d+r*o*d-i*o*f+i*h*l-r*c*l)+g*(+e*h*u-e*a*f-r*o*u+s*o*f+r*a*l-s*h*l)+b*(-i*a*l-e*c*u+e*a*d+i*o*u-s*o*d+s*c*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],r=t[3],o=t[4],a=t[5],c=t[6],h=t[7],l=t[8],u=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],b=t[15],y=u*g*h-m*d*h+m*c*f-a*g*f-u*c*b+a*d*b,x=p*d*h-l*g*h-p*c*f+o*g*f+l*c*b-o*d*b,A=l*m*h-p*u*h+p*a*f-o*m*f-l*a*b+o*u*b,B=p*u*c-l*m*c-p*a*d+o*m*d+l*a*g-o*u*g,E=e*y+s*x+i*A+r*B;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/E;return t[0]=y*C,t[1]=(m*d*r-u*g*r-m*i*f+s*g*f+u*i*b-s*d*b)*C,t[2]=(a*g*r-m*c*r+m*i*h-s*g*h-a*i*b+s*c*b)*C,t[3]=(u*c*r-a*d*r-u*i*h+s*d*h+a*i*f-s*c*f)*C,t[4]=x*C,t[5]=(l*g*r-p*d*r+p*i*f-e*g*f-l*i*b+e*d*b)*C,t[6]=(p*c*r-o*g*r-p*i*h+e*g*h+o*i*b-e*c*b)*C,t[7]=(o*d*r-l*c*r+l*i*h-e*d*h-o*i*f+e*c*f)*C,t[8]=A*C,t[9]=(p*u*r-l*m*r-p*s*f+e*m*f+l*s*b-e*u*b)*C,t[10]=(o*m*r-p*a*r+p*s*h-e*m*h-o*s*b+e*a*b)*C,t[11]=(l*a*r-o*u*r-l*s*h+e*u*h+o*s*f-e*a*f)*C,t[12]=B*C,t[13]=(l*m*i-p*u*i+p*s*d-e*m*d-l*s*g+e*u*g)*C,t[14]=(p*a*i-o*m*i-p*s*c+e*m*c+o*s*g-e*a*g)*C,t[15]=(o*u*i-l*a*i+l*s*c-e*u*c-o*s*d+e*a*d)*C,this}scale(t){const e=this.elements,s=t.x,i=t.y,r=t.z;return e[0]*=s,e[4]*=i,e[8]*=r,e[1]*=s,e[5]*=i,e[9]*=r,e[2]*=s,e[6]*=i,e[10]*=r,e[3]*=s,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,i))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),i=Math.sin(e),r=1-s,o=t.x,a=t.y,c=t.z,h=r*o,l=r*a;return this.set(h*o+s,h*a-i*c,h*c+i*a,0,h*a+i*c,l*a+s,l*c-i*o,0,h*c-i*a,l*c+i*o,r*c*c+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,i,r,o){return this.set(1,s,r,0,t,1,o,0,e,i,1,0,0,0,0,1),this}compose(t,e,s){const i=this.elements,r=e._x,o=e._y,a=e._z,c=e._w,h=r+r,l=o+o,u=a+a,d=r*h,f=r*l,p=r*u,m=o*l,g=o*u,b=a*u,y=c*h,x=c*l,A=c*u,B=s.x,E=s.y,C=s.z;return i[0]=(1-(m+b))*B,i[1]=(f+A)*B,i[2]=(p-x)*B,i[3]=0,i[4]=(f-A)*E,i[5]=(1-(d+b))*E,i[6]=(g+y)*E,i[7]=0,i[8]=(p+x)*C,i[9]=(g-y)*C,i[10]=(1-(d+m))*C,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,s){const i=this.elements;let r=ps.set(i[0],i[1],i[2]).length();const o=ps.set(i[4],i[5],i[6]).length(),a=ps.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],kt.copy(this);const h=1/r,l=1/o,u=1/a;return kt.elements[0]*=h,kt.elements[1]*=h,kt.elements[2]*=h,kt.elements[4]*=l,kt.elements[5]*=l,kt.elements[6]*=l,kt.elements[8]*=u,kt.elements[9]*=u,kt.elements[10]*=u,e.setFromRotationMatrix(kt),s.x=r,s.y=o,s.z=a,this}makePerspective(t,e,s,i,r,o,a=Ve){const c=this.elements,h=2*r/(e-t),l=2*r/(s-i),u=(e+t)/(e-t),d=(s+i)/(s-i);let f,p;if(a===Ve)f=-(o+r)/(o-r),p=-2*o*r/(o-r);else if(a===Wo)f=-o/(o-r),p=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=h,c[4]=0,c[8]=u,c[12]=0,c[1]=0,c[5]=l,c[9]=d,c[13]=0,c[2]=0,c[6]=0,c[10]=f,c[14]=p,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(t,e,s,i,r,o,a=Ve){const c=this.elements,h=1/(e-t),l=1/(s-i),u=1/(o-r),d=(e+t)*h,f=(s+i)*l;let p,m;if(a===Ve)p=(o+r)*u,m=-2*u;else if(a===Wo)p=r*u,m=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-d,c[1]=0,c[5]=2*l,c[9]=0,c[13]=-f,c[2]=0,c[6]=0,c[10]=m,c[14]=-p,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<16;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const ps=new M,kt=new L,rB=new M(0,0,0),oB=new M(1,1,1),Ee=new M,ei=new M,yt=new M,Gh=new L,vh=new Oe;class De{constructor(t=0,e=0,s=0,i=De.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,i=this._order){return this._x=t,this._y=e,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const i=t.elements,r=i[0],o=i[4],a=i[8],c=i[1],h=i[5],l=i[9],u=i[2],d=i[6],f=i[10];switch(e){case"XYZ":this._y=Math.asin(at(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,f),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(d,h),this._z=0);break;case"YXZ":this._x=Math.asin(-at(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(at(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,f),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(c,r));break;case"ZYX":this._y=Math.asin(-at(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(c,r)):(this._x=0,this._z=Math.atan2(-o,h));break;case"YZX":this._z=Math.asin(at(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-at(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,h),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-l,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,s===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return Gh.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Gh,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return vh.setFromEuler(this),this.setFromQuaternion(vh,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}De.DEFAULT_ORDER="XYZ";class aB{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let cB=0;const Uh=new M,ms=new Oe,le=new L,si=new M,Ks=new M,hB=new M,lB=new Oe,zh=new M(1,0,0),Hh=new M(0,1,0),jh=new M(0,0,1),Vh={type:"added"},uB={type:"removed"},bs={type:"childadded",child:null},qr={type:"childremoved",child:null};class W extends er{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:cB++}),this.uuid=Jt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=W.DEFAULT_UP.clone();const t=new M,e=new De,s=new Oe,i=new M(1,1,1);function r(){s.setFromEuler(e,!1)}function o(){e.setFromQuaternion(s,void 0,!1)}e._onChange(r),s._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new L},normalMatrix:{value:new Ae}}),this.matrix=new L,this.matrixWorld=new L,this.matrixAutoUpdate=W.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=W.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new aB,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ms.setFromAxisAngle(t,e),this.quaternion.multiply(ms),this}rotateOnWorldAxis(t,e){return ms.setFromAxisAngle(t,e),this.quaternion.premultiply(ms),this}rotateX(t){return this.rotateOnAxis(zh,t)}rotateY(t){return this.rotateOnAxis(Hh,t)}rotateZ(t){return this.rotateOnAxis(jh,t)}translateOnAxis(t,e){return Uh.copy(t).applyQuaternion(this.quaternion),this.position.add(Uh.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(zh,t)}translateY(t){return this.translateOnAxis(Hh,t)}translateZ(t){return this.translateOnAxis(jh,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(le.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?si.copy(t):si.set(t,e,s);const i=this.parent;this.updateWorldMatrix(!0,!1),Ks.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?le.lookAt(Ks,si,this.up):le.lookAt(si,Ks,this.up),this.quaternion.setFromRotationMatrix(le),i&&(le.extractRotation(i.matrixWorld),ms.setFromRotationMatrix(le),this.quaternion.premultiply(ms.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Vh),bs.child=t,this.dispatchEvent(bs),bs.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(uB),qr.child=t,this.dispatchEvent(qr),qr.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),le.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),le.multiply(t.parent.matrixWorld)),t.applyMatrix4(le),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Vh),bs.child=t,this.dispatchEvent(bs),bs.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,i=this.children.length;s<i;s++){const o=this.children[s].getObjectByProperty(t,e);if(o!==void 0)return o}}getObjectsByProperty(t,e,s=[]){this[t]===e&&s.push(this);const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].getObjectsByProperty(t,e,s);return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ks,t,hB),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ks,lB,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].updateMatrixWorld(t)}updateWorldMatrix(t,e){const s=this.parent;if(t===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function r(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(t)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let h=0,l=c.length;h<l;h++){const u=c[h];r(t.shapes,u)}else r(t.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,h=this.material.length;c<h;c++)a.push(r(t.materials,this.material[c]));i.material=a}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(r(t.animations,c))}}if(e){const a=o(t.geometries),c=o(t.materials),h=o(t.textures),l=o(t.images),u=o(t.shapes),d=o(t.skeletons),f=o(t.animations),p=o(t.nodes);a.length>0&&(s.geometries=a),c.length>0&&(s.materials=c),h.length>0&&(s.textures=h),l.length>0&&(s.images=l),u.length>0&&(s.shapes=u),d.length>0&&(s.skeletons=d),f.length>0&&(s.animations=f),p.length>0&&(s.nodes=p)}return s.object=i,s;function o(a){const c=[];for(const h in a){const l=a[h];delete l.metadata,c.push(l)}return c}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let s=0;s<t.children.length;s++){const i=t.children[s];this.add(i.clone())}return this}}W.DEFAULT_UP=new M(0,1,0);W.DEFAULT_MATRIX_AUTO_UPDATE=!0;W.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Pt=new M,ue=new M,Kr=new M,de=new M,gs=new M,ys=new M,Jh=new M,Xr=new M,Qr=new M,Yr=new M,$r=new ut,Zr=new ut,to=new ut;class zt{constructor(t=new M,e=new M,s=new M){this.a=t,this.b=e,this.c=s}static getNormal(t,e,s,i){i.subVectors(s,e),Pt.subVectors(t,e),i.cross(Pt);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,s,i,r){Pt.subVectors(i,e),ue.subVectors(s,e),Kr.subVectors(t,e);const o=Pt.dot(Pt),a=Pt.dot(ue),c=Pt.dot(Kr),h=ue.dot(ue),l=ue.dot(Kr),u=o*h-a*a;if(u===0)return r.set(0,0,0),null;const d=1/u,f=(h*c-a*l)*d,p=(o*l-a*c)*d;return r.set(1-f-p,p,f)}static containsPoint(t,e,s,i){return this.getBarycoord(t,e,s,i,de)===null?!1:de.x>=0&&de.y>=0&&de.x+de.y<=1}static getInterpolation(t,e,s,i,r,o,a,c){return this.getBarycoord(t,e,s,i,de)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(r,de.x),c.addScaledVector(o,de.y),c.addScaledVector(a,de.z),c)}static getInterpolatedAttribute(t,e,s,i,r,o){return $r.setScalar(0),Zr.setScalar(0),to.setScalar(0),$r.fromBufferAttribute(t,e),Zr.fromBufferAttribute(t,s),to.fromBufferAttribute(t,i),o.setScalar(0),o.addScaledVector($r,r.x),o.addScaledVector(Zr,r.y),o.addScaledVector(to,r.z),o}static isFrontFacing(t,e,s,i){return Pt.subVectors(s,e),ue.subVectors(t,e),Pt.cross(ue).dot(i)<0}set(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this}setFromPointsAndIndices(t,e,s,i){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,s,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,s),this.c.fromBufferAttribute(t,i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Pt.subVectors(this.c,this.b),ue.subVectors(this.a,this.b),Pt.cross(ue).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return zt.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return zt.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,s,i,r){return zt.getInterpolation(t,this.a,this.b,this.c,e,s,i,r)}containsPoint(t){return zt.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return zt.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const s=this.a,i=this.b,r=this.c;let o,a;gs.subVectors(i,s),ys.subVectors(r,s),Xr.subVectors(t,s);const c=gs.dot(Xr),h=ys.dot(Xr);if(c<=0&&h<=0)return e.copy(s);Qr.subVectors(t,i);const l=gs.dot(Qr),u=ys.dot(Qr);if(l>=0&&u<=l)return e.copy(i);const d=c*u-l*h;if(d<=0&&c>=0&&l<=0)return o=c/(c-l),e.copy(s).addScaledVector(gs,o);Yr.subVectors(t,r);const f=gs.dot(Yr),p=ys.dot(Yr);if(p>=0&&f<=p)return e.copy(r);const m=f*h-c*p;if(m<=0&&h>=0&&p<=0)return a=h/(h-p),e.copy(s).addScaledVector(ys,a);const g=l*p-f*u;if(g<=0&&u-l>=0&&f-p>=0)return Jh.subVectors(r,i),a=(u-l)/(u-l+(f-p)),e.copy(i).addScaledVector(Jh,a);const b=1/(g+m+d);return o=m*b,a=d*b,e.copy(s).addScaledVector(gs,o).addScaledVector(ys,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Td={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ce={h:0,s:0,l:0},ni={h:0,s:0,l:0};function eo(n,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+(t-n)*6*e:e<1/2?t:e<2/3?n+(t-n)*6*(2/3-e):n}class Y{constructor(t,e,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,s)}set(t,e,s){if(e===void 0&&s===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,e,s);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=$){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,lt.toWorkingColorSpace(this,e),this}setRGB(t,e,s,i=lt.workingColorSpace){return this.r=t,this.g=e,this.b=s,lt.toWorkingColorSpace(this,i),this}setHSL(t,e,s,i=lt.workingColorSpace){if(t=Fa(t,1),e=at(e,0,1),s=at(s,0,1),e===0)this.r=this.g=this.b=s;else{const r=s<=.5?s*(1+e):s+e-s*e,o=2*s-r;this.r=eo(o,r,t+1/3),this.g=eo(o,r,t),this.b=eo(o,r,t-1/3)}return lt.toWorkingColorSpace(this,i),this}setStyle(t,e=$){function s(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const r=i[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(r,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=$){const s=Td[t.toLowerCase()];return s!==void 0?this.setHex(s,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=be(t.r),this.g=be(t.g),this.b=be(t.b),this}copyLinearToSRGB(t){return this.r=Rs(t.r),this.g=Rs(t.g),this.b=Rs(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=$){return lt.fromWorkingColorSpace(it.copy(this),t),Math.round(at(it.r*255,0,255))*65536+Math.round(at(it.g*255,0,255))*256+Math.round(at(it.b*255,0,255))}getHexString(t=$){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=lt.workingColorSpace){lt.fromWorkingColorSpace(it.copy(this),e);const s=it.r,i=it.g,r=it.b,o=Math.max(s,i,r),a=Math.min(s,i,r);let c,h;const l=(a+o)/2;if(a===o)c=0,h=0;else{const u=o-a;switch(h=l<=.5?u/(o+a):u/(2-o-a),o){case s:c=(i-r)/u+(i<r?6:0);break;case i:c=(r-s)/u+2;break;case r:c=(s-i)/u+4;break}c/=6}return t.h=c,t.s=h,t.l=l,t}getRGB(t,e=lt.workingColorSpace){return lt.fromWorkingColorSpace(it.copy(this),e),t.r=it.r,t.g=it.g,t.b=it.b,t}getStyle(t=$){lt.fromWorkingColorSpace(it.copy(this),t);const e=it.r,s=it.g,i=it.b;return t!==$?`color(${t} ${e.toFixed(3)} ${s.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(s*255)},${Math.round(i*255)})`}offsetHSL(t,e,s){return this.getHSL(Ce),this.setHSL(Ce.h+t,Ce.s+e,Ce.l+s)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this}lerpHSL(t,e){this.getHSL(Ce),t.getHSL(ni);const s=dn(Ce.h,ni.h,e),i=dn(Ce.s,ni.s,e),r=dn(Ce.l,ni.l,e);return this.setHSL(s,i,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,s=this.g,i=this.b,r=t.elements;return this.r=r[0]*e+r[3]*s+r[6]*i,this.g=r[1]*e+r[4]*s+r[7]*i,this.b=r[2]*e+r[5]*s+r[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const it=new Y;Y.NAMES=Td;let dB=0;class We extends er{static get type(){return"Material"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:dB++}),this.uuid=Jt(),this.name="",this.blending=Th,this.side=Gi,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=wh,this.blendDst=Mh,this.blendEquation=Bh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Y(0,0,0),this.blendAlpha=0,this.depthFunc=Eh,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Rh,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hs,this.stencilZFail=hs,this.stencilZPass=hs,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const s=t[e];if(s===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];if(i===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(s):i&&i.isVector3&&s&&s.isVector3?i.copy(s):this[e]=s}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const s={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(s.dispersion=this.dispersion),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(s.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(t).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(t).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(t).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(t).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(t).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapRotation!==void 0&&(s.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==Th&&(s.blending=this.blending),this.side!==Gi&&(s.side=this.side),this.vertexColors===!0&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=!0),this.blendSrc!==wh&&(s.blendSrc=this.blendSrc),this.blendDst!==Mh&&(s.blendDst=this.blendDst),this.blendEquation!==Bh&&(s.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(s.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(s.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(s.blendAlpha=this.blendAlpha),this.depthFunc!==Eh&&(s.depthFunc=this.depthFunc),this.depthTest===!1&&(s.depthTest=this.depthTest),this.depthWrite===!1&&(s.depthWrite=this.depthWrite),this.colorWrite===!1&&(s.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(s.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Rh&&(s.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(s.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==hs&&(s.stencilFail=this.stencilFail),this.stencilZFail!==hs&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==hs&&(s.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(s.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaHash===!0&&(s.alphaHash=!0),this.alphaToCoverage===!0&&(s.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=!0),this.forceSinglePass===!0&&(s.forceSinglePass=!0),this.wireframe===!0&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=!0),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function i(r){const o=[];for(const a in r){const c=r[a];delete c.metadata,o.push(c)}return o}if(e){const r=i(t.textures),o=i(t.images);r.length>0&&(s.textures=r),o.length>0&&(s.images=o)}return s}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let s=null;if(e!==null){const i=e.length;s=new Array(i);for(let r=0;r!==i;++r)s[r]=e[r].clone()}return this.clippingPlanes=s,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class _s extends We{static get type(){return"MeshBasicMaterial"}constructor(t){super(),this.isMeshBasicMaterial=!0,this.color=new Y(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new De,this.combine=CT,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const K=new M,ii=new Q;class Bt{constructor(t,e,s=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=s,this.usage=Jo,this.updateRanges=[],this.gpuType=Sa,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,s){t*=this.itemSize,s*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[s+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,s=this.count;e<s;e++)ii.fromBufferAttribute(this,e),ii.applyMatrix3(t),this.setXY(e,ii.x,ii.y);else if(this.itemSize===3)for(let e=0,s=this.count;e<s;e++)K.fromBufferAttribute(this,e),K.applyMatrix3(t),this.setXYZ(e,K.x,K.y,K.z);return this}applyMatrix4(t){for(let e=0,s=this.count;e<s;e++)K.fromBufferAttribute(this,e),K.applyMatrix4(t),this.setXYZ(e,K.x,K.y,K.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)K.fromBufferAttribute(this,e),K.applyNormalMatrix(t),this.setXYZ(e,K.x,K.y,K.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)K.fromBufferAttribute(this,e),K.transformDirection(t),this.setXYZ(e,K.x,K.y,K.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let s=this.array[t*this.itemSize+e];return this.normalized&&(s=Ut(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=U(s,this.array)),this.array[t*this.itemSize+e]=s,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Ut(e,this.array)),e}setX(t,e){return this.normalized&&(e=U(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Ut(e,this.array)),e}setY(t,e){return this.normalized&&(e=U(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Ut(e,this.array)),e}setZ(t,e){return this.normalized&&(e=U(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Ut(e,this.array)),e}setW(t,e){return this.normalized&&(e=U(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=U(e,this.array),s=U(s,this.array)),this.array[t+0]=e,this.array[t+1]=s,this}setXYZ(t,e,s,i){return t*=this.itemSize,this.normalized&&(e=U(e,this.array),s=U(s,this.array),i=U(i,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this}setXYZW(t,e,s,i,r){return t*=this.itemSize,this.normalized&&(e=U(e,this.array),s=U(s,this.array),i=U(i,this.array),r=U(r,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Jo&&(t.usage=this.usage),t}}class fB extends Bt{constructor(t,e,s){super(new Uint16Array(t),e,s)}}class pB extends Bt{constructor(t,e,s){super(new Uint32Array(t),e,s)}}class Ra extends Bt{constructor(t,e,s){super(new Float32Array(t),e,s)}}let mB=0;const wt=new L,so=new W,As=new M,At=new ee,Xs=new ee,tt=new M;class $e extends er{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:mB++}),this.uuid=Jt(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(ZT(t)?pB:fB)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,s=0){this.groups.push({start:t,count:e,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const r=new Ae().getNormalMatrix(t);s.applyNormalMatrix(r),s.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return wt.makeRotationFromQuaternion(t),this.applyMatrix4(wt),this}rotateX(t){return wt.makeRotationX(t),this.applyMatrix4(wt),this}rotateY(t){return wt.makeRotationY(t),this.applyMatrix4(wt),this}rotateZ(t){return wt.makeRotationZ(t),this.applyMatrix4(wt),this}translate(t,e,s){return wt.makeTranslation(t,e,s),this.applyMatrix4(wt),this}scale(t,e,s){return wt.makeScale(t,e,s),this.applyMatrix4(wt),this}lookAt(t){return so.lookAt(t),so.updateMatrix(),this.applyMatrix4(so.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(As).negate(),this.translate(As.x,As.y,As.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const s=[];for(let i=0,r=t.length;i<r;i++){const o=t[i];s.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Ra(s,3))}else{for(let s=0,i=e.count;s<i;s++){const r=t[s];e.setXYZ(s,r.x,r.y,r.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ee);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new M(-1/0,-1/0,-1/0),new M(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let s=0,i=e.length;s<i;s++){const r=e[s];At.setFromBufferAttribute(r),this.morphTargetsRelative?(tt.addVectors(this.boundingBox.min,At.min),this.boundingBox.expandByPoint(tt),tt.addVectors(this.boundingBox.max,At.max),this.boundingBox.expandByPoint(tt)):(this.boundingBox.expandByPoint(At.min),this.boundingBox.expandByPoint(At.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new se);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new M,1/0);return}if(t){const s=this.boundingSphere.center;if(At.setFromBufferAttribute(t),e)for(let r=0,o=e.length;r<o;r++){const a=e[r];Xs.setFromBufferAttribute(a),this.morphTargetsRelative?(tt.addVectors(At.min,Xs.min),At.expandByPoint(tt),tt.addVectors(At.max,Xs.max),At.expandByPoint(tt)):(At.expandByPoint(Xs.min),At.expandByPoint(Xs.max))}At.getCenter(s);let i=0;for(let r=0,o=t.count;r<o;r++)tt.fromBufferAttribute(t,r),i=Math.max(i,s.distanceToSquared(tt));if(e)for(let r=0,o=e.length;r<o;r++){const a=e[r],c=this.morphTargetsRelative;for(let h=0,l=a.count;h<l;h++)tt.fromBufferAttribute(a,h),c&&(As.fromBufferAttribute(t,h),tt.add(As)),i=Math.max(i,s.distanceToSquared(tt))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=e.position,i=e.normal,r=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Bt(new Float32Array(4*s.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let S=0;S<s.count;S++)a[S]=new M,c[S]=new M;const h=new M,l=new M,u=new M,d=new Q,f=new Q,p=new Q,m=new M,g=new M;function b(S,F,R){h.fromBufferAttribute(s,S),l.fromBufferAttribute(s,F),u.fromBufferAttribute(s,R),d.fromBufferAttribute(r,S),f.fromBufferAttribute(r,F),p.fromBufferAttribute(r,R),l.sub(h),u.sub(h),f.sub(d),p.sub(d);const I=1/(f.x*p.y-p.x*f.y);isFinite(I)&&(m.copy(l).multiplyScalar(p.y).addScaledVector(u,-f.y).multiplyScalar(I),g.copy(u).multiplyScalar(f.x).addScaledVector(l,-p.x).multiplyScalar(I),a[S].add(m),a[F].add(m),a[R].add(m),c[S].add(g),c[F].add(g),c[R].add(g))}let y=this.groups;y.length===0&&(y=[{start:0,count:t.count}]);for(let S=0,F=y.length;S<F;++S){const R=y[S],I=R.start,G=R.count;for(let N=I,D=I+G;N<D;N+=3)b(t.getX(N+0),t.getX(N+1),t.getX(N+2))}const x=new M,A=new M,B=new M,E=new M;function C(S){B.fromBufferAttribute(i,S),E.copy(B);const F=a[S];x.copy(F),x.sub(B.multiplyScalar(B.dot(F))).normalize(),A.crossVectors(E,F);const I=A.dot(c[S])<0?-1:1;o.setXYZW(S,x.x,x.y,x.z,I)}for(let S=0,F=y.length;S<F;++S){const R=y[S],I=R.start,G=R.count;for(let N=I,D=I+G;N<D;N+=3)C(t.getX(N+0)),C(t.getX(N+1)),C(t.getX(N+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new Bt(new Float32Array(e.count*3),3),this.setAttribute("normal",s);else for(let d=0,f=s.count;d<f;d++)s.setXYZ(d,0,0,0);const i=new M,r=new M,o=new M,a=new M,c=new M,h=new M,l=new M,u=new M;if(t)for(let d=0,f=t.count;d<f;d+=3){const p=t.getX(d+0),m=t.getX(d+1),g=t.getX(d+2);i.fromBufferAttribute(e,p),r.fromBufferAttribute(e,m),o.fromBufferAttribute(e,g),l.subVectors(o,r),u.subVectors(i,r),l.cross(u),a.fromBufferAttribute(s,p),c.fromBufferAttribute(s,m),h.fromBufferAttribute(s,g),a.add(l),c.add(l),h.add(l),s.setXYZ(p,a.x,a.y,a.z),s.setXYZ(m,c.x,c.y,c.z),s.setXYZ(g,h.x,h.y,h.z)}else for(let d=0,f=e.count;d<f;d+=3)i.fromBufferAttribute(e,d+0),r.fromBufferAttribute(e,d+1),o.fromBufferAttribute(e,d+2),l.subVectors(o,r),u.subVectors(i,r),l.cross(u),s.setXYZ(d+0,l.x,l.y,l.z),s.setXYZ(d+1,l.x,l.y,l.z),s.setXYZ(d+2,l.x,l.y,l.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,s=t.count;e<s;e++)tt.fromBufferAttribute(t,e),tt.normalize(),t.setXYZ(e,tt.x,tt.y,tt.z)}toNonIndexed(){function t(a,c){const h=a.array,l=a.itemSize,u=a.normalized,d=new h.constructor(c.length*l);let f=0,p=0;for(let m=0,g=c.length;m<g;m++){a.isInterleavedBufferAttribute?f=c[m]*a.data.stride+a.offset:f=c[m]*l;for(let b=0;b<l;b++)d[p++]=h[f++]}return new Bt(d,l,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new $e,s=this.index.array,i=this.attributes;for(const a in i){const c=i[a],h=t(c,s);e.setAttribute(a,h)}const r=this.morphAttributes;for(const a in r){const c=[],h=r[a];for(let l=0,u=h.length;l<u;l++){const d=h[l],f=t(d,s);c.push(f)}e.morphAttributes[a]=c}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const h=o[a];e.addGroup(h.start,h.count,h.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(t[h]=c[h]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const s=this.attributes;for(const c in s){const h=s[c];t.data.attributes[c]=h.toJSON(t.data)}const i={};let r=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],l=[];for(let u=0,d=h.length;u<d;u++){const f=h[u];l.push(f.toJSON(t.data))}l.length>0&&(i[c]=l,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const s=t.index;s!==null&&this.setIndex(s.clone(e));const i=t.attributes;for(const h in i){const l=i[h];this.setAttribute(h,l.clone(e))}const r=t.morphAttributes;for(const h in r){const l=[],u=r[h];for(let d=0,f=u.length;d<f;d++)l.push(u[d].clone(e));this.morphAttributes[h]=l}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let h=0,l=o.length;h<l;h++){const u=o[h];this.addGroup(u.start,u.count,u.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=t.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Wh=new L,ve=new sr,ri=new se,qh=new M,oi=new M,ai=new M,ci=new M,no=new M,hi=new M,Kh=new M,li=new M;class nr extends W{constructor(t=new $e,e=new _s){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(t,e){const s=this.geometry,i=s.attributes.position,r=s.morphAttributes.position,o=s.morphTargetsRelative;e.fromBufferAttribute(i,t);const a=this.morphTargetInfluences;if(r&&a){hi.set(0,0,0);for(let c=0,h=r.length;c<h;c++){const l=a[c],u=r[c];l!==0&&(no.fromBufferAttribute(u,t),o?hi.addScaledVector(no,l):hi.addScaledVector(no.sub(e),l))}e.add(hi)}return e}raycast(t,e){const s=this.geometry,i=this.material,r=this.matrixWorld;i!==void 0&&(s.boundingSphere===null&&s.computeBoundingSphere(),ri.copy(s.boundingSphere),ri.applyMatrix4(r),ve.copy(t.ray).recast(t.near),!(ri.containsPoint(ve.origin)===!1&&(ve.intersectSphere(ri,qh)===null||ve.origin.distanceToSquared(qh)>(t.far-t.near)**2))&&(Wh.copy(r).invert(),ve.copy(t.ray).applyMatrix4(Wh),!(s.boundingBox!==null&&ve.intersectsBox(s.boundingBox)===!1)&&this._computeIntersections(t,e,ve)))}_computeIntersections(t,e,s){let i;const r=this.geometry,o=this.material,a=r.index,c=r.attributes.position,h=r.attributes.uv,l=r.attributes.uv1,u=r.attributes.normal,d=r.groups,f=r.drawRange;if(a!==null)if(Array.isArray(o))for(let p=0,m=d.length;p<m;p++){const g=d[p],b=o[g.materialIndex],y=Math.max(g.start,f.start),x=Math.min(a.count,Math.min(g.start+g.count,f.start+f.count));for(let A=y,B=x;A<B;A+=3){const E=a.getX(A),C=a.getX(A+1),S=a.getX(A+2);i=ui(this,b,t,s,h,l,u,E,C,S),i&&(i.faceIndex=Math.floor(A/3),i.face.materialIndex=g.materialIndex,e.push(i))}}else{const p=Math.max(0,f.start),m=Math.min(a.count,f.start+f.count);for(let g=p,b=m;g<b;g+=3){const y=a.getX(g),x=a.getX(g+1),A=a.getX(g+2);i=ui(this,o,t,s,h,l,u,y,x,A),i&&(i.faceIndex=Math.floor(g/3),e.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let p=0,m=d.length;p<m;p++){const g=d[p],b=o[g.materialIndex],y=Math.max(g.start,f.start),x=Math.min(c.count,Math.min(g.start+g.count,f.start+f.count));for(let A=y,B=x;A<B;A+=3){const E=A,C=A+1,S=A+2;i=ui(this,b,t,s,h,l,u,E,C,S),i&&(i.faceIndex=Math.floor(A/3),i.face.materialIndex=g.materialIndex,e.push(i))}}else{const p=Math.max(0,f.start),m=Math.min(c.count,f.start+f.count);for(let g=p,b=m;g<b;g+=3){const y=g,x=g+1,A=g+2;i=ui(this,o,t,s,h,l,u,y,x,A),i&&(i.faceIndex=Math.floor(g/3),e.push(i))}}}}function bB(n,t,e,s,i,r,o,a){let c;if(t.side===MT?c=s.intersectTriangle(o,r,i,!0,a):c=s.intersectTriangle(i,r,o,t.side===Gi,a),c===null)return null;li.copy(a),li.applyMatrix4(n.matrixWorld);const h=e.ray.origin.distanceTo(li);return h<e.near||h>e.far?null:{distance:h,point:li.clone(),object:n}}function ui(n,t,e,s,i,r,o,a,c,h){n.getVertexPosition(a,oi),n.getVertexPosition(c,ai),n.getVertexPosition(h,ci);const l=bB(n,t,e,s,oi,ai,ci,Kh);if(l){const u=new M;zt.getBarycoord(Kh,oi,ai,ci,u),i&&(l.uv=zt.getInterpolatedAttribute(i,a,c,h,u,new Q)),r&&(l.uv1=zt.getInterpolatedAttribute(r,a,c,h,u,new Q)),o&&(l.normal=zt.getInterpolatedAttribute(o,a,c,h,u,new M),l.normal.dot(s.direction)>0&&l.normal.multiplyScalar(-1));const d={a,b:c,c:h,normal:new M,materialIndex:0};zt.getNormal(oi,ai,ci,d.normal),l.face=d,l.barycoord=u}return l}class Bd extends W{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new L,this.projectionMatrix=new L,this.projectionMatrixInverse=new L,this.coordinateSystem=Ve}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const _e=new M,Xh=new Q,Qh=new Q;class Ia extends Bd{constructor(t=50,e=1,s=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=s,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=xn*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(un*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return xn*2*Math.atan(Math.tan(un*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,s){_e.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(_e.x,_e.y).multiplyScalar(-t/_e.z),_e.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(_e.x,_e.y).multiplyScalar(-t/_e.z)}getViewSize(t,e){return this.getViewBounds(t,Xh,Qh),e.subVectors(Qh,Xh)}setViewOffset(t,e,s,i,r,o){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(un*.5*this.fov)/this.zoom,s=2*e,i=this.aspect*s,r=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,h=o.fullHeight;r+=o.offsetX*i/c,e-=o.offsetY*s/h,i*=o.width/c,s*=o.height/h}const a=this.filmOffset;a!==0&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-s,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const io=new M,gB=new M,yB=new Ae;class xs{constructor(t=new M(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,s,i){return this.normal.set(t,e,s),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,s){const i=io.subVectors(s,e).cross(gB.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const s=t.delta(io),i=this.normal.dot(s);if(i===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(t.start).addScaledVector(s,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const s=e||yB.getNormalMatrix(t),i=this.coplanarPoint(io).applyMatrix4(t),r=this.normal.applyMatrix3(s).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Ue=new se,di=new M;class AB{constructor(t=new xs,e=new xs,s=new xs,i=new xs,r=new xs,o=new xs){this.planes=[t,e,s,i,r,o]}set(t,e,s,i,r,o){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(s),a[3].copy(i),a[4].copy(r),a[5].copy(o),this}copy(t){const e=this.planes;for(let s=0;s<6;s++)e[s].copy(t.planes[s]);return this}setFromProjectionMatrix(t,e=Ve){const s=this.planes,i=t.elements,r=i[0],o=i[1],a=i[2],c=i[3],h=i[4],l=i[5],u=i[6],d=i[7],f=i[8],p=i[9],m=i[10],g=i[11],b=i[12],y=i[13],x=i[14],A=i[15];if(s[0].setComponents(c-r,d-h,g-f,A-b).normalize(),s[1].setComponents(c+r,d+h,g+f,A+b).normalize(),s[2].setComponents(c+o,d+l,g+p,A+y).normalize(),s[3].setComponents(c-o,d-l,g-p,A-y).normalize(),s[4].setComponents(c-a,d-u,g-m,A-x).normalize(),e===Ve)s[5].setComponents(c+a,d+u,g+m,A+x).normalize();else if(e===Wo)s[5].setComponents(a,u,m,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),Ue.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Ue.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Ue)}intersectsSprite(t){return Ue.center.set(0,0,0),Ue.radius=.7071067811865476,Ue.applyMatrix4(t.matrixWorld),this.intersectsSphere(Ue)}intersectsSphere(t){const e=this.planes,s=t.center,i=-t.radius;for(let r=0;r<6;r++)if(e[r].distanceToPoint(s)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let s=0;s<6;s++){const i=e[s];if(di.x=i.normal.x>0?t.max.x:t.min.x,di.y=i.normal.y>0?t.max.y:t.min.y,di.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(di)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let s=0;s<6;s++)if(e[s].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class wd extends Bd{constructor(t=-1,e=1,s=1,i=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=s,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,s,i,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=s-t,o=s+t,a=i+e,c=i-e;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=h*this.view.offsetX,o=r+h*this.view.width,a-=l*this.view.offsetY,c=a-l*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}class ro extends W{constructor(){super(),this.isGroup=!0,this.type="Group"}}class xB extends W{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new De,this.environmentIntensity=1,this.environmentRotation=new De,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class TB{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Jo,this.updateRanges=[],this.version=0,this.uuid=Jt()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,s){t*=this.stride,s*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[s+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Jt()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(e,this.stride);return s.setUsage(this.usage),s}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Jt()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ht=new M;class Da{constructor(t,e,s,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=s,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,s=this.data.count;e<s;e++)ht.fromBufferAttribute(this,e),ht.applyMatrix4(t),this.setXYZ(e,ht.x,ht.y,ht.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)ht.fromBufferAttribute(this,e),ht.applyNormalMatrix(t),this.setXYZ(e,ht.x,ht.y,ht.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)ht.fromBufferAttribute(this,e),ht.transformDirection(t),this.setXYZ(e,ht.x,ht.y,ht.z);return this}getComponent(t,e){let s=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(s=Ut(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=U(s,this.array)),this.data.array[t*this.data.stride+this.offset+e]=s,this}setX(t,e){return this.normalized&&(e=U(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=U(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=U(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=U(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Ut(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Ut(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Ut(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Ut(e,this.array)),e}setXY(t,e,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=U(e,this.array),s=U(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this}setXYZ(t,e,s,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=U(e,this.array),s=U(s,this.array),i=U(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this}setXYZW(t,e,s,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=U(e,this.array),s=U(s,this.array),i=U(i,this.array),r=U(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[i+r])}return new Bt(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Da(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const Yh=new M,$h=new ut,Zh=new ut,BB=new M,tl=new L,fi=new M,oo=new se,el=new L,ao=new sr;class wB extends nr{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Ch,this.bindMatrix=new L,this.bindMatrixInverse=new L,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new ee),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let s=0;s<e.count;s++)this.getVertexPosition(s,fi),this.boundingBox.expandByPoint(fi)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new se),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let s=0;s<e.count;s++)this.getVertexPosition(s,fi),this.boundingSphere.expandByPoint(fi)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const s=this.material,i=this.matrixWorld;s!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),oo.copy(this.boundingSphere),oo.applyMatrix4(i),t.ray.intersectsSphere(oo)!==!1&&(el.copy(i).invert(),ao.copy(t.ray).applyMatrix4(el),!(this.boundingBox!==null&&ao.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,e,ao)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new ut,e=this.geometry.attributes.skinWeight;for(let s=0,i=e.count;s<i;s++){t.fromBufferAttribute(e,s);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(s,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===Ch?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===_T?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const s=this.skeleton,i=this.geometry;$h.fromBufferAttribute(i.attributes.skinIndex,t),Zh.fromBufferAttribute(i.attributes.skinWeight,t),Yh.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){const o=Zh.getComponent(r);if(o!==0){const a=$h.getComponent(r);tl.multiplyMatrices(s.bones[a].matrixWorld,s.boneInverses[a]),e.addScaledVector(BB.copy(Yh).applyMatrix4(tl),o)}}return e.applyMatrix4(this.bindMatrixInverse)}}class Md extends W{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Ed extends Wt{constructor(t=null,e=1,s=1,i,r,o,a,c,h=vi,l=vi,u,d){super(null,o,a,c,h,l,i,r,u,d),this.isDataTexture=!0,this.image={data:t,width:e,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const sl=new L,MB=new L;class Oa{constructor(t=[],e=[]){this.uuid=Jt(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let s=0,i=this.bones.length;s<i;s++)this.boneInverses.push(new L)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const s=new L;this.bones[t]&&s.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(s)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const s=this.bones[t];s&&s.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const s=this.bones[t];s&&(s.parent&&s.parent.isBone?(s.matrix.copy(s.parent.matrixWorld).invert(),s.matrix.multiply(s.matrixWorld)):s.matrix.copy(s.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale))}}update(){const t=this.bones,e=this.boneInverses,s=this.boneMatrices,i=this.boneTexture;for(let r=0,o=t.length;r<o;r++){const a=t[r]?t[r].matrixWorld:MB;sl.multiplyMatrices(a,e[r]),sl.toArray(s,r*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new Oa(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const s=new Ed(e,t,t,gd,Sa);return s.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=s,this}getBoneByName(t){for(let e=0,s=this.bones.length;e<s;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let s=0,i=t.bones.length;s<i;s++){const r=t.bones[s];let o=e[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new Md),this.bones.push(o),this.boneInverses.push(new L().fromArray(t.boneInverses[s]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,s=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const o=e[i];t.bones.push(o.uuid);const a=s[i];t.boneInverses.push(a.toArray())}return t}}class Ko extends Bt{constructor(t,e,s,i=1){super(t,e,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Ts=new L,nl=new L,pi=[],il=new ee,EB=new L,Qs=new nr,Ys=new se;class CB extends nr{constructor(t,e,s){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Ko(new Float32Array(s*16),16),this.instanceColor=null,this.morphTexture=null,this.count=s,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<s;i++)this.setMatrixAt(i,EB)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new ee),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,Ts),il.copy(t.boundingBox).applyMatrix4(Ts),this.boundingBox.union(il)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new se),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,Ts),Ys.copy(t.boundingSphere).applyMatrix4(Ts),this.boundingSphere.union(Ys)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,e){const s=e.morphTargetInfluences,i=this.morphTexture.source.data.data,r=s.length+1,o=t*r+1;for(let a=0;a<s.length;a++)s[a]=i[o+a]}raycast(t,e){const s=this.matrixWorld,i=this.count;if(Qs.geometry=this.geometry,Qs.material=this.material,Qs.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Ys.copy(this.boundingSphere),Ys.applyMatrix4(s),t.ray.intersectsSphere(Ys)!==!1))for(let r=0;r<i;r++){this.getMatrixAt(r,Ts),nl.multiplyMatrices(s,Ts),Qs.matrixWorld=nl,Qs.raycast(t,pi);for(let o=0,a=pi.length;o<a;o++){const c=pi[o];c.instanceId=r,c.object=this,e.push(c)}pi.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new Ko(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,e){const s=e.morphTargetInfluences,i=s.length+1;this.morphTexture===null&&(this.morphTexture=new Ed(new Float32Array(i*this.count),i,this.count,DT,Sa));const r=this.morphTexture.source.data.data;let o=0;for(let h=0;h<s.length;h++)o+=s[h];const a=this.geometry.morphTargetsRelative?1:1-o,c=i*t;r[c]=a,r.set(s,c+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class Cd extends We{static get type(){return"LineBasicMaterial"}constructor(t){super(),this.isLineBasicMaterial=!0,this.color=new Y(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const zi=new M,Hi=new M,rl=new L,$s=new sr,mi=new se,co=new M,ol=new M;class La extends W{constructor(t=new $e,e=new Cd){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,s=[0];for(let i=1,r=e.count;i<r;i++)zi.fromBufferAttribute(e,i-1),Hi.fromBufferAttribute(e,i),s[i]=s[i-1],s[i]+=zi.distanceTo(Hi);t.setAttribute("lineDistance",new Ra(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const s=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,o=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),mi.copy(s.boundingSphere),mi.applyMatrix4(i),mi.radius+=r,t.ray.intersectsSphere(mi)===!1)return;rl.copy(i).invert(),$s.copy(t.ray).applyMatrix4(rl);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,h=this.isLineSegments?2:1,l=s.index,d=s.attributes.position;if(l!==null){const f=Math.max(0,o.start),p=Math.min(l.count,o.start+o.count);for(let m=f,g=p-1;m<g;m+=h){const b=l.getX(m),y=l.getX(m+1),x=bi(this,t,$s,c,b,y);x&&e.push(x)}if(this.isLineLoop){const m=l.getX(p-1),g=l.getX(f),b=bi(this,t,$s,c,m,g);b&&e.push(b)}}else{const f=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);for(let m=f,g=p-1;m<g;m+=h){const b=bi(this,t,$s,c,m,m+1);b&&e.push(b)}if(this.isLineLoop){const m=bi(this,t,$s,c,p-1,f);m&&e.push(m)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function bi(n,t,e,s,i,r){const o=n.geometry.attributes.position;if(zi.fromBufferAttribute(o,i),Hi.fromBufferAttribute(o,r),e.distanceSqToSegment(zi,Hi,co,ol)>s)return;co.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(co);if(!(c<t.near||c>t.far))return{distance:c,point:ol.clone().applyMatrix4(n.matrixWorld),index:i,face:null,faceIndex:null,barycoord:null,object:n}}const al=new M,cl=new M;class _B extends La{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,s=[];for(let i=0,r=e.count;i<r;i+=2)al.fromBufferAttribute(e,i),cl.fromBufferAttribute(e,i+1),s[i]=i===0?0:s[i-1],s[i+1]=s[i]+al.distanceTo(cl);t.setAttribute("lineDistance",new Ra(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class SB extends La{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class _d extends We{static get type(){return"PointsMaterial"}constructor(t){super(),this.isPointsMaterial=!0,this.color=new Y(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const hl=new L,Xo=new sr,gi=new se,yi=new M;class FB extends W{constructor(t=new $e,e=new _d){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const s=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,o=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),gi.copy(s.boundingSphere),gi.applyMatrix4(i),gi.radius+=r,t.ray.intersectsSphere(gi)===!1)return;hl.copy(i).invert(),Xo.copy(t.ray).applyMatrix4(hl);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,h=s.index,u=s.attributes.position;if(h!==null){const d=Math.max(0,o.start),f=Math.min(h.count,o.start+o.count);for(let p=d,m=f;p<m;p++){const g=h.getX(p);yi.fromBufferAttribute(u,g),ll(yi,g,c,i,t,e,this)}}else{const d=Math.max(0,o.start),f=Math.min(u.count,o.start+o.count);for(let p=d,m=f;p<m;p++)yi.fromBufferAttribute(u,p),ll(yi,p,c,i,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function ll(n,t,e,s,i,r,o){const a=Xo.distanceSqToPoint(n);if(a<e){const c=new M;Xo.closestPointToPoint(n,c),c.applyMatrix4(s);const h=i.ray.origin.distanceTo(c);if(h<i.near||h>i.far)return;r.push({distance:h,distanceToRay:Math.sqrt(a),point:c,index:t,face:null,faceIndex:null,barycoord:null,object:o})}}class Na extends We{static get type(){return"MeshStandardMaterial"}constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new Y(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Y(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=NT,this.normalScale=new Q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new De,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class ne extends Na{static get type(){return"MeshPhysicalMaterial"}constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Q(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return at(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Y(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Y(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Y(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}function Ai(n,t,e){return!n||!e&&n.constructor===t?n:typeof t.BYTES_PER_ELEMENT=="number"?new t(n):Array.prototype.slice.call(n)}function RB(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function IB(n){function t(i,r){return n[i]-n[r]}const e=n.length,s=new Array(e);for(let i=0;i!==e;++i)s[i]=i;return s.sort(t),s}function ul(n,t,e){const s=n.length,i=new n.constructor(s);for(let r=0,o=0;o!==s;++r){const a=e[r]*t;for(let c=0;c!==t;++c)i[o++]=n[a+c]}return i}function Sd(n,t,e,s){let i=1,r=n[0];for(;r!==void 0&&r[s]===void 0;)r=n[i++];if(r===void 0)return;let o=r[s];if(o!==void 0)if(Array.isArray(o))do o=r[s],o!==void 0&&(t.push(r.time),e.push.apply(e,o)),r=n[i++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[s],o!==void 0&&(t.push(r.time),o.toArray(e,e.length)),r=n[i++];while(r!==void 0);else do o=r[s],o!==void 0&&(t.push(r.time),e.push(o)),r=n[i++];while(r!==void 0)}class Fn{constructor(t,e,s,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new e.constructor(s),this.sampleValues=e,this.valueSize=s,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let s=this._cachedIndex,i=e[s],r=e[s-1];s:{t:{let o;e:{n:if(!(t<i)){for(let a=s+2;;){if(i===void 0){if(t<r)break n;return s=e.length,this._cachedIndex=s,this.copySampleValue_(s-1)}if(s===a)break;if(r=i,i=e[++s],t<i)break t}o=e.length;break e}if(!(t>=r)){const a=e[1];t<a&&(s=2,r=a);for(let c=s-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===c)break;if(i=r,r=e[--s-1],t>=r)break t}o=s,s=0;break e}break s}for(;s<o;){const a=s+o>>>1;t<e[a]?o=a:s=a+1}if(i=e[s],r=e[s-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return s=e.length,this._cachedIndex=s,this.copySampleValue_(s-1)}this._cachedIndex=s,this.intervalChanged_(s,r,i)}return this.interpolate_(s,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,s=this.sampleValues,i=this.valueSize,r=t*i;for(let o=0;o!==i;++o)e[o]=s[r+o];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class DB extends Fn{constructor(t,e,s,i){super(t,e,s,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:_h,endingEnd:_h}}intervalChanged_(t,e,s){const i=this.parameterPositions;let r=t-2,o=t+1,a=i[r],c=i[o];if(a===void 0)switch(this.getSettings_().endingStart){case Sh:r=t,a=2*e-s;break;case Fh:r=i.length-2,a=e+i[r]-i[r+1];break;default:r=t,a=s}if(c===void 0)switch(this.getSettings_().endingEnd){case Sh:o=t,c=2*s-e;break;case Fh:o=1,c=s+i[1]-i[0];break;default:o=t-1,c=e}const h=(s-e)*.5,l=this.valueSize;this._weightPrev=h/(e-a),this._weightNext=h/(c-s),this._offsetPrev=r*l,this._offsetNext=o*l}interpolate_(t,e,s,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=t*a,h=c-a,l=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,f=this._weightNext,p=(s-e)/(i-e),m=p*p,g=m*p,b=-d*g+2*d*m-d*p,y=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*p+1,x=(-1-f)*g+(1.5+f)*m+.5*p,A=f*g-f*m;for(let B=0;B!==a;++B)r[B]=b*o[l+B]+y*o[h+B]+x*o[c+B]+A*o[u+B];return r}}class OB extends Fn{constructor(t,e,s,i){super(t,e,s,i)}interpolate_(t,e,s,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=t*a,h=c-a,l=(s-e)/(i-e),u=1-l;for(let d=0;d!==a;++d)r[d]=o[h+d]*u+o[c+d]*l;return r}}class LB extends Fn{constructor(t,e,s,i){super(t,e,s,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class ie{constructor(t,e,s,i){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Ai(e,this.TimeBufferType),this.values=Ai(s,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let s;if(e.toJSON!==this.toJSON)s=e.toJSON(t);else{s={name:t.name,times:Ai(t.times,Array),values:Ai(t.values,Array)};const i=t.getInterpolation();i!==t.DefaultInterpolation&&(s.interpolation=i)}return s.type=t.ValueTypeName,s}InterpolantFactoryMethodDiscrete(t){return new LB(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new OB(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new DB(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case yn:e=this.InterpolantFactoryMethodDiscrete;break;case An:e=this.InterpolantFactoryMethodLinear;break;case Gr:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const s="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(s);return console.warn("THREE.KeyframeTrack:",s),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return yn;case this.InterpolantFactoryMethodLinear:return An;case this.InterpolantFactoryMethodSmooth:return Gr}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let s=0,i=e.length;s!==i;++s)e[s]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let s=0,i=e.length;s!==i;++s)e[s]*=t}return this}trim(t,e){const s=this.times,i=s.length;let r=0,o=i-1;for(;r!==i&&s[r]<t;)++r;for(;o!==-1&&s[o]>e;)--o;if(++o,r!==0||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=s.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const s=this.times,i=this.values,r=s.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let a=0;a!==r;a++){const c=s[a];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),t=!1;break}if(o!==null&&o>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,o),t=!1;break}o=c}if(i!==void 0&&RB(i))for(let a=0,c=i.length;a!==c;++a){const h=i[a];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,h),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),s=this.getValueSize(),i=this.getInterpolation()===Gr,r=t.length-1;let o=1;for(let a=1;a<r;++a){let c=!1;const h=t[a],l=t[a+1];if(h!==l&&(a!==1||h!==t[0]))if(i)c=!0;else{const u=a*s,d=u-s,f=u+s;for(let p=0;p!==s;++p){const m=e[u+p];if(m!==e[d+p]||m!==e[f+p]){c=!0;break}}}if(c){if(a!==o){t[o]=t[a];const u=a*s,d=o*s;for(let f=0;f!==s;++f)e[d+f]=e[u+f]}++o}}if(r>0){t[o]=t[r];for(let a=r*s,c=o*s,h=0;h!==s;++h)e[c+h]=e[a+h];++o}return o!==t.length?(this.times=t.slice(0,o),this.values=e.slice(0,o*s)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),s=this.constructor,i=new s(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}ie.prototype.TimeBufferType=Float32Array;ie.prototype.ValueBufferType=Float32Array;ie.prototype.DefaultInterpolation=An;class Us extends ie{constructor(t,e,s){super(t,e,s)}}Us.prototype.ValueTypeName="bool";Us.prototype.ValueBufferType=Array;Us.prototype.DefaultInterpolation=yn;Us.prototype.InterpolantFactoryMethodLinear=void 0;Us.prototype.InterpolantFactoryMethodSmooth=void 0;class Fd extends ie{}Fd.prototype.ValueTypeName="color";class Ps extends ie{}Ps.prototype.ValueTypeName="number";class NB extends Fn{constructor(t,e,s,i){super(t,e,s,i)}interpolate_(t,e,s,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=(s-e)/(i-e);let h=t*a;for(let l=h+a;h!==l;h+=4)Oe.slerpFlat(r,0,o,h-a,o,h,c);return r}}class Gs extends ie{InterpolantFactoryMethodLinear(t){return new NB(this.times,this.values,this.getValueSize(),t)}}Gs.prototype.ValueTypeName="quaternion";Gs.prototype.InterpolantFactoryMethodSmooth=void 0;class zs extends ie{constructor(t,e,s){super(t,e,s)}}zs.prototype.ValueTypeName="string";zs.prototype.ValueBufferType=Array;zs.prototype.DefaultInterpolation=yn;zs.prototype.InterpolantFactoryMethodLinear=void 0;zs.prototype.InterpolantFactoryMethodSmooth=void 0;class vs extends ie{}vs.prototype.ValueTypeName="vector";class kB{constructor(t="",e=-1,s=[],i=OT){this.name=t,this.tracks=s,this.duration=e,this.blendMode=i,this.uuid=Jt(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],s=t.tracks,i=1/(t.fps||1);for(let o=0,a=s.length;o!==a;++o)e.push(GB(s[o]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],s=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let r=0,o=s.length;r!==o;++r)e.push(ie.toJSON(s[r]));return i}static CreateFromMorphTargetSequence(t,e,s,i){const r=e.length,o=[];for(let a=0;a<r;a++){let c=[],h=[];c.push((a+r-1)%r,a,(a+1)%r),h.push(0,1,0);const l=IB(c);c=ul(c,1,l),h=ul(h,1,l),!i&&c[0]===0&&(c.push(r),h.push(h[0])),o.push(new Ps(".morphTargetInfluences["+e[a].name+"]",c,h).scale(1/s))}return new this(t,-1,o)}static findByName(t,e){let s=t;if(!Array.isArray(t)){const i=t;s=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<s.length;i++)if(s[i].name===e)return s[i];return null}static CreateClipsFromMorphTargetSequences(t,e,s){const i={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,c=t.length;a<c;a++){const h=t[a],l=h.name.match(r);if(l&&l.length>1){const u=l[1];let d=i[u];d||(i[u]=d=[]),d.push(h)}}const o=[];for(const a in i)o.push(this.CreateFromMorphTargetSequence(a,i[a],e,s));return o}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const s=function(u,d,f,p,m){if(f.length!==0){const g=[],b=[];Sd(f,g,b,p),g.length!==0&&m.push(new u(d,g,b))}},i=[],r=t.name||"default",o=t.fps||30,a=t.blendMode;let c=t.length||-1;const h=t.hierarchy||[];for(let u=0;u<h.length;u++){const d=h[u].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let p;for(p=0;p<d.length;p++)if(d[p].morphTargets)for(let m=0;m<d[p].morphTargets.length;m++)f[d[p].morphTargets[m]]=-1;for(const m in f){const g=[],b=[];for(let y=0;y!==d[p].morphTargets.length;++y){const x=d[p];g.push(x.time),b.push(x.morphTarget===m?1:0)}i.push(new Ps(".morphTargetInfluence["+m+"]",g,b))}c=f.length*o}else{const f=".bones["+e[u].name+"]";s(vs,f+".position",d,"pos",i),s(Gs,f+".quaternion",d,"rot",i),s(vs,f+".scale",d,"scl",i)}}return i.length===0?null:new this(r,c,i,a)}resetDuration(){const t=this.tracks;let e=0;for(let s=0,i=t.length;s!==i;++s){const r=this.tracks[s];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function PB(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ps;case"vector":case"vector2":case"vector3":case"vector4":return vs;case"color":return Fd;case"quaternion":return Gs;case"bool":case"boolean":return Us;case"string":return zs}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function GB(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=PB(n.type);if(n.times===void 0){const e=[],s=[];Sd(n.keys,e,s,"value"),n.times=e,n.values=s}return t.parse!==void 0?t.parse(n):new t(n.name,n.times,n.values,n.interpolation)}const Ie={enabled:!1,files:{},add:function(n,t){this.enabled!==!1&&(this.files[n]=t)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class Rd{constructor(t,e,s){const i=this;let r=!1,o=0,a=0,c;const h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=s,this.itemStart=function(l){a++,r===!1&&i.onStart!==void 0&&i.onStart(l,o,a),r=!0},this.itemEnd=function(l){o++,i.onProgress!==void 0&&i.onProgress(l,o,a),o===a&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(l){i.onError!==void 0&&i.onError(l)},this.resolveURL=function(l){return c?c(l):l},this.setURLModifier=function(l){return c=l,this},this.addHandler=function(l,u){return h.push(l,u),this},this.removeHandler=function(l){const u=h.indexOf(l);return u!==-1&&h.splice(u,2),this},this.getHandler=function(l){for(let u=0,d=h.length;u<d;u+=2){const f=h[u],p=h[u+1];if(f.global&&(f.lastIndex=0),f.test(l))return p}return null}}}const vB=new Rd;class Ze{constructor(t){this.manager=t!==void 0?t:vB,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const s=this;return new Promise(function(i,r){s.load(t,i,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Ze.DEFAULT_MATERIAL_NAME="__DEFAULT";const fe={};class UB extends Error{constructor(t,e){super(t),this.response=e}}class ji extends Ze{constructor(t){super(t)}load(t,e,s,i){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=Ie.get(t);if(r!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(r),this.manager.itemEnd(t)},0),r;if(fe[t]!==void 0){fe[t].push({onLoad:e,onProgress:s,onError:i});return}fe[t]=[],fe[t].push({onLoad:e,onProgress:s,onError:i});const o=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(o).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const l=fe[t],u=h.body.getReader(),d=h.headers.get("X-File-Size")||h.headers.get("Content-Length"),f=d?parseInt(d):0,p=f!==0;let m=0;const g=new ReadableStream({start(b){y();function y(){u.read().then(({done:x,value:A})=>{if(x)b.close();else{m+=A.byteLength;const B=new ProgressEvent("progress",{lengthComputable:p,loaded:m,total:f});for(let E=0,C=l.length;E<C;E++){const S=l[E];S.onProgress&&S.onProgress(B)}b.enqueue(A),y()}},x=>{b.error(x)})}}});return new Response(g)}else throw new UB(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(c){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(l=>new DOMParser().parseFromString(l,a));case"json":return h.json();default:if(a===void 0)return h.text();{const u=/charset="?([^;"\s]*)"?/i.exec(a),d=u&&u[1]?u[1].toLowerCase():void 0,f=new TextDecoder(d);return h.arrayBuffer().then(p=>f.decode(p))}}}).then(h=>{Ie.add(t,h);const l=fe[t];delete fe[t];for(let u=0,d=l.length;u<d;u++){const f=l[u];f.onLoad&&f.onLoad(h)}}).catch(h=>{const l=fe[t];if(l===void 0)throw this.manager.itemError(t),h;delete fe[t];for(let u=0,d=l.length;u<d;u++){const f=l[u];f.onError&&f.onError(h)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class zB extends Ze{constructor(t){super(t)}load(t,e,s,i){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=Ie.get(t);if(o!==void 0)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;const a=qo("img");function c(){l(),Ie.add(t,this),e&&e(this),r.manager.itemEnd(t)}function h(u){l(),i&&i(u),r.manager.itemError(t),r.manager.itemEnd(t)}function l(){a.removeEventListener("load",c,!1),a.removeEventListener("error",h,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",h,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class HB extends Ze{constructor(t){super(t)}load(t,e,s,i){const r=new Wt,o=new zB(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(a){r.image=a,r.needsUpdate=!0,e!==void 0&&e(r)},s,i),r}}class ka extends W{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Y(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}}const ho=new L,dl=new M,fl=new M;class Pa{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Q(512,512),this.map=null,this.mapPass=null,this.matrix=new L,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new AB,this._frameExtents=new Q(1,1),this._viewportCount=1,this._viewports=[new ut(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,s=this.matrix;dl.setFromMatrixPosition(t.matrixWorld),e.position.copy(dl),fl.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(fl),e.updateMatrixWorld(),ho.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ho),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(ho)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class jB extends Pa{constructor(){super(new Ia(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,s=xn*2*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;(s!==e.fov||i!==e.aspect||r!==e.far)&&(e.fov=s,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class VB extends ka{constructor(t,e,s=0,i=Math.PI/3,r=0,o=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(W.DEFAULT_UP),this.updateMatrix(),this.target=new W,this.distance=s,this.angle=i,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new jB}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const pl=new L,Zs=new M,lo=new M;class JB extends Pa{constructor(){super(new Ia(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Q(4,2),this._viewportCount=6,this._viewports=[new ut(2,1,1,1),new ut(0,1,1,1),new ut(3,1,1,1),new ut(1,1,1,1),new ut(3,0,1,1),new ut(1,0,1,1)],this._cubeDirections=[new M(1,0,0),new M(-1,0,0),new M(0,0,1),new M(0,0,-1),new M(0,1,0),new M(0,-1,0)],this._cubeUps=[new M(0,1,0),new M(0,1,0),new M(0,1,0),new M(0,1,0),new M(0,0,1),new M(0,0,-1)]}updateMatrices(t,e=0){const s=this.camera,i=this.matrix,r=t.distance||s.far;r!==s.far&&(s.far=r,s.updateProjectionMatrix()),Zs.setFromMatrixPosition(t.matrixWorld),s.position.copy(Zs),lo.copy(s.position),lo.add(this._cubeDirections[e]),s.up.copy(this._cubeUps[e]),s.lookAt(lo),s.updateMatrixWorld(),i.makeTranslation(-Zs.x,-Zs.y,-Zs.z),pl.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(pl)}}class WB extends ka{constructor(t,e,s=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=s,this.decay=i,this.shadow=new JB}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class qB extends Pa{constructor(){super(new wd(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class KB extends ka{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(W.DEFAULT_UP),this.updateMatrix(),this.target=new W,this.shadow=new qB}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class fn{static decodeText(t){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(t);let e="";for(let s=0,i=t.length;s<i;s++)e+=String.fromCharCode(t[s]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class XB extends Ze{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,s,i){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=Ie.get(t);if(o!==void 0){if(r.manager.itemStart(t),o.then){o.then(h=>{e&&e(h),r.manager.itemEnd(t)}).catch(h=>{i&&i(h)});return}return setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const c=fetch(t,a).then(function(h){return h.blob()}).then(function(h){return createImageBitmap(h,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(h){return Ie.add(t,h),e&&e(h),r.manager.itemEnd(t),h}).catch(function(h){i&&i(h),Ie.remove(t),r.manager.itemError(t),r.manager.itemEnd(t)});Ie.add(t,c),r.manager.itemStart(t)}}const Ga="\\[\\]\\.:\\/",QB=new RegExp("["+Ga+"]","g"),va="[^"+Ga+"]",YB="[^"+Ga.replace("\\.","")+"]",$B=/((?:WC+[\/:])*)/.source.replace("WC",va),ZB=/(WCOD+)?/.source.replace("WCOD",YB),tw=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",va),ew=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",va),sw=new RegExp("^"+$B+ZB+tw+ew+"$"),nw=["material","materials","bones","map"];class iw{constructor(t,e,s){const i=s||z.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const s=this._targetGroup.nCachedObjects_,i=this._bindings[s];i!==void 0&&i.getValue(t,e)}setValue(t,e){const s=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=s.length;i!==r;++i)s[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,s=t.length;e!==s;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,s=t.length;e!==s;++e)t[e].unbind()}}class z{constructor(t,e,s){this.path=e,this.parsedPath=s||z.parseTrackName(e),this.node=z.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,s){return t&&t.isAnimationObjectGroup?new z.Composite(t,e,s):new z(t,e,s)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(QB,"")}static parseTrackName(t){const e=sw.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const s={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=s.nodeName&&s.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const r=s.nodeName.substring(i+1);nw.indexOf(r)!==-1&&(s.nodeName=s.nodeName.substring(0,i),s.objectName=r)}if(s.propertyName===null||s.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return s}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const s=t.skeleton.getBoneByName(e);if(s!==void 0)return s}if(t.children){const s=function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===e||a.uuid===e)return a;const c=s(a.children);if(c)return c}return null},i=s(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const s=this.resolvedProperty;for(let i=0,r=s.length;i!==r;++i)t[e++]=s[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const s=this.resolvedProperty;for(let i=0,r=s.length;i!==r;++i)s[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const s=this.resolvedProperty;for(let i=0,r=s.length;i!==r;++i)s[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const s=this.resolvedProperty;for(let i=0,r=s.length;i!==r;++i)s[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,s=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=z.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(s){let h=e.objectIndex;switch(s){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let l=0;l<t.length;l++)if(t[l].name===h){h=l;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[s]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[s]}if(h!==void 0){if(t[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[h]}}const o=t[i];if(o===void 0){const h=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+i+" but it wasn't found.",t);return}let a=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[r]!==void 0&&(r=t.morphTargetDictionary[r])}c=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(c=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}z.Composite=iw;z.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};z.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};z.prototype.GetterByBindingType=[z.prototype._getValue_direct,z.prototype._getValue_array,z.prototype._getValue_arrayElement,z.prototype._getValue_toArray];z.prototype.SetterByBindingTypeAndVersioning=[[z.prototype._setValue_direct,z.prototype._setValue_direct_setNeedsUpdate,z.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[z.prototype._setValue_array,z.prototype._setValue_array_setNeedsUpdate,z.prototype._setValue_array_setMatrixWorldNeedsUpdate],[z.prototype._setValue_arrayElement,z.prototype._setValue_arrayElement_setNeedsUpdate,z.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[z.prototype._setValue_fromArray,z.prototype._setValue_fromArray_setNeedsUpdate,z.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:md}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=md);class rw{parse(t,e={}){e=Object.assign({binary:!1},e);const s=e.binary,i=[];let r=0;t.traverse(function(b){if(b.isMesh){const y=b.geometry,x=y.index,A=y.getAttribute("position");r+=x!==null?x.count/3:A.count/3,i.push({object3d:b,geometry:y})}});let o,a=80;if(s===!0){const b=r*2+r*3*4*4+80+4,y=new ArrayBuffer(b);o=new DataView(y),o.setUint32(a,r,!0),a+=4}else o="",o+=`solid exported
`;const c=new M,h=new M,l=new M,u=new M,d=new M,f=new M;for(let b=0,y=i.length;b<y;b++){const x=i[b].object3d,A=i[b].geometry,B=A.index,E=A.getAttribute("position");if(B!==null)for(let C=0;C<B.count;C+=3){const S=B.getX(C+0),F=B.getX(C+1),R=B.getX(C+2);p(S,F,R,E,x)}else for(let C=0;C<E.count;C+=3){const S=C+0,F=C+1,R=C+2;p(S,F,R,E,x)}}return s===!1&&(o+=`endsolid exported
`),o;function p(b,y,x,A,B){c.fromBufferAttribute(A,b),h.fromBufferAttribute(A,y),l.fromBufferAttribute(A,x),B.isSkinnedMesh===!0&&(B.applyBoneTransform(b,c),B.applyBoneTransform(y,h),B.applyBoneTransform(x,l)),c.applyMatrix4(B.matrixWorld),h.applyMatrix4(B.matrixWorld),l.applyMatrix4(B.matrixWorld),m(c,h,l),g(c),g(h),g(l),s===!0?(o.setUint16(a,0,!0),a+=2):(o+=`		endloop
`,o+=`	endfacet
`)}function m(b,y,x){u.subVectors(x,y),d.subVectors(b,y),u.cross(d).normalize(),f.copy(u).normalize(),s===!0?(o.setFloat32(a,f.x,!0),a+=4,o.setFloat32(a,f.y,!0),a+=4,o.setFloat32(a,f.z,!0),a+=4):(o+="	facet normal "+f.x+" "+f.y+" "+f.z+`
`,o+=`		outer loop
`)}function g(b){s===!0?(o.setFloat32(a,b.x,!0),a+=4,o.setFloat32(a,b.y,!0),a+=4,o.setFloat32(a,b.z,!0),a+=4):o+="			vertex "+b.x+" "+b.y+" "+b.z+`
`}}}function ml(n,t){if(t===LT)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(t===jo||t===yd){let e=n.getIndex();if(e===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)o.push(c);n.setIndex(o),e=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const s=e.count-2,i=[];if(t===jo)for(let o=1;o<=s;o++)i.push(e.getX(0)),i.push(e.getX(o)),i.push(e.getX(o+1));else for(let o=0;o<s;o++)o%2===0?(i.push(e.getX(o)),i.push(e.getX(o+1)),i.push(e.getX(o+2))):(i.push(e.getX(o+2)),i.push(e.getX(o+1)),i.push(e.getX(o)));i.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=n.clone();return r.setIndex(i),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),n}const uo=new WeakMap;class ow extends Ze{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,s,i){const r=new ji(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,o=>{this.parse(o,e,i)},s,i)}parse(t,e,s=()=>{}){this.decodeDracoFile(t,e,null,null,$,s).catch(s)}decodeDracoFile(t,e,s,i,r=Dt,o=()=>{}){const a={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:r};return this.decodeGeometry(t,a).then(e).catch(o)}decodeGeometry(t,e){const s=JSON.stringify(e);if(uo.has(t)){const c=uo.get(t);if(c.key===s)return c.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,o=t.byteLength,a=this._getWorker(r,o).then(c=>(i=c,new Promise((h,l)=>{i._callbacks[r]={resolve:h,reject:l},i.postMessage({type:"decode",id:r,taskConfig:e,buffer:t},[t])}))).then(c=>this._createGeometry(c.geometry));return a.catch(()=>!0).then(()=>{i&&r&&this._releaseTask(i,r)}),uo.set(t,{key:s,promise:a}),a}_createGeometry(t){const e=new $e;t.index&&e.setIndex(new Bt(t.index.array,1));for(let s=0;s<t.attributes.length;s++){const i=t.attributes[s],r=i.name,o=i.array,a=i.itemSize,c=new Bt(o,a);r==="color"&&(this._assignVertexColorSpace(c,i.vertexColorSpace),c.normalized=!(o instanceof Float32Array)),e.setAttribute(r,c)}return e}_assignVertexColorSpace(t,e){if(e!==$)return;const s=new Y;for(let i=0,r=t.count;i<r;i++)s.fromBufferAttribute(t,i),lt.toWorkingColorSpace(s,$),t.setXYZ(i,s.r,s.g,s.b)}_loadLibrary(t,e){const s=new ji(this.manager);return s.setPath(this.decoderPath),s.setResponseType(e),s.setWithCredentials(this.withCredentials),new Promise((i,r)=>{s.load(t,i,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(s=>{const i=s[0];t||(this.decoderConfig.wasmBinary=s[1]);const r=aw.toString(),o=["/* draco decoder */",i,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(t,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(r){const o=r.data;switch(o.type){case"decode":i._callbacks[o.id].resolve(o);break;case"error":i._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,r){return i._taskLoad>r._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[t]=e,s._taskLoad+=e,s})}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function aw(){let n,t;onmessage=function(o){const a=o.data;switch(a.type){case"init":n=a.decoderConfig,t=new Promise(function(l){n.onModuleLoaded=function(u){l({draco:u})},DracoDecoderModule(n)});break;case"decode":const c=a.buffer,h=a.taskConfig;t.then(l=>{const u=l.draco,d=new u.Decoder;try{const f=e(u,d,new Int8Array(c),h),p=f.attributes.map(m=>m.array.buffer);f.index&&p.push(f.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:f},p)}catch(f){console.error(f),self.postMessage({type:"error",id:a.id,error:f.message})}finally{u.destroy(d)}});break}};function e(o,a,c,h){const l=h.attributeIDs,u=h.attributeTypes;let d,f;const p=a.GetEncodedGeometryType(c);if(p===o.TRIANGULAR_MESH)d=new o.Mesh,f=a.DecodeArrayToMesh(c,c.byteLength,d);else if(p===o.POINT_CLOUD)d=new o.PointCloud,f=a.DecodeArrayToPointCloud(c,c.byteLength,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const m={index:null,attributes:[]};for(const g in l){const b=self[u[g]];let y,x;if(h.useUniqueIDs)x=l[g],y=a.GetAttributeByUniqueId(d,x);else{if(x=a.GetAttributeId(d,o[l[g]]),x===-1)continue;y=a.GetAttribute(d,x)}const A=i(o,a,d,g,b,y);g==="color"&&(A.vertexColorSpace=h.vertexColorSpace),m.attributes.push(A)}return p===o.TRIANGULAR_MESH&&(m.index=s(o,a,d)),o.destroy(d),m}function s(o,a,c){const l=c.num_faces()*3,u=l*4,d=o._malloc(u);a.GetTrianglesUInt32Array(c,u,d);const f=new Uint32Array(o.HEAPF32.buffer,d,l).slice();return o._free(d),{array:f,itemSize:1}}function i(o,a,c,h,l,u){const d=u.num_components(),p=c.num_points()*d,m=p*l.BYTES_PER_ELEMENT,g=r(o,l),b=o._malloc(m);a.GetAttributeDataArrayForAllPoints(c,u,g,m,b);const y=new l(o.HEAPF32.buffer,b,p).slice();return o._free(b),{name:h,array:y,itemSize:d}}function r(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class cw extends Ze{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new fw(e)}),this.register(function(e){return new pw(e)}),this.register(function(e){return new ww(e)}),this.register(function(e){return new Mw(e)}),this.register(function(e){return new Ew(e)}),this.register(function(e){return new bw(e)}),this.register(function(e){return new gw(e)}),this.register(function(e){return new yw(e)}),this.register(function(e){return new Aw(e)}),this.register(function(e){return new dw(e)}),this.register(function(e){return new xw(e)}),this.register(function(e){return new mw(e)}),this.register(function(e){return new Bw(e)}),this.register(function(e){return new Tw(e)}),this.register(function(e){return new lw(e)}),this.register(function(e){return new Cw(e)}),this.register(function(e){return new _w(e)})}load(t,e,s,i){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const h=fn.extractUrlBase(t);o=fn.resolveURL(h,this.path)}else o=fn.extractUrlBase(t);this.manager.itemStart(t);const a=function(h){i?i(h):console.error(h),r.manager.itemError(t),r.manager.itemEnd(t)},c=new ji(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(h){try{r.parse(h,o,function(l){e(l),r.manager.itemEnd(t)},a)}catch(l){a(l)}},s,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,s,i){let r;const o={},a={},c=new TextDecoder;if(typeof t=="string")r=JSON.parse(t);else if(t instanceof ArrayBuffer)if(c.decode(new Uint8Array(t,0,4))===Id){try{o[O.KHR_BINARY_GLTF]=new Sw(t)}catch(u){i&&i(u);return}r=JSON.parse(o[O.KHR_BINARY_GLTF].content)}else r=JSON.parse(c.decode(t));else r=t;if(r.asset===void 0||r.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new zw(r,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const u=this.pluginCallbacks[l](h);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(r.extensionsUsed)for(let l=0;l<r.extensionsUsed.length;++l){const u=r.extensionsUsed[l],d=r.extensionsRequired||[];switch(u){case O.KHR_MATERIALS_UNLIT:o[u]=new uw;break;case O.KHR_DRACO_MESH_COMPRESSION:o[u]=new Fw(r,this.dracoLoader);break;case O.KHR_TEXTURE_TRANSFORM:o[u]=new Rw;break;case O.KHR_MESH_QUANTIZATION:o[u]=new Iw;break;default:d.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}h.setExtensions(o),h.setPlugins(a),h.parse(s,i)}parseAsync(t,e){const s=this;return new Promise(function(i,r){s.parse(t,e,i,r)})}}function hw(){let n={};return{get:function(t){return n[t]},add:function(t,e){n[t]=e},remove:function(t){delete n[t]},removeAll:function(){n={}}}}const O={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class lw{constructor(t){this.parser=t,this.name=O.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let s=0,i=e.length;s<i;s++){const r=e[s];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(t){const e=this.parser,s="light:"+t;let i=e.cache.get(s);if(i)return i;const r=e.json,c=((r.extensions&&r.extensions[this.name]||{}).lights||[])[t];let h;const l=new Y(16777215);c.color!==void 0&&l.setRGB(c.color[0],c.color[1],c.color[2],Dt);const u=c.range!==void 0?c.range:0;switch(c.type){case"directional":h=new KB(l),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new WB(l),h.distance=u;break;case"spot":h=new VB(l),h.distance=u,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,h.angle=c.spot.outerConeAngle,h.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return h.position.set(0,0,0),h.decay=2,pe(h,c),c.intensity!==void 0&&(h.intensity=c.intensity),h.name=e.createUniqueName(c.name||"light_"+t),i=Promise.resolve(h),e.cache.add(s,i),i}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){const e=this,s=this.parser,r=s.json.nodes[t],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return s._getNodeRef(e.cache,a,c)})}}class uw{constructor(){this.name=O.KHR_MATERIALS_UNLIT}getMaterialType(){return _s}extendParams(t,e,s){const i=[];t.color=new Y(1,1,1),t.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;t.color.setRGB(o[0],o[1],o[2],Dt),t.opacity=o[3]}r.baseColorTexture!==void 0&&i.push(s.assignTexture(t,"map",r.baseColorTexture,$))}return Promise.all(i)}}class dw{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name].emissiveStrength;return r!==void 0&&(e.emissiveIntensity=r),Promise.resolve()}}class fw{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ne}extendMaterialParams(t,e){const s=this.parser,i=s.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(s.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(s.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(s.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Q(a,a)}return Promise.all(r)}}class pw{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_DISPERSION}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ne}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return e.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}class mw{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ne}extendMaterialParams(t,e){const s=this.parser,i=s.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return o.iridescenceFactor!==void 0&&(e.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(s.assignTexture(e,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(e.iridescenceIOR=o.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(s.assignTexture(e,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class bw{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_SHEEN}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ne}extendMaterialParams(t,e){const s=this.parser,i=s.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new Y(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=i.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;e.sheenColor.setRGB(a[0],a[1],a[2],Dt)}return o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(s.assignTexture(e,"sheenColorMap",o.sheenColorTexture,$)),o.sheenRoughnessTexture!==void 0&&r.push(s.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class gw{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ne}extendMaterialParams(t,e){const s=this.parser,i=s.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(s.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class yw{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_VOLUME}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ne}extendMaterialParams(t,e){const s=this.parser,i=s.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(s.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new Y().setRGB(a[0],a[1],a[2],Dt),Promise.all(r)}}class Aw{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_IOR}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ne}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return e.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class xw{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_SPECULAR}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ne}extendMaterialParams(t,e){const s=this.parser,i=s.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(s.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new Y().setRGB(a[0],a[1],a[2],Dt),o.specularColorTexture!==void 0&&r.push(s.assignTexture(e,"specularColorMap",o.specularColorTexture,$)),Promise.all(r)}}class Tw{constructor(t){this.parser=t,this.name=O.EXT_MATERIALS_BUMP}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ne}extendMaterialParams(t,e){const s=this.parser,i=s.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return e.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(s.assignTexture(e,"bumpMap",o.bumpTexture)),Promise.all(r)}}class Bw{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ne}extendMaterialParams(t,e){const s=this.parser,i=s.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return o.anisotropyStrength!==void 0&&(e.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(e.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(s.assignTexture(e,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}}class ww{constructor(t){this.parser=t,this.name=O.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,s=e.json,i=s.textures[t];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],o=e.options.ktx2Loader;if(!o){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,r.source,o)}}class Mw{constructor(t){this.parser=t,this.name=O.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,s=this.parser,i=s.json,r=i.textures[t];if(!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=i.images[o.source];let c=s.textureLoader;if(a.uri){const h=s.options.manager.getHandler(a.uri);h!==null&&(c=h)}return this.detectSupport().then(function(h){if(h)return s.loadTextureImage(t,o.source,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class Ew{constructor(t){this.parser=t,this.name=O.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,s=this.parser,i=s.json,r=i.textures[t];if(!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=i.images[o.source];let c=s.textureLoader;if(a.uri){const h=s.options.manager.getHandler(a.uri);h!==null&&(c=h)}return this.detectSupport().then(function(h){if(h)return s.loadTextureImage(t,o.source,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class Cw{constructor(t){this.name=O.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,s=e.bufferViews[t];if(s.extensions&&s.extensions[this.name]){const i=s.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const c=i.byteOffset||0,h=i.byteLength||0,l=i.count,u=i.byteStride,d=new Uint8Array(a,c,h);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(l,u,d,i.mode,i.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(l*u);return o.decodeGltfBuffer(new Uint8Array(f),l,u,d,i.mode,i.filter),f})})}else return null}}class _w{constructor(t){this.name=O.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,s=e.nodes[t];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const i=e.meshes[s.mesh];for(const h of i.primitives)if(h.mode!==Mt.TRIANGLES&&h.mode!==Mt.TRIANGLE_STRIP&&h.mode!==Mt.TRIANGLE_FAN&&h.mode!==void 0)return null;const o=s.extensions[this.name].attributes,a=[],c={};for(const h in o)a.push(this.parser.getDependency("accessor",o[h]).then(l=>(c[h]=l,c[h])));return a.length<1?null:(a.push(this.parser.createNodeMesh(t)),Promise.all(a).then(h=>{const l=h.pop(),u=l.isGroup?l.children:[l],d=h[0].count,f=[];for(const p of u){const m=new L,g=new M,b=new Oe,y=new M(1,1,1),x=new CB(p.geometry,p.material,d);for(let A=0;A<d;A++)c.TRANSLATION&&g.fromBufferAttribute(c.TRANSLATION,A),c.ROTATION&&b.fromBufferAttribute(c.ROTATION,A),c.SCALE&&y.fromBufferAttribute(c.SCALE,A),x.setMatrixAt(A,m.compose(g,b,y));for(const A in c)if(A==="_COLOR_0"){const B=c[A];x.instanceColor=new Ko(B.array,B.itemSize,B.normalized)}else A!=="TRANSLATION"&&A!=="ROTATION"&&A!=="SCALE"&&p.geometry.setAttribute(A,c[A]);W.prototype.copy.call(x,p),this.parser.assignFinalMaterial(x),f.push(x)}return l.isGroup?(l.clear(),l.add(...f),l):f[0]}))}}const Id="glTF",tn=12,bl={JSON:1313821514,BIN:5130562};class Sw{constructor(t){this.name=O.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,tn),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Id)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-tn,r=new DataView(t,tn);let o=0;for(;o<i;){const a=r.getUint32(o,!0);o+=4;const c=r.getUint32(o,!0);if(o+=4,c===bl.JSON){const h=new Uint8Array(t,tn+o,a);this.content=s.decode(h)}else if(c===bl.BIN){const h=tn+o;this.body=t.slice(h,h+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Fw{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=O.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const s=this.json,i=this.dracoLoader,r=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,a={},c={},h={};for(const l in o){const u=Qo[l]||l.toLowerCase();a[u]=o[l]}for(const l in t.attributes){const u=Qo[l]||l.toLowerCase();if(o[l]!==void 0){const d=s.accessors[t.attributes[l]],f=Is[d.componentType];h[u]=f.name,c[u]=d.normalized===!0}}return e.getDependency("bufferView",r).then(function(l){return new Promise(function(u,d){i.decodeDracoFile(l,function(f){for(const p in f.attributes){const m=f.attributes[p],g=c[p];g!==void 0&&(m.normalized=g)}u(f)},a,h,Dt,d)})})}}class Rw{constructor(){this.name=O.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(e.texCoord===void 0||e.texCoord===t.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.texCoord!==void 0&&(t.channel=e.texCoord),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class Iw{constructor(){this.name=O.KHR_MESH_QUANTIZATION}}class Dd extends Fn{constructor(t,e,s,i){super(t,e,s,i)}copySampleValue_(t){const e=this.resultBuffer,s=this.sampleValues,i=this.valueSize,r=t*i*3+i;for(let o=0;o!==i;o++)e[o]=s[r+o];return e}interpolate_(t,e,s,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=a*2,h=a*3,l=i-e,u=(s-e)/l,d=u*u,f=d*u,p=t*h,m=p-h,g=-2*f+3*d,b=f-d,y=1-g,x=b-d+u;for(let A=0;A!==a;A++){const B=o[m+A+a],E=o[m+A+c]*l,C=o[p+A+a],S=o[p+A]*l;r[A]=y*B+x*E+g*C+b*S}return r}}const Dw=new Oe;class Ow extends Dd{interpolate_(t,e,s,i){const r=super.interpolate_(t,e,s,i);return Dw.fromArray(r).normalize().toArray(r),r}}const Mt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Is={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},gl={9728:vi,9729:Ui,9984:ST,9985:RT,9986:FT,9987:_a},yl={33071:rn,33648:Ho,10497:gn},fo={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Qo={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Se={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Lw={CUBICSPLINE:void 0,LINEAR:An,STEP:yn},po={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Nw(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Na({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Gi})),n.DefaultMaterial}function ze(n,t,e){for(const s in e.extensions)n[s]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[s]=e.extensions[s])}function pe(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function kw(n,t,e){let s=!1,i=!1,r=!1;for(let h=0,l=t.length;h<l;h++){const u=t[h];if(u.POSITION!==void 0&&(s=!0),u.NORMAL!==void 0&&(i=!0),u.COLOR_0!==void 0&&(r=!0),s&&i&&r)break}if(!s&&!i&&!r)return Promise.resolve(n);const o=[],a=[],c=[];for(let h=0,l=t.length;h<l;h++){const u=t[h];if(s){const d=u.POSITION!==void 0?e.getDependency("accessor",u.POSITION):n.attributes.position;o.push(d)}if(i){const d=u.NORMAL!==void 0?e.getDependency("accessor",u.NORMAL):n.attributes.normal;a.push(d)}if(r){const d=u.COLOR_0!==void 0?e.getDependency("accessor",u.COLOR_0):n.attributes.color;c.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(h){const l=h[0],u=h[1],d=h[2];return s&&(n.morphAttributes.position=l),i&&(n.morphAttributes.normal=u),r&&(n.morphAttributes.color=d),n.morphTargetsRelative=!0,n})}function Pw(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let e=0,s=t.weights.length;e<s;e++)n.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){const e=t.extras.targetNames;if(n.morphTargetInfluences.length===e.length){n.morphTargetDictionary={};for(let s=0,i=e.length;s<i;s++)n.morphTargetDictionary[e[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Gw(n){let t;const e=n.extensions&&n.extensions[O.KHR_DRACO_MESH_COMPRESSION];if(e?t="draco:"+e.bufferView+":"+e.indices+":"+mo(e.attributes):t=n.indices+":"+mo(n.attributes)+":"+n.mode,n.targets!==void 0)for(let s=0,i=n.targets.length;s<i;s++)t+=":"+mo(n.targets[s]);return t}function mo(n){let t="";const e=Object.keys(n).sort();for(let s=0,i=e.length;s<i;s++)t+=e[s]+":"+n[e[s]]+";";return t}function Yo(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function vw(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":n.search(/\.ktx2($|\?)/i)>0||n.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Uw=new L;class zw{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new hw,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,i=-1,r=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;s=/^((?!chrome|android).)*safari/i.test(a)===!0;const c=a.match(/Version\/(\d+)/);i=s&&c?parseInt(c[1],10):-1,r=a.indexOf("Firefox")>-1,o=r?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||s&&i<17||r&&o<98?this.textureLoader=new HB(this.options.manager):this.textureLoader=new XB(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ji(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const s=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(o){const a={scene:o[0][i.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:i.asset,parser:s,userData:{}};return ze(r,a,i),pe(a,i),Promise.all(s._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){for(const c of a.scenes)c.updateMatrixWorld();t(a)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],s=this.json.meshes||[];for(let i=0,r=e.length;i<r;i++){const o=e[i].joints;for(let a=0,c=o.length;a<c;a++)t[o[a]].isBone=!0}for(let i=0,r=t.length;i<r;i++){const o=t[i];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(s[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,s){if(t.refs[e]<=1)return s;const i=s.clone(),r=(o,a)=>{const c=this.associations.get(o);c!=null&&this.associations.set(a,c);for(const[h,l]of o.children.entries())r(l,a.children[h])};return r(s,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let s=0;s<e.length;s++){const i=t(e[s]);if(i)return i}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const s=[];for(let i=0;i<e.length;i++){const r=t(e[i]);r&&s.push(r)}return s}getDependency(t,e){const s=t+":"+e;let i=this.cache.get(s);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this._invokeOne(function(r){return r.loadNode&&r.loadNode(e)});break;case"mesh":i=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(e)});break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(e)});break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(e)});break;case"texture":i=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(e)});break;case"skin":i=this.loadSkin(e);break;case"animation":i=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(e)});break;case"camera":i=this.loadCamera(e);break;default:if(i=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(t,e)}),!i)throw new Error("Unknown type: "+t);break}this.cache.add(s,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){const s=this,i=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(i.map(function(r,o){return s.getDependency(t,o)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],s=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[O.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(r,o){s.load(fn.resolveURL(e.uri,i.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(s){const i=e.byteLength||0,r=e.byteOffset||0;return s.slice(r,r+i)})}loadAccessor(t){const e=this,s=this.json,i=this.json.accessors[t];if(i.bufferView===void 0&&i.sparse===void 0){const o=fo[i.type],a=Is[i.componentType],c=i.normalized===!0,h=new a(i.count*o);return Promise.resolve(new Bt(h,o,c))}const r=[];return i.bufferView!==void 0?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),i.sparse!==void 0&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],c=fo[i.type],h=Is[i.componentType],l=h.BYTES_PER_ELEMENT,u=l*c,d=i.byteOffset||0,f=i.bufferView!==void 0?s.bufferViews[i.bufferView].byteStride:void 0,p=i.normalized===!0;let m,g;if(f&&f!==u){const b=Math.floor(d/f),y="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+b+":"+i.count;let x=e.cache.get(y);x||(m=new h(a,b*f,i.count*f/l),x=new TB(m,f/l),e.cache.add(y,x)),g=new Da(x,c,d%f/l,p)}else a===null?m=new h(i.count*c):m=new h(a,d,i.count*c),g=new Bt(m,c,p);if(i.sparse!==void 0){const b=fo.SCALAR,y=Is[i.sparse.indices.componentType],x=i.sparse.indices.byteOffset||0,A=i.sparse.values.byteOffset||0,B=new y(o[1],x,i.sparse.count*b),E=new h(o[2],A,i.sparse.count*c);a!==null&&(g=new Bt(g.array.slice(),g.itemSize,g.normalized)),g.normalized=!1;for(let C=0,S=B.length;C<S;C++){const F=B[C];if(g.setX(F,E[C*c]),c>=2&&g.setY(F,E[C*c+1]),c>=3&&g.setZ(F,E[C*c+2]),c>=4&&g.setW(F,E[C*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}g.normalized=p}return g})}loadTexture(t){const e=this.json,s=this.options,r=e.textures[t].source,o=e.images[r];let a=this.textureLoader;if(o.uri){const c=s.manager.getHandler(o.uri);c!==null&&(a=c)}return this.loadTextureImage(t,r,a)}loadTextureImage(t,e,s){const i=this,r=this.json,o=r.textures[t],a=r.images[e],c=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[c])return this.textureCache[c];const h=this.loadImageSource(e,s).then(function(l){l.flipY=!1,l.name=o.name||a.name||"",l.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(l.name=a.uri);const d=(r.samplers||{})[o.sampler]||{};return l.magFilter=gl[d.magFilter]||Ui,l.minFilter=gl[d.minFilter]||_a,l.wrapS=yl[d.wrapS]||gn,l.wrapT=yl[d.wrapT]||gn,l.generateMipmaps=!l.isCompressedTexture&&l.minFilter!==vi&&l.minFilter!==Ui,i.associations.set(l,{textures:t}),l}).catch(function(){return null});return this.textureCache[c]=h,h}loadImageSource(t,e){const s=this,i=this.json,r=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(u=>u.clone());const o=i.images[t],a=self.URL||self.webkitURL;let c=o.uri||"",h=!1;if(o.bufferView!==void 0)c=s.getDependency("bufferView",o.bufferView).then(function(u){h=!0;const d=new Blob([u],{type:o.mimeType});return c=a.createObjectURL(d),c});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const l=Promise.resolve(c).then(function(u){return new Promise(function(d,f){let p=d;e.isImageBitmapLoader===!0&&(p=function(m){const g=new Wt(m);g.needsUpdate=!0,d(g)}),e.load(fn.resolveURL(u,r.path),p,void 0,f)})}).then(function(u){return h===!0&&a.revokeObjectURL(c),pe(u,o),u.userData.mimeType=o.mimeType||vw(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),u});return this.sourceCache[t]=l,l}assignTexture(t,e,s,i){const r=this;return this.getDependency("texture",s.index).then(function(o){if(!o)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(o=o.clone(),o.channel=s.texCoord),r.extensions[O.KHR_TEXTURE_TRANSFORM]){const a=s.extensions!==void 0?s.extensions[O.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=r.associations.get(o);o=r.extensions[O.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,c)}}return i!==void 0&&(o.colorSpace=i),t[e]=o,o})}assignFinalMaterial(t){const e=t.geometry;let s=t.material;const i=e.attributes.tangent===void 0,r=e.attributes.color!==void 0,o=e.attributes.normal===void 0;if(t.isPoints){const a="PointsMaterial:"+s.uuid;let c=this.cache.get(a);c||(c=new _d,We.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,c.sizeAttenuation=!1,this.cache.add(a,c)),s=c}else if(t.isLine){const a="LineBasicMaterial:"+s.uuid;let c=this.cache.get(a);c||(c=new Cd,We.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,this.cache.add(a,c)),s=c}if(i||r||o){let a="ClonedMaterial:"+s.uuid+":";i&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=s.clone(),r&&(c.vertexColors=!0),o&&(c.flatShading=!0),i&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(s))),s=c}t.material=s}getMaterialType(){return Na}loadMaterial(t){const e=this,s=this.json,i=this.extensions,r=s.materials[t];let o;const a={},c=r.extensions||{},h=[];if(c[O.KHR_MATERIALS_UNLIT]){const u=i[O.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),h.push(u.extendParams(a,r,e))}else{const u=r.pbrMetallicRoughness||{};if(a.color=new Y(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],Dt),a.opacity=d[3]}u.baseColorTexture!==void 0&&h.push(e.assignTexture(a,"map",u.baseColorTexture,$)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(h.push(e.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),h.push(e.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(t)}),h.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(t,a)})))}r.doubleSided===!0&&(a.side=ET);const l=r.alphaMode||po.OPAQUE;if(l===po.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,l===po.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==_s&&(h.push(e.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Q(1,1),r.normalTexture.scale!==void 0)){const u=r.normalTexture.scale;a.normalScale.set(u,u)}if(r.occlusionTexture!==void 0&&o!==_s&&(h.push(e.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==_s){const u=r.emissiveFactor;a.emissive=new Y().setRGB(u[0],u[1],u[2],Dt)}return r.emissiveTexture!==void 0&&o!==_s&&h.push(e.assignTexture(a,"emissiveMap",r.emissiveTexture,$)),Promise.all(h).then(function(){const u=new o(a);return r.name&&(u.name=r.name),pe(u,r),e.associations.set(u,{materials:t}),r.extensions&&ze(i,u,r),u})}createUniqueName(t){const e=z.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,s=this.extensions,i=this.primitiveCache;function r(a){return s[O.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,e).then(function(c){return Al(c,a,e)})}const o=[];for(let a=0,c=t.length;a<c;a++){const h=t[a],l=Gw(h),u=i[l];if(u)o.push(u.promise);else{let d;h.extensions&&h.extensions[O.KHR_DRACO_MESH_COMPRESSION]?d=r(h):d=Al(new $e,h,e),i[l]={primitive:h,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(t){const e=this,s=this.json,i=this.extensions,r=s.meshes[t],o=r.primitives,a=[];for(let c=0,h=o.length;c<h;c++){const l=o[c].material===void 0?Nw(this.cache):this.getDependency("material",o[c].material);a.push(l)}return a.push(e.loadGeometries(o)),Promise.all(a).then(function(c){const h=c.slice(0,c.length-1),l=c[c.length-1],u=[];for(let f=0,p=l.length;f<p;f++){const m=l[f],g=o[f];let b;const y=h[f];if(g.mode===Mt.TRIANGLES||g.mode===Mt.TRIANGLE_STRIP||g.mode===Mt.TRIANGLE_FAN||g.mode===void 0)b=r.isSkinnedMesh===!0?new wB(m,y):new nr(m,y),b.isSkinnedMesh===!0&&b.normalizeSkinWeights(),g.mode===Mt.TRIANGLE_STRIP?b.geometry=ml(b.geometry,yd):g.mode===Mt.TRIANGLE_FAN&&(b.geometry=ml(b.geometry,jo));else if(g.mode===Mt.LINES)b=new _B(m,y);else if(g.mode===Mt.LINE_STRIP)b=new La(m,y);else if(g.mode===Mt.LINE_LOOP)b=new SB(m,y);else if(g.mode===Mt.POINTS)b=new FB(m,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(b.geometry.morphAttributes).length>0&&Pw(b,r),b.name=e.createUniqueName(r.name||"mesh_"+t),pe(b,r),g.extensions&&ze(i,b,g),e.assignFinalMaterial(b),u.push(b)}for(let f=0,p=u.length;f<p;f++)e.associations.set(u[f],{meshes:t,primitives:f});if(u.length===1)return r.extensions&&ze(i,u[0],r),u[0];const d=new ro;r.extensions&&ze(i,d,r),e.associations.set(d,{meshes:t});for(let f=0,p=u.length;f<p;f++)d.add(u[f]);return d})}loadCamera(t){let e;const s=this.json.cameras[t],i=s[s.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?e=new Ia($T.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):s.type==="orthographic"&&(e=new wd(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),s.name&&(e.name=this.createUniqueName(s.name)),pe(e,s),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],s=[];for(let i=0,r=e.joints.length;i<r;i++)s.push(this._loadNodeShallow(e.joints[i]));return e.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",e.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(i){const r=i.pop(),o=i,a=[],c=[];for(let h=0,l=o.length;h<l;h++){const u=o[h];if(u){a.push(u);const d=new L;r!==null&&d.fromArray(r.array,h*16),c.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[h])}return new Oa(a,c)})}loadAnimation(t){const e=this.json,s=this,i=e.animations[t],r=i.name?i.name:"animation_"+t,o=[],a=[],c=[],h=[],l=[];for(let u=0,d=i.channels.length;u<d;u++){const f=i.channels[u],p=i.samplers[f.sampler],m=f.target,g=m.node,b=i.parameters!==void 0?i.parameters[p.input]:p.input,y=i.parameters!==void 0?i.parameters[p.output]:p.output;m.node!==void 0&&(o.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",b)),c.push(this.getDependency("accessor",y)),h.push(p),l.push(m))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(h),Promise.all(l)]).then(function(u){const d=u[0],f=u[1],p=u[2],m=u[3],g=u[4],b=[];for(let y=0,x=d.length;y<x;y++){const A=d[y],B=f[y],E=p[y],C=m[y],S=g[y];if(A===void 0)continue;A.updateMatrix&&A.updateMatrix();const F=s._createAnimationTracks(A,B,E,C,S);if(F)for(let R=0;R<F.length;R++)b.push(F[R])}return new kB(r,void 0,b)})}createNodeMesh(t){const e=this.json,s=this,i=e.nodes[t];return i.mesh===void 0?null:s.getDependency("mesh",i.mesh).then(function(r){const o=s._getNodeRef(s.meshCache,i.mesh,r);return i.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let c=0,h=i.weights.length;c<h;c++)a.morphTargetInfluences[c]=i.weights[c]}),o})}loadNode(t){const e=this.json,s=this,i=e.nodes[t],r=s._loadNodeShallow(t),o=[],a=i.children||[];for(let h=0,l=a.length;h<l;h++)o.push(s.getDependency("node",a[h]));const c=i.skin===void 0?Promise.resolve(null):s.getDependency("skin",i.skin);return Promise.all([r,Promise.all(o),c]).then(function(h){const l=h[0],u=h[1],d=h[2];d!==null&&l.traverse(function(f){f.isSkinnedMesh&&f.bind(d,Uw)});for(let f=0,p=u.length;f<p;f++)l.add(u[f]);return l})}_loadNodeShallow(t){const e=this.json,s=this.extensions,i=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const r=e.nodes[t],o=r.name?i.createUniqueName(r.name):"",a=[],c=i._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(t)});return c&&a.push(c),r.camera!==void 0&&a.push(i.getDependency("camera",r.camera).then(function(h){return i._getNodeRef(i.cameraCache,r.camera,h)})),i._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(t)}).forEach(function(h){a.push(h)}),this.nodeCache[t]=Promise.all(a).then(function(h){let l;if(r.isBone===!0?l=new Md:h.length>1?l=new ro:h.length===1?l=h[0]:l=new W,l!==h[0])for(let u=0,d=h.length;u<d;u++)l.add(h[u]);if(r.name&&(l.userData.name=r.name,l.name=o),pe(l,r),r.extensions&&ze(s,l,r),r.matrix!==void 0){const u=new L;u.fromArray(r.matrix),l.applyMatrix4(u)}else r.translation!==void 0&&l.position.fromArray(r.translation),r.rotation!==void 0&&l.quaternion.fromArray(r.rotation),r.scale!==void 0&&l.scale.fromArray(r.scale);return i.associations.has(l)||i.associations.set(l,{}),i.associations.get(l).nodes=t,l}),this.nodeCache[t]}loadScene(t){const e=this.extensions,s=this.json.scenes[t],i=this,r=new ro;s.name&&(r.name=i.createUniqueName(s.name)),pe(r,s),s.extensions&&ze(e,r,s);const o=s.nodes||[],a=[];for(let c=0,h=o.length;c<h;c++)a.push(i.getDependency("node",o[c]));return Promise.all(a).then(function(c){for(let l=0,u=c.length;l<u;l++)r.add(c[l]);const h=l=>{const u=new Map;for(const[d,f]of i.associations)(d instanceof We||d instanceof Wt)&&u.set(d,f);return l.traverse(d=>{const f=i.associations.get(d);f!=null&&u.set(d,f)}),u};return i.associations=h(r),r})}_createAnimationTracks(t,e,s,i,r){const o=[],a=t.name?t.name:t.uuid,c=[];Se[r.path]===Se.weights?t.traverse(function(d){d.morphTargetInfluences&&c.push(d.name?d.name:d.uuid)}):c.push(a);let h;switch(Se[r.path]){case Se.weights:h=Ps;break;case Se.rotation:h=Gs;break;case Se.position:case Se.scale:h=vs;break;default:switch(s.itemSize){case 1:h=Ps;break;case 2:case 3:default:h=vs;break}break}const l=i.interpolation!==void 0?Lw[i.interpolation]:An,u=this._getArrayFromAccessor(s);for(let d=0,f=c.length;d<f;d++){const p=new h(c[d]+"."+Se[r.path],e.array,u,l);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),o.push(p)}return o}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const s=Yo(e.constructor),i=new Float32Array(e.length);for(let r=0,o=e.length;r<o;r++)i[r]=e[r]*s;e=i}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(s){const i=this instanceof Gs?Ow:Dd;return new i(this.times,this.values,this.getValueSize()/3,s)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Hw(n,t,e){const s=t.attributes,i=new ee;if(s.POSITION!==void 0){const a=e.json.accessors[s.POSITION],c=a.min,h=a.max;if(c!==void 0&&h!==void 0){if(i.set(new M(c[0],c[1],c[2]),new M(h[0],h[1],h[2])),a.normalized){const l=Yo(Is[a.componentType]);i.min.multiplyScalar(l),i.max.multiplyScalar(l)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=t.targets;if(r!==void 0){const a=new M,c=new M;for(let h=0,l=r.length;h<l;h++){const u=r[h];if(u.POSITION!==void 0){const d=e.json.accessors[u.POSITION],f=d.min,p=d.max;if(f!==void 0&&p!==void 0){if(c.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),c.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),c.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),d.normalized){const m=Yo(Is[d.componentType]);c.multiplyScalar(m)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}n.boundingBox=i;const o=new se;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,n.boundingSphere=o}function Al(n,t,e){const s=t.attributes,i=[];function r(o,a){return e.getDependency("accessor",o).then(function(c){n.setAttribute(a,c)})}for(const o in s){const a=Qo[o]||o.toLowerCase();a in n.attributes||i.push(r(s[o],a))}if(t.indices!==void 0&&!n.index){const o=e.getDependency("accessor",t.indices).then(function(a){n.setIndex(a)});i.push(o)}return lt.workingColorSpace!==Dt&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${lt.workingColorSpace}" not supported.`),pe(n,t),Hw(n,t,e),Promise.all(i).then(function(){return t.targets!==void 0?kw(n,t.targets,e):n})}var jw=function(){var n="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",t="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),s=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var i=WebAssembly.validate(e)?t:n,r,o=WebAssembly.instantiate(a(i),{}).then(function(b){r=b.instance,r.exports.__wasm_call_ctors()});function a(b){for(var y=new Uint8Array(b.length),x=0;x<b.length;++x){var A=b.charCodeAt(x);y[x]=A>96?A-97:A>64?A-39:A+4}for(var B=0,x=0;x<b.length;++x)y[B++]=y[x]<60?s[y[x]]:(y[x]-60)*64+y[++x];return y.buffer.slice(0,B)}function c(b,y,x,A,B,E){var C=r.exports.sbrk,S=x+3&-4,F=C(S*A),R=C(B.length),I=new Uint8Array(r.exports.memory.buffer);I.set(B,R);var G=b(F,x,A,R,B.length);if(G==0&&E&&E(F,S,A),y.set(I.subarray(F,F+x*A)),C(F-C(0)),G!=0)throw new Error("Malformed buffer data: "+G)}var h={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},u=[],d=0;function f(b){var y={object:new Worker(b),pending:0,requests:{}};return y.object.onmessage=function(x){var A=x.data;y.pending-=A.count,y.requests[A.id][A.action](A.value),delete y.requests[A.id]},y}function p(b){for(var y="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(i))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+c.toString()+g.toString(),x=new Blob([y],{type:"text/javascript"}),A=URL.createObjectURL(x),B=0;B<b;++B)u[B]=f(A);URL.revokeObjectURL(A)}function m(b,y,x,A,B){for(var E=u[0],C=1;C<u.length;++C)u[C].pending<E.pending&&(E=u[C]);return new Promise(function(S,F){var R=new Uint8Array(x),I=d++;E.pending+=b,E.requests[I]={resolve:S,reject:F},E.object.postMessage({id:I,count:b,size:y,source:R,mode:A,filter:B},[R.buffer])})}function g(b){o.then(function(){var y=b.data;try{var x=new Uint8Array(y.count*y.size);c(r.exports[y.mode],x,y.count,y.size,y.source,r.exports[y.filter]),self.postMessage({id:y.id,count:y.count,action:"resolve",value:x},[x.buffer])}catch(A){self.postMessage({id:y.id,count:y.count,action:"reject",value:A})}})}return{ready:o,supported:!0,useWorkers:function(b){p(b)},decodeVertexBuffer:function(b,y,x,A,B){c(r.exports.meshopt_decodeVertexBuffer,b,y,x,A,r.exports[h[B]])},decodeIndexBuffer:function(b,y,x,A){c(r.exports.meshopt_decodeIndexBuffer,b,y,x,A)},decodeIndexSequence:function(b,y,x,A){c(r.exports.meshopt_decodeIndexSequence,b,y,x,A)},decodeGltfBuffer:function(b,y,x,A,B,E){c(r.exports[l[B]],b,y,x,A,r.exports[h[E]])},decodeGltfBufferAsync:function(b,y,x,A,B){return u.length>0?m(b,y,x,l[A],h[B]):o.then(function(){var E=new Uint8Array(b*y);return c(r.exports[l[A]],E,b,y,x,r.exports[h[B]]),E})}}}();const Vw=1200,Jw=800,Ww=14,qw=4,Kw=200,Xw="./exports",ws={viewportWidth:Vw,viewportHeight:Jw,zoom:Ww,sse:qw,maxTilesLimit:Kw,outDir:Xw},xl="https://tile.googleapis.com/";let bo=null,go=null;function Od(){return bo||(bo=new Rd),bo}function Qw(){const n=Od();return go||(go=new ow(n).setDecoderPath("/Google-3D-Map-Tiles-Export/draco/gltf/")),go}class Yw{constructor(){T(this,"latitude");T(this,"longitude");T(this,"outputFilename");T(this,"googleMapsApiKey");T(this,"selectedTileSet");T(this,"tilesContentUrls",[]);T(this,"_3DScene");T(this,"options",ws)}get googleMapsSessionId(){const t=this.selectedTileSet;return t?new URL(`${xl}?${t.queryParams}`).searchParams.get("session"):null}async exportTiles(t,e,s,i,r){this.latitude=t,this.longitude=e,this.googleMapsApiKey=s,this.outputFilename=i,this.options={...this.options,...r},await this.loadTileSet(),this.extract3DTilesContentUrl(),await this.create3DScene(),this.downloadSTL()}async loadTileSet(){const t=this.latitude,e=this.longitude,s=this.options.sse;if(!t||!e)throw new Error("Latitude or longitude is not defined");const i=this.googleMapsApiKey;if(!i)throw new Error("Google maps api key is required to fetch 3D tiles");const r=`${xl}v1/3dtiles/root.json?key=${i}`,o=await En(r,ld,{"3d-tiles":{loadGLTF:!1}}),a=new Fg(o,{throttleRequests:!1,maximumScreenSpaceError:s}),c=new bn({latitude:t,longitude:e,width:this.options.viewportWidth,height:this.options.viewportHeight,zoom:this.options.zoom});for(;!a.isLoaded();)await a.selectTiles(c);this.selectedTileSet=a}extract3DTilesContentUrl(){const{selectedTileSet:t,googleMapsApiKey:e,latitude:s,longitude:i}=this,r=this.googleMapsSessionId;if(!t)throw new Error("3D tile set does not exists");if(!r)throw new Error("Google maps session id does not exists");if(!e)throw new Error("Google maps API key does not exists");if(!s||!i)throw new Error("Latitude or longitude is not defined");let o=t.selectedTiles;o.sort((l,u)=>l.header.geometricError-u.header.geometricError);const a=this.options.sse,c=[],h=l=>{const u=this.options.maxTilesLimit;for(const d of o){const f=Math.round(d.header.geometricError);if(c.length===u){console.log(`3D tile set contained ${o.length} tiles, selecting the first ${u} tiles.`);break}if(f-a<=l){const p=`${d.contentUrl}?session=${r}&key=${e}`;c.push(p)}}};if(h(a),!c.length&&o.length){console.log("filtering again with threshold: ",o[0].header.geometricError*2);const l=o[0].header.geometricError*2;h(l)}if(!c.length)throw new Error(`Failed to find tiles content urls around lat=${s}, long=${i}. Tilset selected tiles=${o}`);this.tilesContentUrls=c}async create3DScene(){const t=this.tilesContentUrls;if(!t.length)throw new Error("Failed to create 3D scene, mo tiles content urls to load");const e=new W,s=[];for(let a=0;a<t.length;a++){const c=t[a];console.log(`loading content for tile: ${a+1}`);try{const h=await this.loadGLTF(c);console.log(`Successfully loaded content for tile: ${a+1}`),s.push(h),e.add(h.scene)}catch(h){console.log(`Failed to load content for tile ${a+1}, content url: ${c}, error: ${h.message}`)}}const r=new ee().setFromObject(e).getCenter(new M);s.forEach(a=>{const c=a.scene.children[0],h=c.position.clone().sub(r);c.position.set(h.x,h.y,h.z)});const o=new xB;o.add(e),this._3DScene=o}async loadGLTF(t){return new Promise((e,s)=>{const i=Od(),r=Qw();new cw(i).setCrossOrigin("anonymous").setDRACOLoader(r).setMeshoptDecoder(jw).load(t,e,void 0,s)})}downloadSTL(){const t=this._3DScene,e=this.outputFilename||Date.now().toString();if(!t)throw new Error("No 3D scene to download");const i=new rw().parse(t,{binary:!0}),r=new Blob([i],{type:"application/stl"}),o=URL.createObjectURL(r),a=document.createElement("a");a.style.display="none",document.body.appendChild(a),a.href=o,a.download=`${e}.stl`,a.click(),URL.revokeObjectURL(o)}}const rt={apiKey:new oe("#api-key","text",void 0,{required:!0}),latitude:new oe("#latitude","number",void 0,{floatAllowed:!0,required:!0}),longitude:new oe("#longitude","number",void 0,{floatAllowed:!0,required:!0}),filename:new oe("#filename","text",void 0,{required:!0}),width:new oe("#width","number",ws.viewportWidth,{min:250,max:1200}),height:new oe("#height","number",ws.viewportHeight,{min:250,max:1200}),zoom:new oe("#zoom","number",ws.zoom,{min:1,max:25}),maxTilesLimit:new oe("#tiles-limit","number",ws.maxTilesLimit,{min:1}),sse:new oe("#sse","number",ws.sse,{floatAllowed:!0,min:3,max:8})},$w=document.querySelector("#form"),yo=$w.querySelectorAll("input"),Ld=document.querySelector("#form button[name='submit-btn']"),He=document.querySelector("#btn-container .progress");function Tl(n){Object.values(rt).forEach(t=>t.disableInput(n)),Ld.disabled=n}function Zw(){const n=Object.values(rt);return n.forEach(t=>t.validate()),n.every(t=>!t.hasErrors)}function Ao(n,t,e){He.innerText=n,t?He.classList.add("error"):He.classList.remove("error"),e?He.classList.add("italic"):He.classList.remove("italic")}function tM(){He.classList.remove("error"),He.innerText=""}yo==null||yo.forEach(n=>n.addEventListener("keydown",t=>{tM()}));Ld.addEventListener("click",n=>{if(Zw()){const t=rt.apiKey.value,e=rt.filename.value,s=Number(rt.latitude.value),i=Number(rt.longitude.value),r={viewportWidth:rt.width.value?Number(rt.width.value):void 0,viewportHeight:rt.height.value?Number(rt.height.value):void 0,zoom:rt.zoom.value?Number(rt.zoom.value):void 0,maxTilesLimit:rt.maxTilesLimit.value?Number(rt.maxTilesLimit.value):void 0,sse:rt.sse.value?Number(rt.sse.value):void 0};Tl(!0),Ao("Processing ...",!1,!0),new Yw().exportTiles(s,i,t,e,r).then(()=>{Ao("STL exported successfully!")}).catch(a=>{let c="";a instanceof Error&&(c=a.message),Ao(`Export failed. ${c}`,!0)}).finally(()=>{Tl(!1)})}});
